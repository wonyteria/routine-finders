<div class="space-y-10 pt-2">
  <!-- 1. Hall of Fame (Podium) -->
  <section class="space-y-6">
    <div class="text-center space-y-1">
      <h3 class="text-xs font-black text-indigo-400 uppercase tracking-[0.3em]">이달의 통합 성취 랭킹</h3>
      <p class="text-[10px] font-bold text-slate-500">모두가 함께 경쟁하고 성장하는 명예의 전당</p>
    </div>

    <!-- Podium Visual -->
    <div class="relative h-60 flex items-end justify-center gap-2 px-4">
      <!-- Top 2 -->
      <div class="flex flex-col items-center gap-3 w-24">
        <%= link_to prototype_user_card_path(@top_users[1]&.id || 0), data: { turbo_frame: "user-profile-modal-frame" }, class: "group contents" do %>
          <div class="relative">
            <div class="w-16 h-16 rounded-full border-4 border-slate-400 overflow-hidden shadow-2xl group-active:scale-95 transition-transform">
              <img src="<%= @top_users[1]&.profile_image %>" class="w-full h-full object-cover">
            </div>
            <div class="absolute -top-2 -right-2 w-7 h-7 bg-slate-400 rounded-full flex items-center justify-center text-white font-black border-2 border-[#0C0B12] text-xs shadow-lg">2</div>
          </div>
          <div class="w-full h-24 bg-slate-800/40 rounded-t-[20px] border border-white/5 flex flex-col items-center justify-center group-hover:bg-slate-800/60 transition-colors">
             <p class="text-[11px] font-black text-white line-clamp-1"><%= @top_users[1]&.nickname %></p>
             <div class="flex items-center gap-1 mt-0.5">
               <% if @monthly_rankings[1]&.dig(:is_club) %>
                 <span class="px-2 py-0.5 rounded-full bg-indigo-500 text-[8px] font-black text-white">루파</span>
               <% end %>
               <p class="text-[9px] font-bold text-slate-500"><%= @monthly_rankings[1]&.dig(:score)&.round(1) || 0 %>P</p>
             </div>
          </div>
        <% end %>
      </div>

      <!-- Top 1 (Center) -->
      <div class="flex flex-col items-center gap-3 w-28 -translate-y-4">
        <%= link_to prototype_user_card_path(@top_users[0]&.id || 0), data: { turbo_frame: "user-profile-modal-frame" }, class: "group contents" do %>
          <div class="relative">
            <div class="absolute inset-0 bg-indigo-500 blur-2xl opacity-40 animate-pulse"></div>
            <div class="relative w-20 h-20 rounded-full border-4 border-amber-400 overflow-hidden shadow-2xl group-active:scale-95 transition-transform">
              <img src="<%= @top_users[0]&.profile_image %>" class="w-full h-full object-cover">
            </div>
            <div class="absolute -top-3 -right-3 w-9 h-9 bg-amber-400 rounded-full flex items-center justify-center text-white font-black border-4 border-[#0C0B12] text-sm shadow-xl">👑</div>
          </div>
          <div class="w-full h-32 bg-indigo-500/10 rounded-t-[20px] border border-indigo-500/30 flex flex-col items-center justify-center shadow-[0_0_20px_rgba(124,77,255,0.2)] group-hover:bg-indigo-500/20 transition-colors">
             <p class="text-sm font-black text-white line-clamp-1"><%= @top_users[0]&.nickname %></p>
             <div class="flex items-center gap-1 mt-1">
                <% if @monthly_rankings[0]&.dig(:is_club) %>
                  <span class="px-2 py-0.5 rounded-full bg-indigo-500 text-[8px] font-black text-white">
                    루파
                  </span>
                <% end %>
               <p class="text-[10px] font-bold text-indigo-400"><%= @monthly_rankings[0]&.dig(:score)&.round(1) || 0 %>P</p>
             </div>
          </div>
        <% end %>
      </div>

      <!-- Top 3 -->
      <div class="flex flex-col items-center gap-3 w-24">
        <%= link_to prototype_user_card_path(@top_users[2]&.id || 0), data: { turbo_frame: "user-profile-modal-frame" }, class: "group contents" do %>
          <div class="relative">
            <div class="w-16 h-16 rounded-full border-4 border-amber-700/50 overflow-hidden shadow-2xl group-active:scale-95 transition-transform">
              <img src="<%= @top_users[2]&.profile_image %>" class="w-full h-full object-cover">
            </div>
            <div class="absolute -top-2 -right-2 w-7 h-7 bg-amber-700/80 rounded-full flex items-center justify-center text-white font-black border-2 border-[#0C0B12] text-xs shadow-lg">3</div>
          </div>
          <div class="w-full h-20 bg-slate-800/20 rounded-t-[20px] border border-white/5 flex flex-col items-center justify-center group-hover:bg-slate-800/40 transition-colors">
             <p class="text-[11px] font-black text-white line-clamp-1"><%= @top_users[2]&.nickname %></p>
             <div class="flex items-center gap-1 mt-0.5">
               <% if @monthly_rankings[2]&.dig(:is_club) %>
                 <span class="px-2 py-0.5 rounded-full bg-indigo-500 text-[8px] font-black text-white">루파</span>
               <% end %>
               <p class="text-[9px] font-bold text-slate-500"><%= @monthly_rankings[2]&.dig(:score)&.round(1) || 0 %>P</p>
             </div>
          </div>
        <% end %>
      </div>
    </div>
  </section>

  <!-- 1.5 Integrated Leaderboard Table -->
  <section class="space-y-4">
    <div class="flex justify-between items-center px-2">
      <h3 class="text-xs font-black text-slate-500 uppercase tracking-[0.2em]">🏆 리더보드</h3>
      <div class="flex items-center gap-2">
        <button type="button" 
                onclick="document.getElementById('score-guide-modal').classList.remove('hidden')"
                class="px-2 py-0.5 bg-indigo-500/10 rounded-full flex items-center gap-1 hover:bg-indigo-500/20 transition-colors">
          <span class="text-[8px] font-black text-indigo-400">포인트 기준</span>
          <svg class="w-2.5 h-2.5 text-indigo-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
        </button>
        <p class="text-[10px] font-bold text-indigo-400"><%= Date.current.strftime('%Y년 %m월') %></p>
      </div>
    </div>

    <!-- Ranking List Partial (Turbo Frame is inside the partial) -->
    <%= render partial: "ranking_list", locals: { rankings: @monthly_rankings, period: @period || 'monthly' } %>
  </section>

  <!-- Full Ranking Modal -->
  <div id="full-ranking-modal" class="hidden fixed inset-0 z-[100] flex items-end sm:items-center justify-center p-0 sm:p-4">
    <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" onclick="this.parentElement.classList.add('hidden')"></div>
    <div class="relative w-full max-w-lg h-[90vh] sm:h-[80vh] bg-[#0C0B12] rounded-t-[40px] sm:rounded-[40px] border-t sm:border border-white/10 flex flex-col overflow-hidden animate-slide-up">
      <!-- Modal Header -->
      <div class="sticky top-0 z-20 bg-[#0C0B12] p-6 border-b border-white/5">
        <div class="flex justify-between items-center mb-4">
          <h4 class="text-lg font-black text-white">전체 통합 리더보드</h4>
          <button onclick="this.closest('#full-ranking-modal').classList.add('hidden')" class="w-8 h-8 rounded-full bg-white/5 flex items-center justify-center text-slate-400">✕</button>
        </div>
        <div class="flex items-center gap-2">
          <% if @my_ranking %>
            <div class="flex-1 p-4 bg-indigo-600/20 border border-indigo-500/30 rounded-2xl flex items-center justify-between">
              <div class="flex items-center gap-3">
                <span class="text-xs font-black text-indigo-400">#<%= @my_ranking[:rank] %></span>
                <span class="text-[11px] font-bold text-white"><%= current_user.nickname %>님 (나)</span>
              </div>
              <span class="text-xs font-black text-indigo-400"><%= @my_ranking[:score] %>P</span>
            </div>
          <% end %>
        </div>
      </div>

      <!-- Modal Body -->
      <div class="flex-1 overflow-y-auto p-4 space-y-2 pb-[160px]">
        <% @monthly_rankings.each_with_index do |ranking, index| %>
          <% user = ranking[:user] %>
          <%= link_to prototype_user_card_path(user), data: { turbo_frame: "user-profile-modal-frame" }, class: "flex items-center justify-between p-4 #{user == current_user ? 'bg-indigo-600/10 border border-indigo-500/20' : 'bg-white/[0.03]'} rounded-2xl hover:bg-white/[0.08] transition-colors" do %>
            <div class="flex items-center gap-4">
              <div class="w-6 text-center text-[10px] font-black <%= index < 3 ? 'text-amber-400' : 'text-slate-500' %>"><%= index + 1 %></div>
              <div class="w-8 h-8 rounded-lg overflow-hidden shrink-0">
                <img src="<%= user.profile_image %>" class="w-full h-full object-cover">
              </div>
              <div>
                <div class="flex items-center gap-1.5">
                  <span class="text-xs font-black text-white line-clamp-1"><%= user.nickname %></span>
                  <% if ranking[:is_club] %>
                    <span class="text-[8px]">🔱</span>
                  <% end %>
                </div>
                <p class="text-[8px] font-bold text-slate-500">Lv.<%= user.level %></p>
              </div>
            </div>
            <p class="text-xs font-bold text-white"><%= ranking[:score] %>P</p>
          <% end %>
        <% end %>
      </div>
    </div>
  </div>

  <!-- Score Guide Modal -->
  <div id="score-guide-modal" class="hidden fixed inset-0 z-[100] flex items-center justify-center p-6">
    <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" onclick="this.parentElement.classList.add('hidden')"></div>
    <div class="relative w-full max-w-sm bg-[#1B1A24] rounded-[32px] border border-white/10 p-8 animate-badge-pop shadow-2xl">
      <div class="flex justify-between items-start mb-6">
        <div>
          <h3 class="text-xl font-black text-white mb-1">🏆 랭킹 포인트 기준</h3>
          <p class="text-[10px] font-bold text-slate-500">활동에 따라 점수가 자동으로 집계됩니다.</p>
        </div>
        <button onclick="this.closest('#score-guide-modal').classList.add('hidden')" class="w-8 h-8 rounded-full bg-white/5 flex items-center justify-center text-slate-400 hover:text-white hover:bg-white/10 transition-colors">✕</button>
      </div>
      
      <div class="space-y-3">
        <div class="flex justify-between items-center p-3 rounded-xl bg-white/5 border border-white/5">
          <div class="flex items-center gap-3">
            <span class="text-lg">✔️</span>
            <span class="text-xs font-bold text-white">루틴 1회 완료</span>
          </div>
          <span class="text-xs font-black text-indigo-400">+10 P</span>
        </div>
        <div class="flex justify-between items-center p-3 rounded-xl bg-white/5 border border-white/5">
          <div class="flex items-center gap-3">
            <span class="text-lg">📝</span>
            <span class="text-xs font-bold text-white">오늘의 확언 작성</span>
          </div>
          <span class="text-xs font-black text-indigo-400">+5 P</span>
        </div>
        <div class="flex justify-between items-center p-3 rounded-xl bg-white/5 border border-white/5">
          <div class="flex items-center gap-3">
            <span class="text-lg">🔥</span>
            <span class="text-xs font-bold text-white">라이브룸 참여</span>
          </div>
          <span class="text-xs font-black text-indigo-400">+20 P</span>
        </div>
        <div class="flex justify-between items-center p-3 rounded-xl bg-white/5 border border-white/5">
          <div class="flex items-center gap-3">
            <span class="text-lg">🚩</span>
            <span class="text-xs font-bold text-white">챌린지/모임 개설</span>
          </div>
          <span class="text-xs font-black text-indigo-400">+100 P</span>
        </div>
        <div class="flex justify-between items-center p-3 rounded-xl bg-white/5 border border-white/5">
          <div class="flex items-center gap-3">
            <span class="text-lg">🏃</span>
            <span class="text-xs font-bold text-white">챌린지/모임 참여</span>
          </div>
          <span class="text-xs font-black text-indigo-400">+50 P</span>
        </div>
      </div>

      <div class="mt-6">
        <button onclick="document.getElementById('point-detail-modal').classList.remove('hidden')" 
                class="w-full py-4 bg-indigo-500/10 hover:bg-indigo-500/20 border border-indigo-500/30 rounded-2xl text-[11px] font-black text-indigo-400 transition-all flex items-center justify-center gap-2 group">
          <span>시스템 상세 가이드 보기</span>
          <svg class="w-3 h-3 group-hover:translate-x-0.5 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M13 7l5 5m0 0l-5 5m5-5H6"/></svg>
        </button>
      </div>
    </div>
  </div>

  <!-- Detailed Point Guide Modal -->
  <div id="point-detail-modal" class="hidden fixed inset-0 z-[110] flex items-center justify-center p-6">
    <div class="absolute inset-0 bg-black/95 backdrop-blur-xl" onclick="this.parentElement.classList.add('hidden')"></div>
    <div class="relative w-full max-w-sm h-[80vh] bg-[#0C0B12] rounded-[40px] border border-white/20 flex flex-col overflow-hidden animate-slide-up">
      <!-- Header -->
      <div class="p-8 pb-4 flex justify-between items-center shrink-0">
        <div>
          <h4 class="text-xl font-black text-white">포인트 시스템 가이드</h4>
          <p class="text-[10px] font-bold text-slate-500 mt-1 uppercase tracking-widest">Mastering the Routine System</p>
        </div>
        <button onclick="this.closest('#point-detail-modal').classList.add('hidden')" class="w-8 h-8 rounded-full bg-white/5 flex items-center justify-center text-slate-400">✕</button>
      </div>

      <!-- Content -->
      <div class="flex-1 overflow-y-auto p-8 pt-2 space-y-8 custom-scrollbar">
        <!-- 1. Platform Level -->
        <div class="space-y-4">
          <div class="flex items-center gap-2">
            <span class="w-1.5 h-1.5 rounded-full bg-indigo-500"></span>
            <h5 class="text-xs font-black text-indigo-400 uppercase tracking-widest">1. 플랫폼 레벨 점수</h5>
          </div>
          <div class="p-5 bg-white/[0.03] border border-white/5 rounded-3xl space-y-3">
             <div class="flex justify-between items-center">
               <span class="text-[11px] font-bold text-slate-400">루틴 완료</span>
               <span class="text-[11px] font-black text-white">+10P</span>
             </div>
             <div class="flex justify-between items-center">
               <span class="text-[11px] font-bold text-slate-400">확언 작성</span>
               <span class="text-[11px] font-black text-white">+5P</span>
             </div>
             <div class="flex justify-between items-center">
               <span class="text-[11px] font-bold text-slate-400">라이브 참여</span>
               <span class="text-[11px] font-black text-white">+20P</span>
             </div>
             <div class="flex justify-between items-center">
               <span class="text-[11px] font-bold text-slate-400">모임 개설</span>
               <span class="text-[11px] font-black text-white">+100P</span>
             </div>
             <div class="py-2 border-t border-white/5 mt-2">
               <p class="text-[10px] text-slate-500 leading-relaxed italic">레벨 점수는 누적되며, 높을수록 서비스 내 등급이 상승합니다.</p>
             </div>
          </div>
        </div>

        <!-- 2. Club Growth Points -->
        <div class="space-y-4">
          <div class="flex items-center gap-2">
            <span class="w-1.5 h-1.5 rounded-full bg-emerald-500"></span>
            <h5 class="text-xs font-black text-emerald-400 uppercase tracking-widest">2. 루파 클럽 성장 포인트</h5>
          </div>
          <div class="p-5 bg-emerald-500/[0.02] border border-emerald-500/10 rounded-3xl space-y-3">
             <div class="flex justify-between items-center">
               <span class="text-[11px] font-bold text-slate-400">기본 출석</span>
               <span class="text-[11px] font-black text-white">+10P</span>
             </div>
             <div class="flex justify-between items-center">
               <span class="text-[11px] font-bold text-slate-400">고농도 달성 (100%)</span>
               <span class="text-[11px] font-black text-emerald-400">+20P</span>
             </div>
             <div class="flex justify-between items-center">
               <span class="text-[11px] font-bold text-slate-400">부분 실천 (50%~99%)</span>
               <span class="text-[11px] font-black text-white">+5P</span>
             </div>
             <div class="flex justify-between items-center">
               <span class="text-[11px] font-bold text-slate-400">골든 파이어 (7일 스트릭)</span>
               <span class="text-[11px] font-black text-amber-400">+20P</span>
             </div>
             <div class="py-2 border-t border-emerald-500/10 mt-2">
                <p class="text-[10px] text-emerald-500/70 leading-relaxed">📣 이제 응원(박수) 점수는 제외되며, 오직 본인의 실천만으로 랭킹이 결정됩니다.</p>
             </div>
          </div>
        </div>

        <!-- 3. Identity Guide -->
        <div class="space-y-4">
          <div class="flex items-center gap-2">
            <span class="w-1.5 h-1.5 rounded-full bg-indigo-500"></span>
            <h5 class="text-xs font-black text-slate-500 uppercase tracking-widest">3. 성장 정체성 등급</h5>
          </div>
          <div class="space-y-2">
             <div class="p-4 rounded-2xl bg-indigo-600/20 border border-indigo-500/30 flex justify-between items-center">
               <span class="text-[11px] font-black text-white">루파 로드 마스터</span>
               <span class="text-[10px] font-bold text-indigo-400 text-right">상위 85%↑</span>
             </div>
             <div class="p-4 rounded-2xl bg-white/[0.03] border border-white/5 flex justify-between items-center">
               <span class="text-[11px] font-black text-white">정진하는 가이드</span>
               <span class="text-[10px] font-bold text-slate-500">70% 이상</span>
             </div>
             <div class="p-4 rounded-2xl bg-white/[0.03] border border-white/5 flex justify-between items-center">
               <span class="text-[11px] font-black text-white">성장의 개척자</span>
               <span class="text-[10px] font-bold text-slate-500">40% 이상</span>
             </div>
          </div>
        </div>

        <div class="pt-4 pb-8">
           <p class="text-[10px] text-slate-500 text-center leading-relaxed">루파 클럽은 성실함을 보상하는 구조로 운영됩니다.<br/>적절한 루틴 개수로 꾸준히 실천하는 유저가 가장 높게 평가됩니다.</p>
        </div>
      </div>
    </div>
  </div>

  </style>


  
</div>

