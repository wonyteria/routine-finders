<div class="space-y-8 py-10 pb-32" data-controller="batch-copy">
  <!-- 1. Header -->
  <header class="px-6 space-y-4">
    <div class="flex items-center justify-between">
      <%= link_to prototype_admin_clubs_path, class: "w-10 h-10 rounded-2xl bg-white/5 border border-white/10 flex items-center justify-center text-slate-400 active:scale-95 transition-all" do %>
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M15 19l-7-7 7-7"/></svg>
      <% end %>
      <div class="px-3 py-1 rounded-full bg-emerald-500/10 border border-emerald-500/20">
        <span class="text-[9px] font-black text-emerald-400 uppercase tracking-widest leading-none">Batch Sharing Mode</span>
      </div>
      <div class="w-10"></div>
    </div>

    <div class="space-y-2">
      <h1 class="text-3xl font-black text-white tracking-tight">ì „ì²´ ë¦¬í¬íŠ¸ í†µí•© ìš”ì•½</h1>
      <p class="text-xs font-bold text-slate-500 leading-relaxed">
        ìµœê·¼ ìƒì„±ëœ ëª¨ë“  ë©¤ë²„ì˜ ë¦¬í¬íŠ¸ë¥¼ í•œ í™”ë©´ì—ì„œ í™•ì¸í•˜ê³ <br/>
        ë‹¨í†¡ë°© ê³µìœ ë¥¼ ìœ„í•´ í…ìŠ¤íŠ¸ë¡œ ë¹ ë¥´ê²Œ ë³µì‚¬í•©ë‹ˆë‹¤.
      </p>
    </div>
  </header>

  <!-- 2. Filters & Actions -->
  <section class="px-6 flex flex-col gap-4">
    <div class="flex bg-white/5 p-1 rounded-2xl border border-white/10">
      <%= link_to "ì£¼ê°„ ë¦¬í¬íŠ¸", prototype_batch_reports_path(type: "weekly"), class: "flex-1 py-3 text-center text-xs font-black rounded-xl transition-all #{@report_type == 'weekly' ? 'bg-indigo-600 text-white shadow-lg' : 'text-slate-500'}" %>
      <%= link_to "ì›”ê°„ ë¦¬í¬íŠ¸", prototype_batch_reports_path(type: "monthly"), class: "flex-1 py-3 text-center text-xs font-black rounded-xl transition-all #{@report_type == 'monthly' ? 'bg-purple-600 text-white shadow-lg' : 'text-slate-500'}" %>
    </div>
    
    <button data-action="batch-copy#copyAll" class="w-full py-4 bg-emerald-500 text-white rounded-[24px] font-black text-sm shadow-xl shadow-emerald-500/20 active:scale-95 transition-all flex items-center justify-center gap-3">
      <span class="text-xl">ğŸ“‹</span>
      <span>ë©”ì‹ ì € ê³µìœ ìš© í…ìŠ¤íŠ¸ ì „ì²´ ë³µì‚¬</span>
    </button>
  </section>

  <!-- 3. Report Feed -->
  <section class="px-6 space-y-4">
    <div class="flex items-center justify-between px-1">
      <h2 class="text-xs font-black text-slate-500 uppercase tracking-[0.2em]">
        <%= @report_type == 'weekly' ? 'ì£¼ê°„' : 'ì›”ê°„' %> ì„±ê³¼ ë³´ë“œ
      </h2>
      <% if @reports.any? %>
        <span class="text-[10px] font-bold text-indigo-400"><%= @reports.first.start_date.strftime("%Y.%m.%d") %> ê¸°ì¤€</span>
      <% end %>
    </div>

    <div class="space-y-3" id="reports-container">
      <% if @reports.any? %>
        <% @reports.each_with_index do |report, index| %>
          <div class="app-glass-card p-5 border-white/5 bg-white/[0.02]">
            <div class="flex items-start justify-between mb-4">
              <div class="flex items-center gap-3">
                <span class="text-xs font-black text-slate-600">#<%= index + 1 %></span>
                <div class="w-8 h-8 rounded-lg bg-white/5 flex items-center justify-center text-white font-black text-[10px]">
                  <%= report.user.nickname[0].upcase %>
                </div>
                <h4 class="text-sm font-black text-white"><%= report.user.nickname %></h4>
              </div>
              <div class="text-right">
                <span class="px-2 py-0.5 rounded-full bg-indigo-500/10 text-indigo-400 text-[9px] font-black uppercase"><%= report.identity_title %></span>
              </div>
            </div>
            
            <div class="grid grid-cols-2 gap-4 text-center">
              <div class="space-y-1">
                <p class="text-[8px] font-black text-slate-500 uppercase tracking-widest leading-none">Record</p>
                <p class="text-lg font-black text-white"><%= report.log_rate.to_i %>%</p>
              </div>
              <div class="space-y-1">
                <p class="text-[8px] font-black text-slate-500 uppercase tracking-widest leading-none">Achievement</p>
                <p class="text-lg font-black text-emerald-400"><%= report.achievement_rate.to_i %>%</p>
              </div>
            </div>

            <!-- Hidden raw text for copy -->
            <div class="hidden share-text" data-nickname="<%= report.user.nickname %>" 
                 data-identity="<%= report.identity_title %>"
                 data-log="<%= report.log_rate.to_i %>"
                 data-achieve="<%= report.achievement_rate.to_i %>"
                 data-summary="<%= report.summary %>"
                 data-cheer="<%= report.cheering_message %>">
            </div>
          </div>
        <% end %>
      <% else %>
        <div class="py-20 text-center app-glass-card border-white/10 border-dashed">
          <p class="text-xs font-bold text-slate-600">í•´ë‹¹ íƒ€ì…ì˜ ë¦¬í¬íŠ¸ê°€ ì•„ì§ ì—†ìŠµë‹ˆë‹¤.</p>
        </div>
      <% end %>
    </div>
  </section>
  
  <!-- Hidden data for header text -->
  <div id="share-header" class="hidden" 
       data-title="[ë£¨íŒŒ í´ëŸ½ <%= @report_type == 'weekly' ? 'ì£¼ê°„' : 'ì›”ê°„' %> ì„±ì·¨ ë¦¬í¬íŠ¸]"
       data-period="<%= @reports.any? ? "#{@reports.first.start_date.strftime('%Y.%m.%d')} ~ #{@reports.first.end_date.strftime('%Y.%m.%d')}" : '' %>">
  </div>
</div>

<script>
  // Simple Stimulus-like helper since we might not have a dedicated compiler for new controllers in this view alone
  document.addEventListener('turbo:load', function() {
    const copyBtn = document.querySelector('[data-action="batch-copy#copyAll"]');
    if (!copyBtn) return;

    copyBtn.addEventListener('click', function() {
      const header = document.getElementById('share-header');
      const reports = document.querySelectorAll('.share-text');
      
      let text = header.dataset.title + "\n";
      text += "(" + header.dataset.period + ")\n\n";
      
      reports.forEach((report, index) => {
        text += (index + 1) + ". " + report.dataset.nickname + "ë‹˜\n";
        text += "- íƒ€ì´í‹€: " + report.dataset.identity + "\n";
        text += "- ê¸°ë¡ë¥ : " + report.dataset.log + "% / ë‹¬ì„±ë¥ : " + report.dataset.achieve + "%\n";
        text += "  ( " + report.dataset.summary + " )\n\n";
      });
      
      text += "âœ¨ ì´ë²ˆ ì£¼ë„ ì •ì§„í•˜ì‹  ë£¨íŒŒ ë©¤ë²„ ì—¬ëŸ¬ë¶„ ê³ ìƒ ë§ìœ¼ì…¨ìŠµë‹ˆë‹¤!\n";
      text += "ë£¨í‹´ íŒŒì¸ë”ìŠ¤ëŠ” ì—¬ëŸ¬ë¶„ì˜ ì„±ì¥ì„ ëê¹Œì§€ ì‘ì›í•©ë‹ˆë‹¤. ğŸ’ª";

      navigator.clipboard.writeText(text).then(() => {
        const originalText = copyBtn.innerHTML;
        copyBtn.classList.replace('bg-emerald-500', 'bg-indigo-600');
        copyBtn.innerHTML = '<span>âœ…</span><span>ì „ì²´ ë³µì‚¬ ì™„ë£Œ!</span>';
        
        setTimeout(() => {
          copyBtn.classList.replace('bg-indigo-600', 'bg-emerald-500');
          copyBtn.innerHTML = originalText;
        }, 2000);
      });
    });
  });
</script>
