<div class="min-h-screen bg-slate-50/30 py-12 px-4" data-controller="challenge-form">
  <div class="max-w-6xl mx-auto">
    <!-- Top Navigation Area -->
    <div class="flex items-center justify-between mb-16">
      <div class="flex items-center gap-6">
        <%= link_to challenges_path, class: "w-12 h-12 rounded-full bg-white border border-slate-100 flex items-center justify-center text-slate-400 hover:text-slate-900 shadow-sm transition-all" do %>
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M15 19l-7-7 7-7"/></svg>
        <% end %>
        <h1 class="text-3xl font-black text-slate-900 tracking-tight">챌린지 설계하기</h1>
      </div>
      
      <!-- Progress Bar & Dots -->
      <div class="flex items-center gap-6">
        <div class="h-1.5 w-24 bg-slate-100 rounded-full overflow-hidden">
          <div class="h-full bg-indigo-600 transition-all duration-700 ease-out" data-challenge-form-target="progressBar" style="width: 20%;"></div>
        </div>
        <div class="flex gap-2">
          <% (1..5).each do |i| %>
            <div class="h-1.5 rounded-full transition-all duration-500 <%= i == 1 ? 'bg-indigo-600 w-6' : 'bg-slate-200 w-2' %>" 
                 data-challenge-form-target="dot"></div>
          <% end %>
        </div>
      </div>
    </div>

    <div class="flex flex-col lg:flex-row gap-16 items-start">
      <!-- Side Step Navigation -->
      <div class="lg:w-64 shrink-0 space-y-8 sticky top-32">
        <% [
          { step: 1, label: "기본 정보", icon: "M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" },
          { step: 2, label: "일정 설정", icon: "M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" },
          { step: 3, label: "인증 방식", icon: "M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" },
          { step: 4, label: "참여 조건", icon: "M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" },
          { step: 5, label: "비용 및 계좌", icon: "M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z" }
        ].each_with_index do |nav, i| %>
          <button type="button" 
                  class="flex items-center gap-5 w-full text-left group" 
                  data-action="click->challenge-form#goToStep" 
                  data-step="<%= nav[:step] %>"
                  data-challenge-form-target="nav">
            <div class="nav-icon w-12 h-12 rounded-2xl flex items-center justify-center transition-all duration-500 <%= i == 0 ? 'bg-indigo-600 text-white shadow-xl shadow-indigo-200' : 'bg-white text-slate-300' %>">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="<%= nav[:icon] %>"/></svg>
            </div>
            <div class="nav-text space-y-0.5 transition-all duration-500 <%= i == 0 ? 'opacity-100' : 'opacity-40 hover:opacity-100' %>">
              <p class="text-[10px] font-black uppercase tracking-widest text-slate-400">Step <%= nav[:step] %></p>
              <p class="font-black text-xl text-slate-900"><%= nav[:label] %></p>
            </div>
          </button>
        <% end %>
      </div>

      <!-- Main Content Card -->
      <div class="flex-1 max-w-3xl">
        <%= form_with model: @challenge, multipart: true, class: "space-y-10", id: "challenge-form-ui" do |f| %>
          <%= f.hidden_field :mode %>
          
          <!-- Step 1: Basic Information -->
          <div class="bg-white rounded-[40px] p-10 lg:p-14 border border-slate-100 shadow-2xl shadow-slate-200/40 space-y-12" data-challenge-form-target="step">
            <div class="space-y-4">
              <label class="text-xs font-black text-slate-400 uppercase tracking-widest pl-2">챌린지 제목</label>
              <%= f.text_field :title, placeholder: "예: 매일 아침 수영 30분 하기", class: "w-full text-2xl font-black p-8 bg-slate-50 border-transparent rounded-[32px] placeholder:text-slate-300 focus:bg-white focus:ring-4 focus:ring-indigo-500/10 transition-all", id: "challenge_title" %>
            </div>

            <div class="bg-indigo-50/50 rounded-[40px] p-10 border border-indigo-100/30 space-y-6">
              <div class="flex items-center gap-3 text-indigo-600">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
                <label class="text-sm font-black uppercase tracking-widest">주최자 소개 커스텀</label>
              </div>
              <p class="text-[11px] text-indigo-400/80 font-bold leading-relaxed px-1">마이페이지에 등록된 소개글이 기본으로 표시됩니다.<br>이 챌린지만을 위한 특별한 소개를 작성해보세요.</p>
              <%= f.text_area :custom_host_bio, placeholder: "매일 아침 6시 기상과 독서를 3년째 이어오고 있는 프로 루틴러입니다. 함께 성장하는 에너지를 나누고 싶어요!", class: "w-full p-8 bg-white border border-indigo-100/50 rounded-3xl text-sm font-bold text-slate-600 focus:ring-4 focus:ring-indigo-500/10 transition-all min-h-[140px] shadow-sm" %>
            </div>

            <div class="space-y-4">
              <label class="text-xs font-black text-slate-400 uppercase tracking-widest pl-2">대표 이미지</label>
              <div class="relative group cursor-pointer aspect-video rounded-[32px] overflow-hidden bg-slate-50 border-2 border-dashed border-slate-200 flex flex-col items-center justify-center gap-4 hover:border-indigo-400 transition-all">
                <%= f.file_field :thumbnail_image, class: "absolute inset-0 opacity-0 cursor-pointer z-10", data: { action: "change->challenge-form#previewThumbnail" } %>
                <img src="" class="absolute inset-0 w-full h-full object-cover hidden" data-challenge-form-target="thumbnailPreview">
                <div class="text-center space-y-3" id="thumbnail-placeholder">
                  <div class="w-16 h-16 bg-white rounded-3xl flex items-center justify-center text-slate-300 mx-auto shadow-sm group-hover:text-indigo-500 transition-colors">
                    <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
                  </div>
                  <p class="text-xs font-black text-slate-400">클릭하여 챌린지를 대표하는 사진 업로드</p>
                </div>
              </div>
            </div>

            <div class="space-y-4">
              <label class="text-xs font-black text-slate-400 uppercase tracking-widest pl-2">한 줄 요약</label>
              <%= f.text_field :summary, placeholder: "이 챌린지를 한 마디로 정의한다면?", class: "w-full p-6 bg-slate-50 border-transparent rounded-[24px] font-bold text-slate-900 placeholder:text-slate-300 focus:bg-white focus:ring-4 focus:ring-indigo-500/10 transition-all" %>
            </div>

            <!-- Also keep the full description if needed, hidden or visible? The user said "모든 페이지 내용은 그대로 냅두고" but Design 1 doesn't show it. I will keep it but style it nicely. Actually, let's put it before thumbnail like Design 1 implies headers for title/intro/thumbnail -->
            <div class="space-y-4">
              <label class="text-xs font-black text-slate-400 uppercase tracking-widest pl-2">상세 내역 소개</label>
              <%= f.text_area :description, placeholder: "참여자들에게 챌린지의 목적, 방법, 팁 등을 상세히 공유하세요.", class: "w-full p-8 bg-slate-50 border-transparent rounded-[32px] font-bold text-slate-700 placeholder:text-slate-300 focus:bg-white focus:ring-4 focus:ring-indigo-500/10 transition-all min-h-[200px]" %>
            </div>

            <div class="pt-6">
              <button type="button" data-action="click->challenge-form#next" class="w-full py-7 bg-indigo-600 text-white rounded-[32px] font-black text-xl shadow-2xl shadow-indigo-600/30 hover:bg-indigo-700 transition-all flex items-center justify-center gap-3">
                다음 단계
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M9 5l7 7-7 7"/></svg>
              </button>
            </div>
          </div>

          <!-- Step 2: Schedule Info -->
          <div class="bg-white rounded-[40px] p-10 lg:p-14 border border-slate-100 shadow-2xl shadow-slate-200/40 space-y-12 hidden" data-challenge-form-target="step">
            <div class="grid grid-cols-2 gap-8">
              <div class="space-y-4">
                <label class="text-[11px] font-black text-slate-400 uppercase tracking-widest pl-2">시작일</label>
                <div class="relative">
                  <%= f.date_field :start_date, value: Date.current, class: "w-full p-6 bg-slate-50 border-transparent rounded-3xl font-black text-lg text-slate-900 focus:bg-white focus:ring-4 focus:ring-indigo-500/10 transition-all appearance-none", id: "challenge_start_date" %>
                  <svg class="w-5 h-5 absolute right-6 top-1/2 -translate-y-1/2 text-slate-300 pointer-events-none" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
                </div>
              </div>
              <div class="space-y-4">
                <label class="text-[11px] font-black text-slate-400 uppercase tracking-widest pl-2">종료일</label>
                <div class="relative">
                  <%= f.date_field :end_date, value: Date.current + 7.days, class: "w-full p-6 bg-slate-50 border-transparent rounded-3xl font-black text-lg text-slate-900 focus:bg-white focus:ring-4 focus:ring-indigo-500/10 transition-all appearance-none", id: "challenge_end_date" %>
                  <svg class="w-5 h-5 absolute right-6 top-1/2 -translate-y-1/2 text-slate-300 pointer-events-none" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
                </div>
              </div>
            </div>

            <div class="space-y-6">
              <label class="text-[11px] font-black text-slate-400 uppercase tracking-widest pl-2">인증 빈도 설정</label>
              <div class="grid grid-cols-2 gap-6" data-option-group>
                <button type="button" 
                        data-action="click->challenge-form#selectOption" 
                        data-name="mission_frequency" 
                        data-value="daily"
                        class="p-8 bg-indigo-50 border-2 border-indigo-600 rounded-[32px] font-black text-lg text-indigo-600 shadow-lg shadow-indigo-600/5 transition-all" data-name="mission_frequency" data-value="daily">
                  매일 인증
                </button>
                <button type="button" 
                        data-action="click->challenge-form#selectOption" 
                        data-name="mission_frequency" 
                        data-value="weekly_n"
                        class="p-8 bg-white border-2 border-slate-100 rounded-[32px] font-black text-lg text-slate-400 hover:border-slate-200 transition-all" data-name="mission_frequency" data-value="weekly_n">
                  주별 인증
                </button>
                <%= f.hidden_field :mission_frequency, value: "daily" %>
              </div>
            </div>

            <div class="bg-slate-50/50 rounded-[40px] p-10 space-y-6">
              <p class="text-[13px] font-black text-slate-900">인증 요일을 선택하세요</p>
              <div class="flex flex-wrap gap-4 pt-2">
                <% ["월", "화", "수", "목", "금", "토", "일"].each do |day| %>
                  <button type="button" 
                          data-day="<%= day %>"
                          data-action="click->challenge-form#toggleDay"
                          class="w-14 h-14 rounded-2xl bg-indigo-600 text-white font-black text-lg flex items-center justify-center shadow-xl shadow-indigo-600/20 transition-all duration-300 transform active:scale-95">
                    <%= day %>
                  </button>
                  <%= checkbox_tag "challenge[days][]", day, true, id: "day_#{day}", class: "sr-only" %>
                <% end %>
              </div>
            </div>

            <div class="flex items-center gap-6 pt-6">
              <button type="button" data-action="click->challenge-form#prev" class="px-10 py-7 bg-slate-100 text-slate-400 rounded-3xl font-black text-lg hover:bg-slate-200 transition-all">이전 단계</button>
              <button type="button" data-action="click->challenge-form#next" class="flex-1 py-7 bg-indigo-600 text-white rounded-[32px] font-black text-xl shadow-2xl shadow-indigo-600/30 hover:bg-indigo-700 transition-all flex items-center justify-center gap-3">
                다음 단계
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M9 5l7 7-7 7"/></svg>
              </button>
            </div>
          </div>

          <!-- Step 3: Verification Method -->
          <div class="bg-white rounded-[40px] p-10 lg:p-14 border border-slate-100 shadow-2xl shadow-slate-200/40 space-y-12 hidden" data-challenge-form-target="step">
            <div class="space-y-6">
              <label class="text-[11px] font-black text-slate-400 uppercase tracking-widest pl-2">인증 유형</label>
              <div class="grid grid-cols-2 gap-6">
                <% [
                  { id: "photo", label: "Photo", desc: "사진 업로드 인증", icon: "M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" },
                  { id: "simple", label: "Simple", desc: "버튼 클릭 인증", icon: "M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" },
                  { id: "metric", label: "Metric", desc: "수치 입력 인증", icon: "M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2" },
                  { id: "url", label: "URL", desc: "링크 제출 인증", icon: "M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101" }
                ].each do |type| %>
                  <button type="button" 
                          data-action="click->challenge-form#toggleVerificationType" 
                          data-type="<%= type[:id] %>"
                          class="p-8 border-2 <%= type[:id] == 'photo' ? 'border-indigo-600 bg-indigo-50 shadow-lg shadow-indigo-600/5' : 'border-transparent bg-white shadow-sm ring-1 ring-slate-100' %> rounded-[32px] flex items-center gap-6 group hover:ring-indigo-100 transition-all text-left">
                    <div class="verif-icon-box w-14 h-14 rounded-2xl <%= type[:id] == 'photo' ? 'bg-indigo-600 text-white' : 'bg-slate-50 text-slate-300' %> flex items-center justify-center shrink-0 transition-all duration-300">
                      <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="<%= type[:icon] %>"/></svg>
                    </div>
                    <div>
                      <p class="font-black text-xl text-slate-900 group-hover:text-indigo-600 transition-colors"><%= type[:label] %></p>
                      <p class="text-[11px] font-bold text-slate-400 mt-1"><%= type[:desc] %></p>
                    </div>
                  </button>
                  <%= f.hidden_field "v_#{type[:id]}", value: (type[:id] == 'photo' ? "1" : "0"), id: "challenge_v_#{type[:id]}" %>
                <% end %>
              </div>
            </div>

            <div class="space-y-6">
              <label class="text-[11px] font-black text-slate-400 uppercase tracking-widest pl-2">인증 가능 시간대 설정</label>
              <div class="flex items-center gap-6">
                <div class="flex-1 relative">
                  <%= f.time_field :verification_start_time, value: "00:00", class: "w-full p-6 bg-slate-50 border-transparent rounded-[24px] font-black text-xl text-center focus:bg-white focus:ring-4 focus:ring-indigo-500/10 transition-all appearance-none" %>
                  <svg class="w-5 h-5 absolute right-6 top-1/2 -translate-y-1/2 text-slate-300 pointer-events-none" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                </div>
                <span class="text-slate-200 font-bold">~</span>
                <div class="flex-1 relative">
                  <%= f.time_field :verification_end_time, value: "23:59", class: "w-full p-6 bg-slate-50 border-transparent rounded-[24px] font-black text-xl text-center focus:bg-white focus:ring-4 focus:ring-indigo-500/10 transition-all appearance-none" %>
                  <svg class="w-5 h-5 absolute right-6 top-1/2 -translate-y-1/2 text-slate-300 pointer-events-none" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                </div>
              </div>
            </div>

            <div class="space-y-4">
              <label class="p-8 bg-slate-50 rounded-[32px] flex items-center justify-between cursor-pointer group transition-all hover:bg-white ring-1 ring-slate-100 hover:ring-indigo-100">
                <div class="flex items-center gap-5">
                  <div class="w-12 h-12 rounded-2xl bg-white flex items-center justify-center text-indigo-500 shadow-sm ring-1 ring-slate-100 group-hover:bg-indigo-600 group-hover:text-white transition-all duration-500">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg>
                  </div>
                  <div>
                    <p class="font-black text-lg text-slate-900">재인증 허용 여부</p>
                    <p class="text-xs font-bold text-slate-400 mt-0.5">실패 시 다시 시도 가능</p>
                  </div>
                </div>
                <div class="relative inline-flex items-center">
                  <%= f.check_box :re_verification_allowed, class: "sr-only peer" %>
                  <div class="w-14 h-8 bg-slate-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-1 after:left-1 after:bg-white after:border-slate-300 after:border after:rounded-full after:h-6 after:w-6 after:transition-all peer-checked:bg-indigo-600 shadow-inner"></div>
                </div>
              </label>

              <label class="p-8 bg-slate-50 rounded-[32px] flex items-center justify-between cursor-pointer group transition-all hover:bg-white ring-1 ring-slate-100 hover:ring-amber-100">
                <div class="flex items-center gap-5">
                  <div class="w-12 h-12 rounded-2xl bg-white flex items-center justify-center text-amber-500 shadow-sm ring-1 ring-slate-100 group-hover:bg-amber-500 group-hover:text-white transition-all duration-500">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg>
                  </div>
                  <div>
                    <p class="font-black text-lg text-slate-900">인증 승인제</p>
                    <p class="text-xs font-bold text-slate-400 mt-0.5">호스트 직접 개별 승인</p>
                  </div>
                </div>
                <div class="relative inline-flex items-center">
                  <%= f.check_box :mission_requires_host_approval, class: "sr-only peer" %>
                  <div class="w-14 h-8 bg-slate-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-1 after:left-1 after:bg-white after:border-slate-300 after:border after:rounded-full after:h-6 after:w-6 after:transition-all peer-checked:bg-amber-500 shadow-inner"></div>
                </div>
              </label>
            </div>

            <div class="flex items-center gap-6 pt-6">
              <button type="button" data-action="click->challenge-form#prev" class="px-10 py-7 bg-slate-100 text-slate-400 rounded-3xl font-black text-lg hover:bg-slate-200 transition-all">이전 단계</button>
              <button type="button" data-action="click->challenge-form#next" class="flex-1 py-7 bg-indigo-600 text-white rounded-[32px] font-black text-xl shadow-2xl shadow-indigo-600/30 hover:bg-indigo-700 transition-all flex items-center justify-center gap-3">
                다음 단계
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M9 5l7 7-7 7"/></svg>
              </button>
            </div>
          </div>

          <!-- Step 4: Participation Conditions -->
          <div class="bg-white rounded-[40px] p-10 lg:p-14 border border-slate-100 shadow-2xl shadow-slate-200/40 space-y-12 hidden" data-challenge-form-target="step">
            <div class="grid grid-cols-2 gap-8" data-option-group>
              <button type="button" 
                      data-action="click->challenge-form#selectOption" 
                      data-name="is_private" 
                      data-value="false"
                      class="p-12 border-2 border-indigo-600 bg-indigo-50 rounded-[48px] text-center space-y-6 shadow-xl shadow-indigo-600/10 transition-all group" data-name="is_private" data-value="false">
                <div class="option-icon text-indigo-600 mx-auto transform transition-all group-hover:scale-110">
                  <svg class="w-14 h-14 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 11V7a4 4 0 118 0m-4 8v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2z"/></svg>
                </div>
                <div>
                  <p class="font-black text-2xl text-slate-900">공개 챌린지</p>
                  <p class="text-[13px] font-bold text-slate-400 mt-2">모두 참여 가능</p>
                </div>
              </button>
              <button type="button" 
                      data-action="click->challenge-form#selectOption" 
                      data-name="is_private" 
                      data-value="true"
                      class="p-12 border-2 border-slate-100 bg-white rounded-[48px] text-center space-y-6 hover:border-indigo-200 transition-all group" data-name="is_private" data-value="true">
                <div class="option-icon text-slate-300 mx-auto transform transition-all group-hover:scale-110 group-hover:text-indigo-400">
                  <svg class="w-14 h-14 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2z"/></svg>
                </div>
                <div>
                  <p class="font-black text-2xl text-slate-900 opacity-40 group-hover:opacity-100 transition-opacity">비공개 챌린지</p>
                  <p class="text-[13px] font-bold text-slate-300 mt-2">초대 코드 전용</p>
                </div>
              </button>
              <%= f.hidden_field :is_private, value: false %>
            </div>

            <div class="space-y-4 hidden" data-challenge-form-target="invitationCodeSection">
              <div class="p-8 bg-amber-50 rounded-[32px] border border-amber-200 flex items-center justify-between shadow-inner">
                <div>
                  <p class="text-[10px] font-black text-amber-600 uppercase tracking-widest">생성된 초대 코드</p>
                  <p class="text-3xl font-black text-slate-900 tracking-wider mt-1" id="invitation_code_display">-</p>
                </div>
                <div class="w-16 h-16 bg-white rounded-2xl flex items-center justify-center text-amber-500 shadow-sm ring-1 ring-amber-100">
                  <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"/></svg>
                </div>
              </div>
              <%= f.hidden_field :invitation_code, id: "challenge_invitation_code" %>
            </div>

            <div class="space-y-6">
              <label class="text-[11px] font-black text-slate-400 uppercase tracking-widest pl-2">참여 신청 방식</label>
              <div class="grid grid-cols-2 gap-4" data-option-group>
                <button type="button" data-action="click->challenge-form#selectOption" data-name="admission_type" data-value="first_come" class="p-7 border-2 border-indigo-600 bg-indigo-50 rounded-[28px] font-black text-lg text-indigo-600 flex items-center justify-center gap-3 shadow-lg shadow-indigo-600/5 transition-all" data-name="admission_type" data-value="first_come">
                  <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
                  선착순 입장
                </button>
                <button type="button" data-action="click->challenge-form#selectOption" data-name="admission_type" data-value="approval" class="p-7 border-2 border-transparent bg-white shadow-sm ring-1 ring-slate-100 rounded-[28px] font-black text-lg text-slate-400 flex items-center justify-center gap-3 hover:ring-indigo-200 transition-all" data-name="admission_type" data-value="approval">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
                  호스트 승인제
                </button>
                <%= f.hidden_field :admission_type, value: "first_come" %>
              </div>
            </div>

            <div class="space-y-8">
              <div class="flex items-center justify-between pl-2">
                <label class="text-[11px] font-black text-slate-400 uppercase tracking-widest">최대 참여 인원</label>
                <span id="max-participants-display" class="text-2xl font-black text-indigo-600 bg-indigo-50 px-6 py-2 rounded-2xl ring-1 ring-indigo-100">10명</span>
              </div>
              <div class="px-2">
                <%= f.range_field :max_participants, min: 2, max: 100, step: 1, value: 10, 
                    class: "w-full h-2.5 bg-slate-100 rounded-full appearance-none cursor-pointer accent-indigo-600 shadow-inner",
                    data: { action: "input->challenge-form#updateMaxParticipants" } %>
              </div>
            </div>

            <div class="flex items-center gap-6 pt-6">
              <button type="button" data-action="click->challenge-form#prev" class="px-10 py-7 bg-slate-100 text-slate-400 rounded-3xl font-black text-lg hover:bg-slate-200 transition-all">이전 단계</button>
              <button type="button" data-action="click->challenge-form#next" class="flex-1 py-7 bg-indigo-600 text-white rounded-[32px] font-black text-xl shadow-2xl shadow-indigo-600/30 hover:bg-indigo-700 transition-all flex items-center justify-center gap-3">
                다음 단계
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M9 5l7 7-7 7"/></svg>
              </button>
            </div>
          </div>

          <!-- Step 5: Cost & Account -->
          <div class="bg-white rounded-[40px] p-10 lg:p-14 border border-slate-100 shadow-2xl shadow-slate-200/40 space-y-12 hidden" data-challenge-form-target="step">
            <div class="grid grid-cols-3 gap-6" data-option-group>
              <% [
                  { id: "free", label: "무료", icon: "M13 10V3L4 14h7v7l9-11h-7z" },
                  { id: "fee", label: "참가비", icon: "M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2" },
                  { id: "deposit", label: "보증금", icon: "M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z" }
              ].each_with_index do |cost, i| %>
                  <button type="button" 
                          data-action="click->challenge-form#toggleCostType" 
                          data-type="<%= cost[:id] %>"
                          class="cost-type-btn p-10 border-2 <%= i == 2 ? 'border-indigo-600 bg-indigo-50 shadow-xl shadow-indigo-600/5' : 'border-transparent bg-white shadow-sm ring-1 ring-slate-100' %> rounded-[40px] text-center space-y-4 transition-all group">
                    <div class="<%= i == 2 ? 'text-indigo-600' : 'text-slate-300' %> group-hover:text-indigo-600 transition-colors">
                      <svg class="w-10 h-10 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="<%= cost[:icon] %>"/></svg>
                    </div>
                    <p class="font-black text-lg <%= i == 2 ? 'text-slate-900' : 'text-slate-400' %> group-hover:text-slate-900"><%= cost[:label] %></p>
                  </button>
              <% end %>
              <%= f.hidden_field :cost_type, value: "deposit" %>
            </div>

            <div class="space-y-10" data-challenge-form-target="costFields">
              <div class="space-y-4">
                <label class="text-[11px] font-black text-slate-400 uppercase tracking-widest pl-2">금액 설정</label>
                <div class="flex items-center gap-6 p-8 bg-slate-50/50 rounded-[32px] border border-transparent focus-within:bg-white focus-within:border-indigo-500 transition-all shadow-inner">
                  <%= f.number_field :amount, value: 10000, class: "flex-1 text-5xl font-black p-0 border-none bg-transparent focus:ring-0 placeholder:text-slate-100", id: "challenge_amount" %>
                  <span class="text-4xl font-black text-slate-900">원</span>
                </div>
              </div>

              <div class="p-10 bg-indigo-50/30 rounded-[48px] border border-indigo-100/30 space-y-8" data-challenge-form-target="accountFields">
                <div class="flex items-center justify-between">
                  <div class="flex items-center gap-3 text-indigo-900">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/></svg>
                    <p class="font-black">입금 받을 계좌 정보</p>
                  </div>
                  <% if @has_saved_account %>
                    <button type="button" 
                            data-action="click->challenge-form#loadSavedAccount" 
                            data-bank="<%= @saved_account[:bank_name] %>"
                            data-account="<%= @saved_account[:account_number] %>"
                            data-holder="<%= @saved_account[:account_holder] %>"
                            class="px-5 py-2.5 bg-white rounded-2xl text-[11px] font-black text-indigo-600 border border-indigo-100 shadow-sm flex items-center gap-2 hover:bg-indigo-50 transition-all">
                      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>
                      불러오기
                    </button>
                  <% end %>
                </div>

                <div class="space-y-4">
                  <%= f.text_field :host_bank, placeholder: "은행명 (예: 신한은행)", data: { challenge_form_target: "bankName" }, class: "w-full p-6 bg-white border border-indigo-100 shadow-sm rounded-3xl font-bold placeholder:text-slate-200 focus:ring-4 focus:ring-indigo-500/10 transition-all" %>
                  <%= f.text_field :host_account, placeholder: "계좌번호 (- 포함)", data: { challenge_form_target: "accountNumber" }, class: "w-full p-6 bg-white border border-indigo-100 shadow-sm rounded-3xl font-bold placeholder:text-slate-200 focus:ring-4 focus:ring-indigo-500/10 transition-all" %>
                  <%= f.text_field :host_account_holder, placeholder: "예금주 성함", data: { challenge_form_target: "accountHolder" }, class: "w-full p-6 bg-white border border-indigo-100 shadow-sm rounded-3xl font-bold placeholder:text-slate-200 focus:ring-4 focus:ring-indigo-500/10 transition-all" %>
                </div>

                <div class="flex items-start gap-3 p-6 bg-white/40 rounded-3xl border border-indigo-100/20">
                  <svg class="w-5 h-5 text-indigo-400 shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                  <p class="text-[11px] font-bold text-indigo-900/40 leading-relaxed">참가자가 직접 이 계좌로 송금한 후, 호스트님이 입금 확인을 거쳐 최종 승인하는 방식입니다. 정확한 정보를 입력해주세요.</p>
                </div>

                <div class="flex items-center gap-2 px-2">
                  <%= f.check_box :save_account_to_profile, class: "w-5 h-5 text-indigo-600 border-slate-300 rounded-lg focus:ring-indigo-500 transition-all" %>
                  <label class="text-xs font-bold text-indigo-900/60">이 계좌 정보를 내 프로필에 자동 저장</label>
                </div>
              </div>

              <div class="grid grid-cols-2 gap-8" data-challenge-form-target="penaltyFields">
                <div class="bg-indigo-50/50 rounded-[40px] p-10 border border-indigo-100/30 space-y-4 shadow-inner">
                  <label class="text-[10px] font-black text-indigo-600 uppercase tracking-widest pl-1">1회 실패 시 차감액</label>
                  <div class="flex items-center gap-3">
                    <%= f.number_field :penalty_per_failure, value: 2000, class: "flex-1 text-4xl font-black p-0 border-none bg-transparent focus:ring-0 text-indigo-600" %>
                    <span class="text-2xl font-black text-indigo-600">원</span>
                  </div>
                </div>
                <div class="bg-slate-50/50 rounded-[40px] p-10 border border-transparent space-y-4 shadow-inner">
                  <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest pl-1">최대 실패 허용 횟수</label>
                  <%= f.select :failure_tolerance, (0..10).map { |n| ["#{n}회", n] }, { selected: 2 }, class: "w-full bg-transparent border-none p-0 font-black text-2xl text-slate-900 focus:ring-0 cursor-pointer" %>
                </div>
              </div>
            </div>

            <div class="flex items-center gap-6 pt-6">
              <button type="button" data-action="click->challenge-form#prev" class="px-10 py-7 bg-slate-100 text-slate-400 rounded-3xl font-black text-lg hover:bg-slate-200 transition-all">이전 단계</button>
              <button type="button" data-action="click->challenge-form#showSummary" class="flex-1 py-7 bg-indigo-600 text-white rounded-[32px] font-black text-2xl shadow-2xl shadow-indigo-600/30 hover:bg-indigo-700 transition-all flex items-center justify-center gap-3">
                설계 완료
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"/></svg>
              </button>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  </div>

  <!-- Summary Confirmation Modal -->
  <div class="fixed inset-0 z-[100] hidden bg-slate-900/60 backdrop-blur-sm items-center justify-center p-6" data-challenge-form-target="summaryModal">
    <div class="bg-white rounded-[48px] p-12 max-w-sm w-full shadow-2xl space-y-10 transform transition-all duration-300 scale-95 opacity-0 group-[.flex]:scale-100 group-[.flex]:opacity-100">
      <div class="text-center space-y-4">
        <div class="w-20 h-20 bg-indigo-100 text-indigo-600 rounded-[32px] flex items-center justify-center mx-auto shadow-sm ring-1 ring-indigo-50">
          <svg class="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"/></svg>
        </div>
        <div class="space-y-1">
          <h2 class="text-2xl font-black text-slate-900">챌린지 개설 요약</h2>
          <p class="text-sm font-bold text-slate-300">거의 다 왔어요! 마지막으로 확인해주세요.</p>
        </div>
      </div>

      <div data-challenge-form-target="summaryContent" class="space-y-2">
        <!-- Content will be injected via JS -->
      </div>

      <div class="flex flex-col gap-4">
        <button type="button" data-action="click->challenge-form#submitForm" class="w-full py-5 bg-indigo-600 text-white rounded-3xl font-black text-lg shadow-xl shadow-indigo-600/30 hover:bg-indigo-700 transition-all active:scale-95">네, 개설할게요!</button>
        <button type="button" data-action="click->challenge-form#hideSummary" class="w-full py-5 bg-slate-50 text-slate-400 rounded-3xl font-black text-lg border border-slate-100 hover:bg-slate-100 transition-all">수정할 게 있어요</button>
      </div>
    </div>
  </div>
</div>

<style>
  input[type='range'] {
    background: linear-gradient(to right, #4f46e5 0%, #4f46e5 10%, #f1f5f9 10%, #f1f5f9 100%);
    background-size: 10% 100%;
    background-repeat: no-repeat;
  }
  input[type='range']::-webkit-slider-runnable-track {
    -webkit-appearance: none;
    box-shadow: none;
    border: none;
    background: transparent;
  }
</style>
