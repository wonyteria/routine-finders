<div data-controller="tabs" 
     data-tabs-active-class="bg-slate-900 text-white shadow-md ring-1 ring-slate-900" 
     data-tabs-inactive-class="text-slate-500 hover:bg-slate-100/80 hover:text-slate-900"
     class="max-w-7xl mx-auto pb-20 px-4 md:px-6">
  
  <!-- Navigation: Back to Home -->
  <div class="pt-8 mb-4">
    <%= link_to root_path, class: "inline-flex items-center gap-2 px-4 py-2 bg-white border border-slate-200 rounded-xl text-slate-500 hover:text-indigo-600 hover:border-indigo-100 hover:bg-indigo-50 transition-all shadow-sm group" do %>
      <i data-feather="chevron-left" class="w-4 h-4 group-hover:-translate-x-0.5 transition-transform"></i>
      <span class="text-[11px] font-black uppercase tracking-widest">ÌôàÏúºÎ°ú Í∞ÄÍ∏∞</span>
    <% end %>
  </div>

  <!-- Header & Tabs -->
  <div class="flex flex-col md:flex-row md:items-center justify-between gap-6 mb-8">
    <div class="space-y-1">
      <div class="flex items-center gap-2">
        <span class="w-2 h-2 rounded-full bg-indigo-500"></span>
        <p class="text-[10px] md:text-xs font-bold text-slate-500 uppercase tracking-widest">Routine Insight</p>
      </div>
      <h2 class="text-2xl md:text-3xl font-black text-slate-900 tracking-tight">ÏÑ±Ï∑® Î∂ÑÏÑù Î¶¨Ìè¨Ìä∏</h2>
    </div>
    
    <!-- Tab Switcher -->
    <div class="bg-slate-100/50 p-1 rounded-xl flex items-center gap-1">
      <button data-tabs-target="tab" data-id="overview" data-action="click->tabs#change"
              class="px-4 py-2 rounded-lg text-xs font-bold transition-all tracking-tight whitespace-nowrap">OVERVIEW</button>
      <button data-tabs-target="tab" data-id="finance" data-action="click->tabs#change"
              class="px-4 py-2 rounded-lg text-xs font-bold transition-all tracking-tight whitespace-nowrap">FINANCE</button>
      <button data-tabs-target="tab" data-id="social" data-action="click->tabs#change"
              class="px-4 py-2 rounded-lg text-xs font-bold transition-all tracking-tight whitespace-nowrap">SOCIAL</button>
    </div>
  </div>

  <%
    total_activities = (@activity_data || {}).values.sum
    
    # Calculate Completion Rate
    avg_completion = @participations.any? ? (@participations.sum(&:completion_rate) / @participations.size * 100).to_i : 0
    
    # Calculate Unified Streak
    all_activity_dates = (@activity_data || {}).keys.sort.reverse
    
    current_streak = 0
    if all_activity_dates.any?
      check_date = Date.current
      if (@activity_data || {})[check_date].to_i > 0 || (@activity_data || {})[check_date - 1.day].to_i > 0
        curr = (@activity_data || {})[check_date].to_i > 0 ? check_date : check_date - 1.day
        while (@activity_data || {})[curr].to_i > 0
          current_streak += 1
          curr -= 1.day
        end
      end
    end

    max_streak = @participations.map(&:max_streak).max.to_i
    badge_count = @current_user.badges.count
    
    # Logs for mini-matrices - split by type
    # For simplicity in the report, we can use the aggregated @activity_data for both or split them if needed.
    # The existing code split them: c_logs, r_logs.
    # Let's keep a split version for the mini-matrices if possible.
    c_logs = VerificationLog.joins(participant: :user).where(users: { id: @current_user.id }).where(created_at: 1.month.ago..Time.current).map { |l| l.created_at.to_date }.uniq
    r_logs = (PersonalRoutineCompletion.joins(:personal_routine).where(personal_routines: { user_id: @current_user.id }).where(completed_on: 1.month.ago..Date.current).map(&:completed_on) + 
             RoutineClubAttendance.joins(:routine_club_member).where(routine_club_members: { user_id: @current_user.id }).where(attendance_date: 1.month.ago..Date.current).map(&:attendance_date)).uniq
  %>

  <div class="relative min-h-[500px]">
    <!-- OVERVIEW PANEL -->
    <div data-tabs-target="panel" data-id="overview" class="space-y-6">
      <!-- Top Stats Bento Grid -->
      <div class="grid grid-cols-2 lg:grid-cols-4 gap-3 lg:gap-4">
        <% [
          { icon: "bar-chart-2", title: "ÎàÑÏ†Å ÌôúÎèô", value: "#{total_activities}Ìöå", sub: "All-time", color: "indigo", tip: "Ï±åÎ¶∞ÏßÄ, Î£®Ìã¥, ÌÅ¥ÎüΩ ÌôúÎèôÏùò Ï¥ùÌï©ÏûÖÎãàÎã§." },
          { icon: "target", title: "ÌèâÍ∑† Îã¨ÏÑ±Î•†", value: "#{avg_completion}%", sub: "Challenges", color: "emerald", tip: "Ï∞∏Ïó¨ Ï§ëÏù∏ Î™®Îì† Ï±åÎ¶∞ÏßÄÏùò ÌèâÍ∑† ÏÑ±Ï∑®ÎèÑÏûÖÎãàÎã§." },
          { icon: "zap", title: "ÏµúÎåÄ Ïä§Ìä∏Î¶≠", value: "#{max_streak}Ïùº", sub: "Personal Best", color: "orange", tip: "Ïó≠ÎåÄ Í∞ÄÏû• Í∏∏ÏóàÎçò Ïó∞ÏÜç Îã¨ÏÑ± Í∏∞Î°ùÏûÖÎãàÎã§." },
          { icon: "award", title: "Î≥¥Ïú† Î∞∞ÏßÄ", value: "#{badge_count}Í∞ú", sub: "Collection", color: "purple", tip: "Î™©Ìëú Îã¨ÏÑ±ÏúºÎ°ú ÌöçÎìùÌïú ÌõàÏû•Îì§Ïùò Ï¥ùÌï©ÏûÖÎãàÎã§." }
        ].each do |item| %>
          <div class="bg-white p-5 rounded-2xl border border-slate-100 shadow-sm transition-all hover:shadow-md group relative overflow-hidden">
            <div class="absolute top-0 right-0 p-4 opacity-0 group-hover:opacity-10 transition-opacity">
              <div class="w-16 h-16 bg-<%= item[:color] %>-500 rounded-full blur-xl"></div>
            </div>
            <div class="flex flex-col h-full justify-between gap-3 relative z-10">
              <div class="flex items-center justify-between">
                <div class="w-8 h-8 rounded-lg bg-<%= item[:color] %>-50 text-<%= item[:color] %>-600 flex items-center justify-center">
                  <i data-feather="<%= item[:icon] %>" class="w-4 h-4"></i>
                </div>
                <div class="px-2 py-0.5 rounded-full bg-slate-50 border border-slate-100 text-[10px] font-bold text-slate-500">
                  <%= item[:sub] %>
                </div>
              </div>
              <div>
                <p class="text-[11px] font-bold text-slate-400 uppercase tracking-wider mb-0.5"><%= item[:title] %></p>
                <h4 class="text-2xl font-black text-slate-900 tracking-tight"><%= item[:value] %></h4>
              </div>
            </div>
          </div>
        <% end %>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 lg:gap-6">
        <!-- Weekly Trend Chart -->
        <div class="bg-white rounded-2xl border border-slate-100 shadow-sm p-5 flex flex-col justify-between overflow-hidden relative group h-full">
          <!-- Background Deco -->
          <div class="absolute top-0 right-0 w-24 h-24 bg-indigo-50/50 rounded-bl-full -mr-6 -mt-6 transition-transform group-hover:scale-110"></div>
          
          <div class="space-y-1 relative z-10">
            <div class="flex items-center gap-2 mb-0.5">
              <span class="w-1.5 h-1.5 rounded-full bg-indigo-500"></span>
              <h4 class="text-sm font-bold text-slate-900">Ï£ºÍ∞Ñ Ìä∏Î†åÎìú</h4>
            </div>
            <p class="text-[10px] text-slate-400 font-medium tracking-tight">ÏßÄÎÇú 7ÏùºÍ∞ÑÏùò ÏÑ±Ï∑® ÌùêÎ¶Ñ</p>
          </div>
          
          <div class="flex items-end justify-between h-24 mt-4 gap-2 px-1">
            <% 
              weekly_stats = (0..6).map do |i|
                date = Date.current - i.days
                count = (@activity_data || {})[date] || 0
                { count: count, day: date.strftime("%a")[0], date: date }
              end.reverse
              max_daily = [weekly_stats.map { |s| s[:count] }.max, 1].max
            %>
            <% weekly_stats.each_with_index do |stat, i| %>
              <div class="flex-1 flex flex-col justify-end group/bar h-full cursor-pointer relative">
                <div class="w-full bg-slate-100 rounded-t-sm relative overflow-hidden transition-all duration-500 group-hover/bar:bg-indigo-50" style="height: <%= (stat[:count].to_f / max_daily * 100).to_i %>%">
                  <div class="absolute bottom-0 left-0 w-full h-full <%= i == 6 ? 'bg-indigo-600' : 'bg-indigo-400' %> opacity-90 group-hover/bar:bg-indigo-600 transition-colors"></div>
                </div>
                <!-- Tooltip -->
                <div class="absolute -top-6 left-1/2 -translate-x-1/2 bg-slate-800 text-white text-[9px] font-bold py-0.5 px-1.5 rounded opacity-0 group-hover/bar:opacity-100 transition-opacity whitespace-nowrap pointer-events-none z-10">
                   <%= stat[:count] %> activities
                </div>
              </div>
            <% end %>
          </div>
          <div class="flex justify-between px-1 mt-2 text-[9px] font-bold text-slate-300 uppercase tracking-widest text-center">
            <% weekly_stats.each do |stat| %>
              <span class="flex-1 <%= 'text-indigo-500 font-black' if stat[:date] == Date.current %>"><%= stat[:day] %></span>
            <% end %>
          </div>
        </div>

        <!-- Routine Timing Analysis (New) -->
        <div class="bg-white rounded-2xl border border-slate-100 shadow-sm p-5 space-y-4">
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-2">
              <div class="p-1 bg-indigo-50 text-indigo-500 rounded-md">
                <i data-feather="clock" class="w-3.5 h-3.5"></i>
              </div>
              <h4 class="text-sm font-bold text-slate-900">Î£®Ìã¥ ÏßëÏ§ë ÏãúÍ∞Ñ</h4>
            </div>
            <% 
              peak_hour = @routine_time_stats&.max_by { |k, v| v }&.first
              peak_time = case peak_hour
                when 5..10 then "ÏïÑÏπ®Ìòï"
                when 11..16 then "Ïò§ÌõÑÌòï"
                when 17..22 then "Ï†ÄÎÖÅÌòï"
                else "Ïã¨ÏïºÌòï"
              end if peak_hour
            %>
            <% if peak_time %>
              <span class="text-[10px] font-black text-indigo-500 bg-indigo-50 px-2 py-0.5 rounded-full"><%= peak_time %></span>
            <% end %>
          </div>

          <div class="flex items-end h-24 gap-1 px-1">
            <% 
              max_count = [@routine_time_stats&.values&.max || 0, 1].max
              # Group into 4-hour blocks for better visualization if needed, but let's try 24 bars first
            %>
            <% (0..23).each do |hour| %>
              <% count = @routine_time_stats[hour] || 0 %>
              <div class="flex-1 bg-slate-100 rounded-t-[1px] relative group/time" style="height: <%= (count.to_f / max_count * 100).to_i %>%">
                <div class="absolute inset-0 bg-indigo-400/50 group-hover/time:bg-indigo-500 transition-colors"></div>
                <!-- Tooltip -->
                <div class="absolute -top-6 left-1/2 -translate-x-1/2 bg-slate-800 text-white text-[8px] font-bold py-0.5 px-1.5 rounded opacity-0 group-hover/time:opacity-100 transition-opacity whitespace-nowrap pointer-events-none z-10">
                  <%= hour %>Ïãú: <%= count %>Ìöå
                </div>
              </div>
            <% end %>
          </div>
          <div class="flex justify-between text-[8px] font-bold text-slate-300 uppercase tracking-widest">
            <span>00Ïãú</span>
            <span>06Ïãú</span>
            <span>12Ïãú</span>
            <span>18Ïãú</span>
            <span>23Ïãú</span>
          </div>
        </div>
      </div>

      <!-- Achievement Matrix -->
      <div class="bg-white rounded-2xl border border-slate-100 shadow-sm p-5 space-y-4">
        <div class="flex items-center justify-between">
           <div class="flex items-center gap-2">
            <div class="p-1 bg-orange-50 text-orange-500 rounded-md">
              <i data-feather="grid" class="w-3.5 h-3.5"></i>
            </div>
            <h4 class="text-sm font-bold text-slate-900">ÏÑ±Ï∑® Îß§Ìä∏Î¶≠Ïä§</h4>
          </div>
          <div class="flex gap-3">
            <div class="flex items-center gap-1 text-[9px] font-bold text-slate-400">
              <span class="w-1.5 h-1.5 rounded-[1px] bg-slate-100"></span> 0
            </div>
            <div class="flex items-center gap-1 text-[9px] font-bold text-slate-400">
              <span class="w-1.5 h-1.5 rounded-[1px] bg-indigo-500"></span> High
            </div>
          </div>
        </div>

          <%
            # Matrix data (Last 28 days)
            matrix_end = Date.current
            matrix_start = matrix_end - 27.days
            matrix_dates = (matrix_start..matrix_end).to_a
            
            c_rate = matrix_dates.count { |d| c_logs.include?(d) } / 28.0 * 100
            r_rate = matrix_dates.count { |d| r_logs.include?(d) } / 28.0 * 100
          %>

          <div class="grid grid-cols-2 gap-4">
            <!-- Challenges -->
            <div class="space-y-2">
              <div class="flex justify-between items-end">
                <span class="text-[9px] font-bold text-indigo-500 uppercase tracking-wider">Challenges</span>
                <span class="text-[10px] font-black text-slate-900"><%= c_rate.to_i %>%</span>
              </div>
              <div class="grid grid-cols-7 gap-1">
                <% ["S", "M", "T", "W", "T", "F", "S"].each do |day| %>
                  <div class="text-[7px] font-black text-slate-300 text-center"><%= day %></div>
                <% end %>
                <%# Padding for start of 28 day range %>
                <% matrix_start.wday.times do %> <div class="aspect-square"></div> <% end %>
                <% matrix_dates.each do |date| %>
                  <% active = c_logs.include?(date) %>
                  <div class="aspect-square rounded-[2px] transition-all hover:scale-110 cursor-pointer <%= active ? 'bg-indigo-500' : 'bg-slate-100' %>" 
                       title="<%= date %>"></div>
                <% end %>
              </div>
            </div>

            <!-- Routines -->
            <div class="space-y-2">
              <div class="flex justify-between items-end">
                <span class="text-[9px] font-bold text-purple-500 uppercase tracking-wider">Routines</span>
                <span class="text-[10px] font-black text-slate-900"><%= r_rate.to_i %>%</span>
              </div>
              <div class="grid grid-cols-7 gap-1">
                <% ["S", "M", "T", "W", "T", "F", "S"].each do |day| %>
                  <div class="text-[7px] font-black text-slate-300 text-center"><%= day %></div>
                <% end %>
                <%# Padding for start of 28 day range %>
                <% matrix_start.wday.times do %> <div class="aspect-square"></div> <% end %>
                <% matrix_dates.each do |date| %>
                  <% active = r_logs.include?(date) %>
                  <div class="aspect-square rounded-[2px] transition-all hover:scale-110 cursor-pointer <%= active ? 'bg-purple-500' : 'bg-slate-100' %>"
                       title="<%= date %>"></div>
                <% end %>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Bottom Section Split -->
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
         <!-- Growth Investment Summary -->
        <div class="bg-slate-900 rounded-3xl p-6 text-white flex flex-col justify-between relative overflow-hidden shadow-lg group">
          <div class="absolute -right-10 -top-10 w-40 h-40 bg-indigo-500/30 rounded-full blur-3xl group-hover:bg-indigo-500/40 transition-colors"></div>
          
          <div class="relative z-10 space-y-6">
            <div class="flex items-center gap-3">
              <div class="w-8 h-8 rounded-lg bg-white/10 flex items-center justify-center border border-white/10">
                  <i data-feather="trending-up" class="w-4 h-4 text-indigo-300"></i>
              </div>
              <h4 class="text-sm font-bold tracking-tight">ÏÑ±Ïû• Ìà¨Ïûê ÏöîÏïΩ</h4>
            </div>

            <div class="space-y-1">
              <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Total Growth Investment</p>
              <h4 class="text-3xl font-black tracking-tight"><%= number_with_delimiter(@growth_stats[:total_invested]) %><span class="text-base font-bold text-slate-500 ml-1">Ïõê</span></h4>
            </div>

            <div class="pt-4 border-t border-white/10 flex flex-col gap-3">
              <div class="flex justify-between text-xs">
                 <span class="text-slate-400">ÌôòÍ∏â ÏòàÏ†ïÏï°</span>
                 <span class="text-indigo-300 font-bold"><%= number_with_delimiter(@growth_stats[:expected_refund]) %>Ïõê</span>
              </div>
              <div class="flex justify-between text-xs">
                 <span class="text-slate-200">ÎàÑÏ†Å ÌôòÍ∏âÏï°</span>
                 <span class="text-emerald-400 font-bold"><%= number_with_delimiter(@growth_stats[:total_refunded]) %>Ïõê</span>
              </div>
            </div>
          </div>
          
          <a href="#" data-action="click->tabs#change" data-id="finance" class="mt-6 w-full py-3 bg-white text-slate-900 text-xs font-black rounded-xl text-center hover:bg-indigo-50 transition-colors">
            ÏûêÏÑ∏Ìûà Î≥¥Í∏∞
          </a>
        </div>

        <!-- Badge Collection -->
        <div class="lg:col-span-2 bg-white rounded-3xl border border-slate-100 shadow-sm p-6 space-y-6">
          <div class="flex items-center justify-between">
             <div class="flex items-center gap-2">
               <div class="w-8 h-8 bg-purple-50 text-purple-600 rounded-lg flex items-center justify-center">
                  <i data-feather="hexagon" class="w-4 h-4"></i>
               </div>
               <h4 class="text-base font-bold text-slate-900">Î±ÉÏßÄ Î°úÎìúÎßµ</h4>
             </div>
             <%= link_to badge_roadmap_path, class: "text-xs font-bold text-slate-400 hover:text-indigo-500 flex items-center gap-1 group" do %>
               Ï†ÑÏ≤¥ Î≥¥Í∏∞ <i data-feather="chevron-right" class="w-3 h-3 group-hover:translate-x-0.5 transition-transform"></i>
             <% end %>
          </div>
          
          <div class="flex gap-4 overflow-x-auto pb-2 no-scrollbar">
            <% Badge.order(level: :asc).group_by(&:badge_type).each do |type, badges| %>
               <% 
                 user_badge_ids = current_user.badges.where(badge_type: type).pluck(:id)
                 latest_badge = Badge.where(badge_type: type, id: user_badge_ids).order(level: :desc).first
                 next_badge = Badge.where(badge_type: type).where("level > ?", latest_badge&.level || 0).order(level: :asc).first
                 display_badge = latest_badge || next_badge
                 is_locked = latest_badge.nil?
               %>
               <div class="min-w-[100px] flex flex-col items-center gap-3 p-4 rounded-2xl bg-slate-50 border border-transparent hover:border-slate-200 hover:bg-white transition-all group cursor-default">
                  <div class="w-12 h-12 rounded-xl flex items-center justify-center text-2xl relative shadow-sm <%= is_locked ? 'bg-slate-200 opacity-50 grayscale' : 'bg-white' %>">
                    <%= display_badge&.icon_path || "üîí" %>
                    <% if latest_badge %>
                      <span class="absolute -top-1.5 -right-1.5 bg-indigo-500 text-white text-[9px] font-bold px-1.5 py-0.5 rounded-full ring-2 ring-white">L<%= latest_badge.level %></span>
                    <% end %>
                  </div>
                  <div class="text-center space-y-0.5">
                    <p class="text-[10px] font-bold text-slate-800 truncate max-w-[80px]"><%= display_badge&.name || "ÎØ∏ÌöçÎìù" %></p>
                    <p class="text-[9px] font-semibold text-slate-400 uppercase"><%= type.to_s.humanize %></p>
                  </div>
               </div>
            <% end %>
          </div>
        </div>
      </div>
    </div>

    <!-- FINANCE PANEL (Compact Version) -->
    <div data-tabs-target="panel" data-id="finance" class="hidden space-y-6">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <!-- Summary Card -->
        <div class="md:col-span-1 bg-slate-900 text-white rounded-3xl p-6 relative overflow-hidden shadow-xl">
           <div class="absolute -right-12 -bottom-12 w-48 h-48 bg-emerald-500/20 rounded-full blur-3xl"></div>
           <div class="relative z-10 space-y-8 h-full flex flex-col">
             <div>
               <h4 class="text-lg font-bold text-emerald-400 mb-2">My Assets</h4>
               <div class="flex items-baseline gap-2">
                 <h2 class="text-4xl font-black"><%= number_with_delimiter(@growth_stats[:wallet_balance]) %></h2>
                 <span class="text-sm font-bold text-slate-400">Total</span>
               </div>
             </div>
             
             <div class="space-y-4 flex-1">
               <div class="space-y-2">
                 <div class="flex justify-between text-xs font-bold text-slate-400">
                   <span>ÏûêÏÇ∞ Î∞©Ïñ¥Ïú®</span>
                   <span class="text-white">Ï§ÄÎπÑ Ï§ë</span>
                 </div>
                 <div class="h-1.5 bg-white/10 rounded-full overflow-hidden">
                   <div class="h-full bg-emerald-500 w-[100%]"></div>
                 </div>
                 <p class="text-[10px] text-slate-500">Î≤åÍ∏à Ìä∏ÎûòÌÇπ Ïãú Î∞©Ïñ¥Ïú®Ïù¥ Í≥ÑÏÇ∞Îê©ÎãàÎã§.</p>
               </div>
             </div>

             <button class="w-full py-3 bg-white/10 hover:bg-white/20 rounded-xl text-xs font-bold transition-colors">
               ÏûÖÏ∂úÍ∏à Î¶¨Ìè¨Ìä∏ Îã§Ïö¥Î°úÎìú
             </button>
           </div>
        </div>

        <!-- History List -->
        <div class="md:col-span-2 bg-white rounded-3xl border border-slate-100 shadow-sm p-6 space-y-4 text-sm">
           <h4 class="text-base font-bold text-slate-900 mb-2">ÏµúÍ∑º ÏûÖÏ∂úÍ∏à ÎÇ¥Ïó≠</h4>
            <div class="space-y-2">
               <% if @recent_transactions.any? %>
                 <% @recent_transactions.each do |item| %>
                 <div class="flex items-center justify-between p-3 hover:bg-slate-50 rounded-xl transition-colors cursor-default border border-transparent hover:border-slate-100">
                    <div class="flex items-center gap-3">
                       <div class="w-8 h-8 rounded-lg bg-<%= item[:color] %>-50 text-<%= item[:color] %>-600 flex items-center justify-center shadow-sm">
                          <% if item[:type] == 'in' %>
                            <i data-feather="arrow-down-left" class="w-4 h-4"></i>
                          <% else %>
                            <i data-feather="arrow-up-right" class="w-4 h-4"></i>
                          <% end %>
                       </div>
                       <div class="min-w-0">
                         <p class="font-bold text-slate-900 truncate text-[13px]"><%= item[:title] %></p>
                         <p class="text-[10px] text-slate-400 font-medium"><%= item[:date] %></p>
                       </div>
                    </div>
                    <span class="font-black shrink-0 text-[13px] <%= item[:type] == 'in' ? 'text-emerald-600' : 'text-slate-900' %>">
                      <%= item[:amount] > 0 ? (item[:type] == 'in' ? '+' : '-') : '' %><%= number_with_delimiter(item[:amount]) %>Ïõê
                    </span>
                 </div>
                 <% end %>
               <% else %>
                 <div class="py-12 text-center bg-slate-50/50 rounded-2xl border border-dashed border-slate-200">
                    <p class="text-xs font-bold text-slate-400">ÏµúÍ∑º ÏûÖÏ∂úÍ∏à ÎÇ¥Ïó≠Ïù¥ ÏóÜÏäµÎãàÎã§.</p>
                 </div>
               <% end %>
            </div>
        </div>
      </div>
    </div>
    
    <!-- SOCIAL PANEL (Compact Version) -->
    <div data-tabs-target="panel" data-id="social" class="hidden space-y-6">
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
        <!-- Stats -->
        <% [
           { label: "Î∞õÏùÄ ÏùëÏõê", value: number_with_delimiter(@social_stats[:received_cheers]), icon: "heart", color: "rose" },
           { label: "Î≥¥ÎÇ∏ ÏùëÏõê", value: number_with_delimiter(@social_stats[:sent_cheers]), icon: "thumbs-up", color: "indigo" },
           { label: "Î≤†Ïä§Ìä∏ Î£®Ìã¥", value: @social_stats[:best_routine_count], icon: "star", color: "amber" },
           { label: "Î™®ÏûÑ ÌèâÏ†ê", value: @social_stats[:rating], icon: "message-circle", color: "emerald" }
        ].each do |stat| %>
          <div class="bg-white p-5 rounded-2xl border border-slate-100 shadow-sm flex items-center gap-4">
             <div class="w-10 h-10 rounded-xl bg-<%= stat[:color] %>-50 text-<%= stat[:color] %>-500 flex items-center justify-center">
               <i data-feather="<%= stat[:icon] %>" class="w-5 h-5"></i>
             </div>
             <div>
               <p class="text-[10px] font-bold text-slate-400 uppercase"><%= stat[:label] %></p>
               <h4 class="text-xl font-black text-slate-900"><%= stat[:value] %></h4>
             </div>
          </div>
        <% end %>
      </div>

       <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
         <!-- Hall of Fame -->
         <div class="md:col-span-2 bg-white rounded-3xl border border-slate-100 shadow-sm p-6">
            <h4 class="text-base font-bold text-slate-900 mb-4 flex items-center gap-2">
              <i data-feather="award" class="w-4 h-4 text-indigo-500"></i> Î™ÖÏòàÏùò Ï†ÑÎãπ
            </h4>
            <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
              <% if @top_achievers.any? %>
                <% @top_achievers.each_with_index do |user, idx| %>
                   <% is_me = (user.id == current_user.id) %>
                   <div class="relative p-4 rounded-2xl border <%= is_me ? 'border-indigo-500 bg-indigo-50/10 ring-1 ring-indigo-500' : 'border-slate-100 bg-slate-50/50' %> flex flex-col items-center text-center gap-2">
                      <span class="absolute top-2 left-3 text-[10px] font-black text-slate-300">#<%= idx + 1 %></span>
                      <div class="w-12 h-12 rounded-full border-2 border-white shadow-sm overflow-hidden bg-slate-200">
                        <img src="<%= user.profile_image.presence || "https://api.dicebear.com/7.x/lorelei/svg?seed=#{user.nickname}" %>" class="w-full h-full object-cover">
                      </div>
                      <div>
                        <p class="text-sm font-black text-slate-900 truncate max-w-[80px]"><%= user.nickname %></p>
                        <p class="text-[10px] font-bold text-slate-500"><%= user.badge_count %>Í∞úÏùò Î∞∞ÏßÄ</p>
                      </div>
                   </div>
                <% end %>
              <% else %>
                <div class="col-span-3 py-8 text-center text-slate-400 text-xs">ÏàúÏúÑ Îç∞Ïù¥ÌÑ∞Í∞Ä Ï∂©Î∂ÑÌïòÏßÄ ÏïäÏäµÎãàÎã§.</div>
              <% end %>
            </div>
         </div>
         
         <!-- Motivation Card -->
         <div class="bg-indigo-600 rounded-3xl p-6 text-white flex flex-col justify-center text-center relative overflow-hidden shadow-lg">
           <div class="absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-20"></div>
           <div class="relative z-10 space-y-3">
             <div class="w-12 h-12 bg-white/20 backdrop-blur rounded-xl flex items-center justify-center mx-auto mb-2">
               <i data-feather="zap" class="w-6 h-6 text-yellow-300"></i>
             </div>
             <h4 class="text-lg font-black leading-tight">ÎèôÍ∏∞Î∂ÄÏó¨Ïùò ÏïÑÏù¥ÏΩò!</h4>
             <p class="text-xs text-indigo-100 font-medium leading-relaxed px-4">
               ÎãπÏã†Ïùò Ïù∏Ï¶ùÏùÄ ÌèâÍ∑† <br/> <b class="text-white"><%= @inspiration_count %>Î™Ö</b>ÏóêÍ≤å ÏòÅÍ∞êÏùÑ Ï§çÎãàÎã§.
             </p>
           </div>
         </div>
       </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    if (window.feather) feather.replace();
  });
</script>

<style>
  .no-scrollbar::-webkit-scrollbar { display: none; }
  .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
</style>
