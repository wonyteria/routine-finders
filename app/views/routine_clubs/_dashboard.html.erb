<% if @my_membership.nil? %>
  <div class="bg-gradient-to-br from-indigo-600 to-purple-700 rounded-[32px] p-8 lg:p-10 text-white shadow-2xl">
    <div class="text-center space-y-4">
      <div class="text-5xl mb-4">ğŸš€</div>
      <h3 class="text-2xl font-black">ë£¨íŒŒ í´ëŸ½ì— ê°€ì…í•˜ì„¸ìš”!</h3>
      <p class="text-indigo-100 font-bold">ì²´ê³„ì ì¸ ë£¨í‹´ ê´€ë¦¬ì™€ ì„±ì¥ ì¶”ì ì„ ì‹œì‘í•˜ì„¸ìš”.</p>
      <%= link_to "ë£¨íŒŒ í´ëŸ½ ê°€ì…í•˜ê¸°", routine_club_path(@routine_club), class: "inline-block mt-4 px-8 py-4 bg-white text-indigo-600 rounded-2xl font-black hover:bg-yellow-100 transition-all" %>
    </div>
  </div>
<% else %>
<div class="space-y-8">
  
  <div class="flex flex-wrap gap-2 md:gap-3">
    <!-- ì„±ì¥ ì—ë„ˆì§€ -->
    <div class="flex-1 min-w-[80px] md:min-w-[110px] bg-slate-900 rounded-xl p-2.5 md:p-3 text-white shadow-md relative overflow-hidden">
      <p class="text-[7px] md:text-[8px] font-bold text-indigo-300 uppercase tracking-wider mb-0.5 md:mb-1">ì„±ì¥ ì—ë„ˆì§€</p>
      <div class="flex items-baseline gap-0.5">
        <p class="text-lg md:text-xl font-black tracking-tight tabular-nums"><%= @my_membership.growth_points || 0 %></p>
        <p class="text-[8px] md:text-[9px] font-bold text-indigo-400">P</p>
      </div>
    </div>

    <!-- ë‹¬ì„±ë¥  -->
    <div class="flex-1 min-w-[80px] md:min-w-[110px] bg-white rounded-xl p-2.5 md:p-3 border border-slate-200 shadow-sm">
      <p class="text-[7px] md:text-[8px] font-bold text-purple-400 uppercase tracking-wider mb-0.5 md:mb-1">ë‹¬ì„±ë¥ </p>
      <div class="flex items-baseline gap-0.5">
        <p class="text-lg md:text-xl font-black text-slate-900 tracking-tight tabular-nums"><%= @my_membership.achievement_rate.to_i %></p>
        <p class="text-[8px] md:text-[9px] font-bold text-slate-400">%</p>
      </div>
    </div>
    
    <!-- ì¶œì„ë¥  -->
    <div class="flex-1 min-w-[80px] md:min-w-[110px] bg-white rounded-xl p-2.5 md:p-3 border border-slate-200 shadow-sm">
      <p class="text-[7px] md:text-[8px] font-bold text-emerald-500 uppercase tracking-wider mb-0.5 md:mb-1">ì¶œì„ë¥ </p>
      <div class="flex items-baseline gap-0.5">
        <p class="text-lg md:text-xl font-black text-slate-900 tracking-tight tabular-nums"><%= @my_membership.attendance_rate.to_i %></p>
        <p class="text-[8px] md:text-[9px] font-bold text-slate-400">%</p>
      </div>
    </div>
    
    <!-- íœ´ì‹ê¶Œ -->
    <div class="flex-1 min-w-[100px] md:min-w-[110px] bg-white rounded-xl p-2.5 md:p-3 border border-slate-200 shadow-sm cursor-help" 
         title="ì˜¤ëŠ˜ ë¶„ëŸ‰ ë©´ì œ & ì¶œì„ë¥  70% ë³´í˜¸">
      <p class="text-[7px] md:text-[8px] font-bold text-blue-400 uppercase tracking-wider mb-0.5 md:mb-1">íœ´ì‹ê¶Œ</p>
      <div class="flex items-center justify-between gap-1">
        <div class="flex items-baseline gap-0.5">
          <p class="text-lg md:text-xl font-black text-slate-900 tracking-tight tabular-nums"><%= @my_membership.remaining_passes %></p>
          <p class="text-[8px] md:text-[9px] font-bold text-slate-400">ê°œ</p>
        </div>
        <% 
          today_attendance = @my_membership.attendances.find_by(attendance_date: Date.current)
          can_use_pass = @my_membership.remaining_passes > 0 && !today_attendance&.status_excused?
        %>
        <% if can_use_pass %>
          <%= button_to use_pass_routine_club_path(@routine_club), method: :post, 
                        class: "px-2 py-0.5 bg-blue-50 text-blue-600 rounded-lg text-[8px] md:text-[9px] font-black border border-blue-100 hover:bg-blue-600 hover:text-white transition-all whitespace-nowrap", 
                        data: { turbo_confirm: "íœ´ì‹ê¶Œì„ ì‚¬ìš©í•˜ì‹œê² ìŠµë‹ˆê¹Œ?", turbo: false } do %>
            ì‚¬ìš©
          <% end %>
        <% elsif today_attendance&.status_excused? %>
          <span class="px-2 py-0.5 bg-green-50 text-green-600 rounded-lg text-[8px] md:text-[9px] font-black">ì™„ë£Œ</span>
        <% end %>
      </div>
    </div>
    
    <!-- ëˆ„ì  ê²½ê³  -->
    <div class="flex-1 min-w-[80px] md:min-w-[110px] bg-white rounded-xl p-2.5 md:p-3 border border-slate-200 shadow-sm relative overflow-hidden">
      <p class="text-[7px] md:text-[8px] font-bold text-amber-500 uppercase tracking-wider mb-0.5 md:mb-1">ëˆ„ì  ê²½ê³ </p>
      <div class="flex items-baseline gap-0.5">
        <p class="text-lg md:text-xl font-black text-slate-900 tracking-tight tabular-nums"><%= @my_membership.penalty_count %></p>
        <p class="text-[8px] md:text-[9px] font-bold text-slate-400">íšŒ</p>
      </div>
    </div>
  </div>

  <% days_left = (@my_membership.membership_end_date - Date.current).to_i %>
  <% if days_left.between?(1, 14) %>
    <div class="bg-gradient-to-r from-orange-500 to-pink-500 rounded-[32px] p-8 text-white flex flex-col md:flex-row items-center justify-between gap-6 shadow-xl shadow-orange-200">
       <div class="space-y-1">
          <h3 class="text-2xl font-black">ë©¤ë²„ì‹­ ë§Œë£Œ ì•ˆë‚´ âœ¨</h3>
          <p class="font-bold opacity-90">ë£¨íŒŒ í´ëŸ½ ë©¤ë²„ì‹­ ì¢…ë£Œê°€ <span class="bg-white/20 px-2 py-0.5 rounded text-yellow-300"><%= days_left %>ì¼</span> ë‚¨ì•˜ìŠµë‹ˆë‹¤. ëŠê¹€ ì—†ëŠ” ì„±ì¥ì„ ìœ„í•´ ì—°ì¥í•´ ë³´ì„¸ìš”!</p>
       </div>
       <%= link_to "ë©¤ë²„ì‹­ ê¸°ê°„ ì—°ì¥í•˜ê¸°", routine_club_path(@routine_club), class: "px-8 py-4 bg-white text-orange-600 rounded-2xl font-black hover:bg-yellow-100 transition-all text-sm whitespace-nowrap" %>
    </div>
  <% end %>

  <!-- Community Board -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6">
    <!-- Announcements -->
    <div class="bg-white rounded-[24px] md:rounded-[32px] p-4 md:p-8 border border-slate-200 shadow-sm">
      <div class="flex items-center justify-between mb-4 md:mb-6">
        <h2 class="text-xl font-black text-slate-900 flex items-center gap-2">
          <span class="text-2xl">ğŸ“¢</span> ê³µì§€ì‚¬í•­
        </h2>
        <div class="flex gap-2">
          <% if @is_host || current_user&.admin? %>
            <button onclick="openAnnouncementModal()" class="text-[10px] font-black bg-indigo-50 text-indigo-600 px-2 py-1 rounded-lg hover:bg-indigo-100 transition-colors">
              ê³µì§€ ë“±ë¡
            </button>
          <% end %>
          <% if @announcements.count > 1 %>
            <button onclick="openAllAnnouncementsModal()" class="text-xs font-bold text-slate-400 hover:text-slate-600 transition-colors">ì „ì²´ë³´ê¸°</button>
          <% end %>
        </div>
      </div>
      
      <% if @announcements.any? %>
        <div class="space-y-4">
          <% @announcements.limit(1).each do |notice| %>
            <div class="group cursor-pointer" onclick="viewAnnouncement(<%= notice.id %>, '<%= j notice.title %>', '<%= j notice.content %>', '<%= notice.created_at.strftime("%Yë…„ %mì›” %dì¼") %>')">
              <div class="flex items-center justify-between mb-1">
                <span class="px-2 py-0.5 bg-amber-100 text-amber-700 text-[10px] font-black rounded-lg"><%= notice.created_at.strftime("%m/%d") %></span>
                <% if (Date.current - notice.created_at.to_date).to_i < 7 %>
                  <span class="text-[10px] font-bold text-amber-500">New</span>
                <% end %>
              </div>
              <h3 class="font-bold text-slate-900 group-hover:text-indigo-600 transition-colors line-clamp-1"><%= notice.title %></h3>
              <p class="text-xs text-slate-500 mt-1 line-clamp-2"><%= notice.content %></p>
            </div>
          <% end %>
        </div>
      <% else %>
        <div class="text-center py-8 bg-slate-50 rounded-2xl border border-dashed border-slate-200">
          <p class="text-slate-400 font-bold text-sm">ë“±ë¡ëœ ê³µì§€ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤</p>
        </div>
      <% end %>
    </div>

    <!-- Gatherings -->
    <div class="bg-white rounded-[24px] md:rounded-[32px] p-4 md:p-8 border border-slate-200 shadow-sm">
      <div class="flex items-center justify-between mb-4 md:mb-6">
        <h2 class="text-lg md:text-xl font-black text-slate-900 flex items-center gap-2">
          <span class="text-xl md:text-2xl">ğŸ¤</span> ëª¨ì„ ì•Œë¦¼
        </h2>
        <button onclick="openAllGatheringsModal()" class="text-[10px] font-black text-slate-400 hover:text-indigo-600 transition-colors">ì „ì²´ë³´ê¸°</button>
      </div>

      <div class="space-y-2 md:space-y-3">
        <% if @gatherings&.any? %>
          <% @gatherings.each do |gathering| %>
            <div class="group bg-emerald-50/30 p-3 md:p-4 rounded-xl md:rounded-2xl border border-emerald-100/50 hover:bg-emerald-50 transition-all cursor-pointer" 
                 onclick="viewGathering(<%= gathering.id %>, '<%= j gathering.title %>', '<%= j gathering.description %>', '<%= gathering.gathering_at.strftime("%Yë…„ %mì›” %dì¼ %H:%M") %>', '<%= j gathering.location %>', '<%= gathering.gathering_type %>', <%= gathering.max_attendees || 'null' %>)">
               <div class="flex items-center justify-between mb-1.5">
                  <span class="text-[9px] md:text-[10px] font-bold text-emerald-600 uppercase tracking-widest"><%= gathering.gathering_at.strftime("%mì›” %dì¼ (%a)") %></span>
                  <div class="flex items-center gap-1">
                    <span class="w-1.5 h-1.5 bg-emerald-500 rounded-full"></span>
                    <span class="text-[8px] md:text-[9px] font-black text-emerald-600 uppercase"><%= gathering.gathering_type %></span>
                  </div>
               </div>
               <h4 class="text-xs md:text-sm font-black text-slate-900 truncate mb-1"><%= gathering.title %></h4>
               <p class="text-[9px] md:text-[10px] font-medium text-slate-400 truncate flex items-center gap-1">
                 <svg class="w-2.5 h-2.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
                 <%= gathering.location %>
               </p>
            </div>
          <% end %>
        </div>
      <% else %>
        <div class="text-center py-8 bg-slate-50 rounded-2xl border border-dashed border-slate-200">
          <p class="text-slate-400 font-bold text-sm">ì˜ˆì •ëœ ëª¨ì„ì´ ì—†ìŠµë‹ˆë‹¤</p>
        </div>
      <% end %>
    </div>
  </div>
  <div class="flex flex-col lg:flex-row gap-6 lg:gap-10 items-stretch">
    <!-- Combined Mission Control Panel -->
    <div class="w-full lg:w-[45%] flex flex-col gap-6">
      <div class="bg-slate-900 rounded-[40px] p-8 lg:p-10 shadow-2xl relative overflow-hidden group flex-1 flex flex-col">
        <div class="absolute -right-16 -top-16 w-48 h-48 bg-indigo-600/30 rounded-full blur-[80px]"></div>
        
        <div class="relative z-10 mb-10 flex items-center justify-between">
          <div>
            <h2 class="text-2xl lg:text-3xl font-black text-white tracking-tight italic">ì˜¤ëŠ˜ì˜ ë£¨í‹´</h2>
            <p class="text-indigo-300 font-bold text-xs uppercase tracking-widest mt-1">ì˜¤ëŠ˜ì˜ ì •ì§„ì„ ì²´í¬í•˜ì„¸ìš”</p>
          </div>
          <div class="w-12 h-12 bg-white/10 rounded-2xl flex items-center justify-center text-2xl">âš¡</div>
        </div>

        <div class="relative z-10 flex-1 flex flex-col gap-3">
          <% 
            current_wday = Date.current.wday.to_s
            todays_routines = @personal_routines.select { |r| (r.days || []).map(&:to_s).include?(current_wday) }
          %>
          
          <% if todays_routines.any? %>
            <div class="grid grid-cols-1 gap-2.5">
              <% todays_routines.each do |routine| %>
                <% is_done = routine.completed_on?(Date.current) %>
                <%= render 'routine_clubs/dashboard_routine_item', routine: routine, is_done: is_done, selected_date: Date.current %>
              <% end %>
            </div>
          <% else %>
            <div class="flex-1 flex flex-col items-center justify-center py-10 opacity-30">
              <span class="text-5xl mb-4">ğŸ–ï¸</span>
              <p class="text-white font-bold">ì˜¤ëŠ˜ì€ íœ´ì‹ì¼ì…ë‹ˆë‹¤</p>
            </div>
          <% end %>
        </div>

        <% if todays_routines.any? %>
          <div class="mt-8 pt-6 border-t border-white/5 flex items-center justify-between">
            <div class="flex -space-x-2">
               <% [1,2,3].each do |i| %>
                 <div class="w-6 h-6 rounded-full bg-indigo-500/20 border border-indigo-500/30 flex items-center justify-center text-[10px]">âœ¨</div>
               <% end %>
            </div>
            <p class="text-[10px] font-black text-indigo-400 uppercase tracking-widest">ëª¨ë‘ ì™„ë£Œí•˜ë©´ ê¸°ë¡ì´ í™œì„±í™”ë©ë‹ˆë‹¤</p>
          </div>
        <% end %>
      </div>
    </div>

    <!-- Right Component: Achievement Matrix -->
    <div id="rufa-achievement-matrix" class="w-full lg:w-[55%] flex flex-col">
      <%= render 'shared/achievement_matrix', compact: false %>
    </div>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 lg:gap-5 items-stretch">
    <!-- Recent Activity Feed (Left) -->
    <div class="lg:col-span-2 bg-white rounded-2xl p-5 lg:p-6 border border-slate-200 shadow-sm flex flex-col">
      <div class="flex items-center justify-between mb-5">
        <div>
          <h2 class="text-lg lg:text-xl font-black text-slate-900 tracking-tight">ìµœê·¼ ë£¨í‹´ í˜„í™©</h2>
          <p class="text-[9px] font-bold text-slate-400 mt-0.5 uppercase tracking-wider leading-none">ì‹¤ì‹œê°„ìœ¼ë¡œ ê³µìœ ë˜ëŠ” ë©¤ë²„ë“¤ì˜ ê¸°ë¡</p>
        </div>
        <div class="flex items-center gap-2">
          <div class="flex -space-x-2">
            <% @routine_club.members.active.limit(3).each do |member| %>
              <div class="w-7 h-7 rounded-full border-2 border-white shadow-sm overflow-hidden ring-1 ring-slate-100">
                <img src="<%= member.user.profile_image %>" class="w-full h-full object-cover" />
              </div>
            <% end %>
          </div>
          <div class="px-2.5 py-1 bg-slate-900 rounded-lg text-white text-[9px] font-black">
            <%= @routine_club.members.active.count %>ëª…
          </div>
          <button onclick="openAllActivitiesModal()" class="px-2.5 py-1 bg-indigo-50 text-indigo-600 rounded-lg text-[9px] font-black hover:bg-indigo-100 transition-colors">
            ì „ì²´ ë³´ê¸°
          </button>
        </div>
      </div>
      
      
      <div class="flex-1 overflow-y-auto max-h-[500px]">
        <% recent_attendances = @routine_club.attendances.includes(routine_club_member: :user).recent.limit(8) %>
        <% 
          # ì˜ˆì‹œ ë°ì´í„° (ì‹¤ì œ ë°ì´í„°ê°€ ì—†ì„ ë•Œ)
          example_data = [
            { name: "ê¹€ë£¨í‹´", time: "5ë¶„", text: "ì˜¤ëŠ˜ë„ ìƒˆë²½ 5ì‹œ ê¸°ìƒ ì„±ê³µ! ë¯¸ë¼í´ ëª¨ë‹ìœ¼ë¡œ í•˜ë£¨ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤ ğŸ’ª", cheers: 12 },
            { name: "ë°•ì„±ì¥", time: "23ë¶„", text: "ì˜ì–´ ê³µë¶€ 30ë¶„ ì™„ë£Œ. ë§¤ì¼ ì¡°ê¸ˆì”© ì„±ì¥í•˜ëŠ” ì¤‘!", cheers: 8 },
            { name: "ì´íŒŒì¸ë”", time: "1ì‹œê°„", text: "ìš´ë™ 1ì‹œê°„ + ë…ì„œ 30ë¶„ ì™„ë£Œ. ì˜¤ëŠ˜ë„ ì•Œì°¬ í•˜ë£¨ì˜€ì–´ìš” ğŸ“š", cheers: 15 },
            { name: "ìµœê¾¸ì¤€", time: "2ì‹œê°„", text: "ì‚¬ì´ë“œ í”„ë¡œì íŠ¸ ì½”ë”© 2ì‹œê°„. ë“œë””ì–´ ê¸°ëŠ¥ êµ¬í˜„ ì™„ë£Œ!", cheers: 6 },
            { name: "ì •ì—´ì •", time: "3ì‹œê°„", text: "ëª…ìƒ 10ë¶„ìœ¼ë¡œ ë§ˆìŒì„ ì •ë¦¬í–ˆìŠµë‹ˆë‹¤ ğŸ§˜â€â™€ï¸", cheers: 9 },
            { name: "ê°•ë„ì „", time: "5ì‹œê°„", text: "ì˜¤ëŠ˜ì˜ ë£¨í‹´ì„ ëª¨ë‘ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤!", cheers: 4 },
          ]
        %>
        
        <% if recent_attendances.any? %>
          <div class="space-y-1.5 md:space-y-2">
            <% recent_attendances.each_with_index do |attendance, index| %>
              <div class="group bg-white hover:bg-slate-50 border border-slate-100 rounded-lg p-2 md:p-3 transition-all <%= 'hidden md:block' if index >= 3 %>">
                <div class="flex items-center gap-2.5">
                  <div class="w-8 h-8 rounded-lg overflow-hidden ring-1 ring-slate-200 shrink-0">
                    <img src="<%= attendance.routine_club_member.user.profile_image %>" class="w-full h-full object-cover" />
                  </div>
                  <div class="flex-1 min-w-0">
                    <div class="flex items-center gap-2">
                      <p class="text-xs font-black text-slate-900"><%= attendance.routine_club_member.user.nickname %></p>
                      <span class="text-[9px] text-slate-400 font-medium"><%= time_ago_in_words(attendance.created_at) %> ì „</span>
                    </div>
                    <p class="text-[11px] text-slate-600 font-medium leading-snug line-clamp-1 mt-0.5">
                      <%= attendance.proof_text.present? ? attendance.proof_text : "ì˜¤ëŠ˜ì˜ ë£¨í‹´ì„ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤!" %>
                    </p>
                  </div>
                  <% has_cheered = attendance.cheered_by?(current_user.id) %>
                    <div id="cheer-btn-main-<%= attendance.id %>" class="shrink-0 relative z-10">
                      <%= form_with url: cheer_routine_club_path(@routine_club, attendance_id: attendance.id), method: :post, data: { turbo: true } do %>
                        <button type="submit" class="flex items-center gap-1.5 px-2.5 py-1.5 <%= has_cheered ? 'bg-orange-100 border-orange-400 scale-105' : 'bg-orange-50 border-2 border-orange-200 shadow-sm' %> rounded-lg hover:border-orange-400 hover:bg-orange-100 transition-all text-slate-700 active:scale-95 cursor-pointer focus:outline-none focus:ring-2 focus:ring-orange-500/20">
                          <span class="text-sm pointer-events-none transition-transform <%= 'scale-125' if has_cheered %>">ğŸ‘</span>
                          <span class="text-xs font-black text-orange-600 tabular-nums pointer-events-none"><%= attendance.cheers_count %></span>
                        </button>
                      <% end %>
                    </div>
                </div>
              </div>
            <% end %>
          </div>
        <% else %>
          <% if Rails.env.development? %>
            <!-- ì˜ˆì‹œ ë°ì´í„° í‘œì‹œ (ê°œë°œ í™˜ê²½ì—ì„œë§Œ) -->
            <div class="space-y-2">
              <% example_data.each_with_index do |item, index| %>
                <div class="group bg-white hover:bg-slate-50 border border-slate-100 rounded-lg p-3 transition-all opacity-60">
                  <div class="flex items-center gap-2.5">
                    <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-indigo-<%= 400 + (index % 3) * 100 %> to-purple-<%= 400 + (index % 3) * 100 %> shrink-0 flex items-center justify-center text-white text-xs font-black">
                      <%= item[:name][0] %>
                    </div>
                    <div class="flex-1 min-w-0">
                      <div class="flex items-center gap-2">
                        <p class="text-xs font-black text-slate-900"><%= item[:name] %></p>
                        <span class="text-[9px] text-slate-400 font-medium"><%= item[:time] %> ì „</span>
                      </div>
                      <p class="text-[11px] text-slate-600 font-medium leading-snug line-clamp-1 mt-0.5">
                        <%= item[:text] %>
                      </p>
                    </div>
                    <div class="flex items-center gap-1.5 px-2.5 py-1.5 bg-orange-50/50 border-2 border-orange-100 rounded-lg hover:border-orange-400 hover:bg-orange-100 transition-all text-slate-700 shadow-sm active:scale-95 cursor-pointer relative z-20 group/cheer" onclick="fakeCheer(this)">
                      <span class="text-sm pointer-events-none group-active/cheer:scale-125 transition-transform inline-block">ğŸ‘</span>
                      <span class="text-xs font-black text-orange-600 tabular-nums pointer-events-none count-val"><%= item[:cheers] %></span>
                    </div>
                  </div>
                </div>
              <% end %>
            </div>
            
            <div class="mt-4 py-6 text-center bg-indigo-50/50 rounded-xl border border-indigo-100">
              <p class="text-indigo-600 font-bold text-xs mb-1">ğŸ‘† ì˜ˆì‹œ ë°ì´í„°ì…ë‹ˆë‹¤ (ê°œë°œ í™˜ê²½)</p>
              <p class="text-slate-400 text-[10px] font-medium">ë©¤ë²„ë“¤ì˜ ê¸°ë¡ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤</p>
            </div>
          <% else %>
            <div class="py-12 text-center bg-slate-50/50 rounded-2xl border border-dashed border-slate-200">
              <div class="w-12 h-12 bg-white rounded-2xl flex items-center justify-center text-2xl mx-auto shadow-sm mb-3">ğŸï¸</div>
              <p class="text-slate-400 font-bold text-sm">ì•„ì§ ì˜¤ëŠ˜ì˜ ì²« ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤</p>
              <p class="text-slate-300 text-[10px] mt-1 font-medium">ê°€ì¥ ë¨¼ì € ê¸°ë¡í•´ë³´ì„¸ìš”!</p>
            </div>
          <% end %>
        <% end %>
      </div>
    </div>

    <!-- Today's Record (Right) -->
    <div id="rufa-daily-record" class="lg:col-span-1 flex flex-col overflow-hidden">
       <%= render 'routine_clubs/daily_record_area' %>
    </div>
  </div>

  <!-- Weekly Reports: Bauhaus Style Cards -->
  <div class="bg-white rounded-[24px] md:rounded-[32px] p-4 md:p-10 border border-slate-100 shadow-sm">
    <div class="flex items-center justify-between mb-4 md:mb-8">
      <div class="space-y-0.5 md:space-y-1">
        <h2 class="text-lg md:text-2xl font-black text-slate-900 tracking-tight">ì£¼ê°„ ë£¨í‹´ ë¦¬í¬íŠ¸</h2>
        <p class="text-[9px] md:text-xs font-bold text-slate-400 uppercase tracking-widest">ë°ì´í„°ë¡œ ê¸°ë¡í•˜ëŠ” ì„±ì¥ì˜ ì—­ì‚¬</p>
      </div>
      <% 
        reports = RoutineClubReport.where(routine_club: @routine_club, user: current_user).order(start_date: :desc)
        show_view_all = reports.any? || Rails.env.development? 
      %>
      <% if show_view_all %>
        <button onclick="openAllReportsModal()" class="text-xs font-bold text-slate-400 hover:text-slate-600 transition-colors">ì „ì²´ë³´ê¸°</button>
      <% end %>
    </div>
    
    <% if reports.any? %>
      <div class="space-y-3 md:space-y-4">
        <% reports.limit(1).each do |report| %>
          <div class="bg-slate-50 border border-slate-200 rounded-2xl md:rounded-3xl p-4 md:p-6">
            <div class="flex items-center justify-between gap-3 mb-4">
              <div class="flex items-center gap-2 min-w-0">
                <span class="inline-block px-2.5 py-1 bg-indigo-100 text-indigo-600 rounded-full text-[10px] md:text-xs font-black shrink-0">
                  ì£¼ê°„
                </span>
                <h3 class="text-sm md:text-lg font-black text-slate-900 leading-tight truncate">
                  <%= report.start_date.strftime("%m/%d") %> - <%= report.end_date.strftime("%m/%d") %>
                </h3>
              </div>
              <div class="text-right shrink-0">
                <p class="text-[9px] md:text-sm font-bold text-slate-500 leading-none mb-0.5">ì¶œì„ë¥ </p>
                <p class="text-lg md:text-2xl font-black text-indigo-600 leading-none"><%= report.attendance_rate.to_i %>%</p>
              </div>
            </div>
            
            <p class="text-slate-700 font-medium mb-3">
              <%= report.summary %>
            </p>
            
            <div class="bg-white rounded-xl p-4 border border-slate-100 flex items-center gap-3">
              <div class="text-2xl">ğŸ’Œ</div>
              <p class="text-indigo-600 font-bold text-sm">
                <%= report.cheering_message %>
              </p>
            </div>
          </div>
        <% end %>
      </div>
    <% else %>
      <% if Rails.env.development? %>
        <!-- ì˜ˆì‹œ ë°ì´í„° í‘œì‹œ (ê°œë°œ í™˜ê²½ì—ì„œë§Œ) -->
        <div class="space-y-4">
          <% 
            example_reports = [
              {
                type: 'ì£¼ê°„',
                range: "#{(Date.current - 7.days).strftime('%mì›” %dì¼')} - #{(Date.current - 1.day).strftime('%mì›” %dì¼')}",
                rate: 100,
                summary: "ì§€ë‚œ í•œ ì£¼ ë™ì•ˆ ëª¨ë“  ë£¨í‹´ì„ ì™„ë²½í•˜ê²Œ ìˆ˜í–‰í•˜ì…¨ìŠµë‹ˆë‹¤! íŠ¹íˆ ì•„ì¹¨ ëª…ìƒ ë£¨í‹´ì˜ ì§€ì† ì‹œê°„ì´ ê¸¸ì–´ì§€ê³  ìˆì–´ ì§‘ì¤‘ë ¥ í–¥ìƒì— í° ë„ì›€ì´ ë˜ê³  ìˆìŠµë‹ˆë‹¤.",
                message: "ê¸°ë¡ì ì¸ ì„±ê³¼ì…ë‹ˆë‹¤! ì´ íë¦„ì„ ìœ ì§€í•œë‹¤ë©´ ì´ë²ˆ ë‹¬ ëª©í‘œ ë‹¬ì„±ì€ ë¬¸ì œ ì—†ê² ë„¤ìš”. âœ¨"
              },
              {
                type: 'ì£¼ê°„',
                range: "#{(Date.current - 14.days).strftime('%mì›” %dì¼')} - #{(Date.current - 8.days).strftime('%mì›” %dì¼')}",
                rate: 85,
                summary: "ê¾¸ì¤€í•œ ì°¸ì—¬ê°€ ë‹ë³´ì¸ í•œ ì£¼ì˜€ìŠµë‹ˆë‹¤. í™”ìš”ì¼ í•˜ë£¨ ê²°ì„ì´ ìˆì—ˆì§€ë§Œ, ë‚˜ë¨¸ì§€ ìš”ì¼ì˜ ìˆ˜í–‰ë„ëŠ” ë§¤ìš° ìš°ìˆ˜í•©ë‹ˆë‹¤.",
                message: "ê°€ë”ì€ ì‰¬ì–´ê°€ëŠ” ê²ƒë„ ì „ëµì…ë‹ˆë‹¤. ë‹¤ì‹œ ì—”ì§„ì„ ê°€ë™í•´ë³¼ê¹Œìš”? ğŸš€"
              }
            ]
          %>
          <% example_reports.take(1).each do |report| %>
            <div class="bg-slate-50 border border-slate-200 rounded-3xl p-6 opacity-60 hover:opacity-100 transition-opacity">
              <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-4">
                <div>
                  <span class="inline-block px-3 py-1 bg-indigo-100 text-indigo-600 rounded-full text-xs font-black mb-2">
                    ì£¼ê°„ ë¦¬í¬íŠ¸
                  </span>
                  <h3 class="text-lg font-black text-slate-900">
                    <%= report[:range] %>
                  </h3>
                </div>
                <div class="text-right">
                  <p class="text-sm font-bold text-slate-500">ì¶œì„ë¥ </p>
                  <p class="text-2xl font-black text-indigo-600"><%= report[:rate] %>%</p>
                </div>
              </div>
              
              <p class="text-slate-700 font-medium mb-3">
                <%= report[:summary] %>
              </p>
              
              <div class="bg-white rounded-xl p-4 border border-slate-100 flex items-center gap-3">
                <div class="text-2xl">ğŸ’Œ</div>
                <p class="text-indigo-600 font-bold text-sm">
                  <%= report[:message] %>
                </p>
              </div>
            </div>
          <% end %>
        </div>
        
        <div class="mt-4 py-6 text-center bg-indigo-50/50 rounded-xl border border-indigo-100">
          <p class="text-indigo-600 font-bold text-xs mb-1">ğŸ‘† ì˜ˆì‹œ ë¦¬í¬íŠ¸ì…ë‹ˆë‹¤ (ê°œë°œ í™˜ê²½)</p>
          <p class="text-slate-400 text-[10px] font-medium">ë§¤ì£¼ ì›”ìš”ì¼ ì‹¤ì œ ë°ì´í„°ë¡œ ë¶„ì„ëœ ë¦¬í¬íŠ¸ê°€ ë°œí–‰ë©ë‹ˆë‹¤</p>
        </div>
      <% else %>
        <div class="bg-slate-50 rounded-3xl p-12 text-center">
          <div class="text-4xl mb-3 opacity-30">ğŸ“ˆ</div>
          <p class="text-slate-400 font-bold">ì•„ì§ ìƒì„±ëœ ë¦¬í¬íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤</p>
          <p class="text-xs text-slate-400 mt-2">ë§¤ì£¼ ì›”ìš”ì¼ì— ì§€ë‚œì£¼ í™œë™ ë¦¬í¬íŠ¸ê°€ ë°œí–‰ë©ë‹ˆë‹¤</p>
        </div>
      <% end %>
    <% end %>
  </div>
  </div>

  <!-- Announcement Modal -->
  <div id="announcementModal" class="fixed inset-0 z-50 hidden items-center justify-center p-4 bg-slate-900/80 backdrop-blur-sm">
    <div class="bg-white rounded-[32px] p-8 max-w-lg w-full shadow-2xl transform transition-all">
      <div class="flex items-center justify-between mb-6">
        <h3 class="text-2xl font-black text-slate-900">ê³µì§€ì‚¬í•­ ë“±ë¡</h3>
        <button onclick="closeAnnouncementModal()" class="text-slate-400 hover:text-slate-600 transition-colors">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      </div>
      
      <%= form_with model: [@routine_club, Announcement.new], url: routine_club_announcements_path(@routine_club), local: true, class: "space-y-4" do |f| %>
        <div>
          <%= f.label :title, "ì œëª©", class: "block text-sm font-black text-slate-700 mb-2" %>
          <%= f.text_field :title, class: "w-full px-4 py-3 rounded-xl border-slate-200 focus:ring-2 ring-indigo-500 focus:border-indigo-500 font-medium", placeholder: "ê³µì§€ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”", required: true %>
        </div>
        <div>
          <%= f.label :content, "ë‚´ìš©", class: "block text-sm font-black text-slate-700 mb-2" %>
          <%= f.text_area :content, rows: 6, class: "w-full px-4 py-3 rounded-xl border-slate-200 focus:ring-2 ring-indigo-500 focus:border-indigo-500 font-medium", placeholder: "ìƒì„¸ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”", required: true %>
        </div>
        <div class="flex gap-3 pt-4">
          <button type="button" onclick="closeAnnouncementModal()" class="flex-1 py-3 bg-slate-100 text-slate-600 rounded-xl font-black hover:bg-slate-200 transition-colors">
            ì·¨ì†Œ
          </button>
          <%= f.submit "ë“±ë¡í•˜ê¸°", class: "flex-1 py-3 bg-indigo-600 text-white rounded-xl font-black hover:bg-indigo-700 transition-colors cursor-pointer" %>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Gathering Modal -->
  <div id="gatheringModal" class="fixed inset-0 z-50 hidden items-center justify-center p-4 bg-slate-900/80 backdrop-blur-sm">
    <div class="bg-white rounded-[32px] p-8 max-w-lg w-full shadow-2xl transform transition-all">
      <div class="flex items-center justify-between mb-6">
        <h3 class="text-2xl font-black text-slate-900">ëª¨ì„ ë“±ë¡</h3>
        <button onclick="closeGatheringModal()" class="text-slate-400 hover:text-slate-600 transition-colors">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      </div>
      
      <%= form_with model: [@routine_club, RoutineClubGathering.new], url: routine_club_gatherings_path(@routine_club), local: true, class: "space-y-4" do |f| %>
        <div>
          <%= f.label :title, "ëª¨ì„ëª…", class: "block text-sm font-black text-slate-700 mb-2" %>
          <%= f.text_field :title, class: "w-full px-4 py-3 rounded-xl border-slate-200 focus:ring-2 ring-emerald-500 focus:border-emerald-500 font-medium", placeholder: "ëª¨ì„ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”", required: true %>
        </div>
        <div class="grid grid-cols-2 gap-4">
          <div>
            <%= f.label :gathering_type, "ìœ í˜•", class: "block text-sm font-black text-slate-700 mb-2" %>
            <%= f.select :gathering_type, [['ì˜¨ë¼ì¸', 'online'], ['ì˜¤í”„ë¼ì¸', 'offline']], {}, class: "w-full px-4 py-3 rounded-xl border-slate-200 focus:ring-2 ring-emerald-500 focus:border-emerald-500 font-medium" %>
          </div>
          <div>
            <%= f.label :max_attendees, "ì •ì›", class: "block text-sm font-black text-slate-700 mb-2" %>
            <%= f.number_field :max_attendees, class: "w-full px-4 py-3 rounded-xl border-slate-200 focus:ring-2 ring-emerald-500 focus:border-emerald-500 font-medium", placeholder: "ë¬´ì œí•œ: ë¹„ì›Œë‘ " %>
          </div>
        </div>
        <div>
          <%= f.label :gathering_at, "ì¼ì‹œ", class: "block text-sm font-black text-slate-700 mb-2" %>
          <%= f.datetime_field :gathering_at, class: "w-full px-4 py-3 rounded-xl border-slate-200 focus:ring-2 ring-emerald-500 focus:border-emerald-500 font-medium", required: true %>
        </div>
        <div>
          <%= f.label :location, "ì¥ì†Œ/ë§í¬", class: "block text-sm font-black text-slate-700 mb-2" %>
          <%= f.text_field :location, class: "w-full px-4 py-3 rounded-xl border-slate-200 focus:ring-2 ring-emerald-500 focus:border-emerald-500 font-medium", placeholder: "ì£¼ì†Œ ë˜ëŠ” ì¤Œ ë§í¬ ë“±", required: true %>
        </div>
        <div>
          <%= f.label :description, "ìƒì„¸ ì•ˆë‚´", class: "block text-sm font-black text-slate-700 mb-2" %>
          <%= f.text_area :description, rows: 4, class: "w-full px-4 py-3 rounded-xl border-slate-200 focus:ring-2 ring-emerald-500 focus:border-emerald-500 font-medium", placeholder: "ëª¨ì„ì— ëŒ€í•œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”" %>
        </div>
        <div class="flex gap-3 pt-4">
          <button type="button" onclick="closeGatheringModal()" class="flex-1 py-3 bg-slate-100 text-slate-600 rounded-xl font-black hover:bg-slate-200 transition-colors">
            ì·¨ì†Œ
          </button>
          <%= f.submit "ê°œì„¤í•˜ê¸°", class: "flex-1 py-3 bg-emerald-600 text-white rounded-xl font-black hover:bg-emerald-700 transition-colors cursor-pointer" %>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Announcement Detail Modal -->
  <div id="announcementDetailModal" class="fixed inset-0 z-50 hidden items-center justify-center p-4 bg-slate-900/80 backdrop-blur-sm">
    <div class="bg-white rounded-[32px] p-8 max-w-2xl w-full shadow-2xl transform transition-all max-h-[80vh] overflow-y-auto">
      <div class="flex items-center justify-between mb-6">
        <div class="flex-1">
          <h3 id="announcementDetailTitle" class="text-2xl font-black text-slate-900 mb-2"></h3>
          <p id="announcementDetailDate" class="text-sm font-bold text-slate-400"></p>
        </div>
        <button onclick="closeAnnouncementDetail()" class="text-slate-400 hover:text-slate-600 transition-colors ml-4">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      </div>
      
      <div class="prose prose-slate max-w-none">
        <p id="announcementDetailContent" class="text-slate-700 leading-relaxed whitespace-pre-wrap"></p>
      </div>
      
      <div class="mt-8 pt-6 border-t border-slate-100">
        <button onclick="closeAnnouncementDetail()" class="w-full py-3 bg-slate-100 text-slate-600 rounded-xl font-black hover:bg-slate-200 transition-colors">
          ë‹«ê¸°
        </button>
      </div>
    </div>
  </div>

  <!-- Gathering Detail Modal -->
  <div id="gatheringDetailModal" class="fixed inset-0 z-50 hidden items-center justify-center p-4 bg-slate-900/80 backdrop-blur-sm">
    <div class="bg-white rounded-[32px] p-8 max-w-2xl w-full shadow-2xl transform transition-all max-h-[80vh] overflow-y-auto">
      <div class="flex items-center justify-between mb-6">
        <h3 id="gatheringDetailTitle" class="text-2xl font-black text-slate-900"></h3>
        <button onclick="closeGatheringDetail()" class="text-slate-400 hover:text-slate-600 transition-colors ml-4">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      </div>
      
      <div class="space-y-4 mb-6">
        <div class="flex items-center gap-3 p-4 bg-emerald-50 rounded-xl">
          <svg class="w-5 h-5 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
          </svg>
          <div>
            <p class="text-xs font-bold text-emerald-600 mb-1">ì¼ì‹œ</p>
            <p id="gatheringDetailDatetime" class="font-black text-slate-900"></p>
          </div>
        </div>
        
        <div class="flex items-center gap-3 p-4 bg-blue-50 rounded-xl">
          <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
          </svg>
          <div class="flex-1">
            <p class="text-xs font-bold text-blue-600 mb-1">ì¥ì†Œ</p>
            <p id="gatheringDetailLocation" class="font-black text-slate-900 break-all"></p>
          </div>
        </div>
        
        <div class="flex items-center gap-4">
          <div class="flex items-center gap-2 px-4 py-2 bg-slate-50 rounded-xl">
            <p class="text-xs font-bold text-slate-500">ìœ í˜•</p>
            <p id="gatheringDetailType" class="font-black text-slate-900"></p>
          </div>
          <div id="gatheringDetailAttendees" class="flex items-center gap-2 px-4 py-2 bg-orange-50 rounded-xl">
            <p class="text-xs font-bold text-orange-600"></p>
          </div>
        </div>
      </div>
      
      <div class="prose prose-slate max-w-none mb-6">
        <p class="text-sm font-bold text-slate-500 mb-2">ìƒì„¸ ì•ˆë‚´</p>
        <p id="gatheringDetailDescription" class="text-slate-700 leading-relaxed whitespace-pre-wrap"></p>
      </div>
      
      <div class="pt-6 border-t border-slate-100">
        <button onclick="closeGatheringDetail()" class="w-full py-3 bg-slate-100 text-slate-600 rounded-xl font-black hover:bg-slate-200 transition-colors">
          ë‹«ê¸°
        </button>
      </div>
    </div>
  </div>

  <!-- All Announcements List Modal -->
  <div id="allAnnouncementsModal" class="fixed inset-0 z-50 hidden items-center justify-center p-4 bg-slate-900/80 backdrop-blur-sm">
    <div class="bg-white rounded-[32px] p-8 max-w-3xl w-full shadow-2xl transform transition-all max-h-[85vh] overflow-y-auto">
      <div class="flex items-center justify-between mb-6">
        <h3 class="text-2xl font-black text-slate-900">ì „ì²´ ê³µì§€ì‚¬í•­</h3>
        <button onclick="closeAllAnnouncementsModal()" class="text-slate-400 hover:text-slate-600 transition-colors">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      </div>
      
      <div class="space-y-3">
        <% @announcements.each do |notice| %>
          <div class="group cursor-pointer p-4 bg-slate-50 hover:bg-indigo-50 rounded-2xl transition-colors border border-slate-100 hover:border-indigo-200" 
               onclick="viewAnnouncement(<%= notice.id %>, '<%= j notice.title %>', '<%= j notice.content %>', '<%= notice.created_at.strftime("%Yë…„ %mì›” %dì¼") %>')">
            <div class="flex items-center justify-between mb-2">
              <span class="px-2 py-0.5 bg-amber-100 text-amber-700 text-[10px] font-black rounded-lg"><%= notice.created_at.strftime("%m/%d") %></span>
              <% if (Date.current - notice.created_at.to_date).to_i < 7 %>
                <span class="text-[10px] font-bold text-amber-500">New</span>
              <% end %>
            </div>
            <h4 class="font-black text-slate-900 group-hover:text-indigo-600 transition-colors mb-1"><%= notice.title %></h4>
            <p class="text-xs text-slate-500 line-clamp-2"><%= notice.content %></p>
          </div>
        <% end %>
      </div>
    </div>
  </div>

  <!-- All Gatherings List Modal -->
  <div id="allGatheringsModal" class="fixed inset-0 z-50 hidden items-center justify-center p-4 bg-slate-900/80 backdrop-blur-sm">
    <div class="bg-white rounded-[32px] p-8 max-w-3xl w-full shadow-2xl transform transition-all max-h-[85vh] overflow-y-auto">
      <div class="flex items-center justify-between mb-6">
        <h3 class="text-2xl font-black text-slate-900">ì „ì²´ ëª¨ì„</h3>
        <button onclick="closeAllGatheringsModal()" class="text-slate-400 hover:text-slate-600 transition-colors">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      </div>
      
      <div class="space-y-3">
        <% @gatherings.each do |gathering| %>
          <div class="bg-emerald-50/50 rounded-2xl p-4 border border-emerald-100/50 hover:bg-emerald-50 hover:border-emerald-200 transition-colors cursor-pointer" 
               onclick="viewGathering(<%= gathering.id %>, '<%= j gathering.title %>', '<%= j gathering.description %>', '<%= gathering.gathering_at.strftime("%Yë…„ %mì›” %dì¼ %H:%M") %>', '<%= j gathering.location %>', '<%= gathering.gathering_type %>', <%= gathering.max_attendees || 'null' %>)">
            <div class="flex items-center justify-between mb-2">
              <div class="flex items-center gap-2">
                <span class="px-2 py-0.5 <%= gathering.online? ? 'bg-sky-100 text-sky-600' : 'bg-orange-100 text-orange-600' %> text-[10px] font-black rounded-lg uppercase"><%= gathering.gathering_type == 'online' ? 'ON' : 'OFF' %></span>
                <span class="text-xs font-bold text-emerald-600"><%= gathering.gathering_at.strftime("%m/%d %H:%M") %></span>
              </div>
              <% if gathering.gathering_at > Time.current %>
                <span class="px-2 py-0.5 bg-green-100 text-green-600 text-[10px] font-black rounded-lg">ì˜ˆì •</span>
              <% end %>
            </div>
            <h4 class="font-black text-slate-900 mb-2"><%= gathering.title %></h4>
            <div class="flex items-center gap-2 text-[10px] font-bold text-slate-500">
              <span>ğŸ“ <%= gathering.location %></span>
              <% if gathering.max_attendees %>
                <span>Â·</span>
                <span>ì„ ì°©ìˆœ <%= gathering.max_attendees %>ëª…</span>
              <% end %>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  </div>

  <!-- All Reports Modal -->
  <div id="allReportsModal" class="fixed inset-0 z-50 hidden items-center justify-center p-4 bg-slate-900/80 backdrop-blur-sm">
    <div class="bg-white rounded-[32px] p-8 max-w-2xl w-full shadow-2xl transform transition-all max-h-[85vh] overflow-y-auto">
      <div class="flex items-center justify-between mb-6">
        <h3 class="text-2xl font-black text-slate-900">ì£¼ê°„ ë£¨í‹´ ë¦¬í¬íŠ¸ ì „ì²´ë³´ê¸°</h3>
        <button onclick="closeAllReportsModal()" class="text-slate-400 hover:text-slate-600 transition-colors">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      </div>
      
      <div class="space-y-3 md:space-y-4">
        <% reports.each do |report| %>
          <div class="bg-slate-50 border border-slate-200 rounded-2xl md:rounded-3xl p-4 md:p-6">
            <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-4">
              <div>
                <span class="inline-block px-3 py-1 bg-indigo-100 text-indigo-600 rounded-full text-xs font-black mb-2">
                  ì£¼ê°„ ë¦¬í¬íŠ¸
                </span>
                <h3 class="text-base md:text-lg font-black text-slate-900 leading-tight">
                  <%= report.start_date.strftime("%mì›” %dì¼") %> - <%= report.end_date.strftime("%mì›” %dì¼") %>
                </h3>
              </div>
              <div class="text-left md:text-right">
                <p class="text-[10px] md:text-sm font-bold text-slate-500 leading-none">ì¶œì„ë¥ </p>
                <p class="text-xl md:text-2xl font-black text-indigo-600"><%= report.attendance_rate.to_i %>%</p>
              </div>
            </div>
            
            <p class="text-sm md:text-slate-700 font-medium mb-3">
              <%= report.summary %>
            </p>
            
            <div class="bg-white rounded-xl p-4 border border-slate-100 flex items-center gap-3">
              <div class="text-2xl">ğŸ’Œ</div>
              <p class="text-indigo-600 font-bold text-sm">
                <%= report.cheering_message %>
              </p>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  </div>

<script>
  function openAnnouncementModal() {
    const modal = document.getElementById('announcementModal');
    modal.classList.remove('hidden');
    modal.classList.add('flex');
  }

  function closeAnnouncementModal() {
    const modal = document.getElementById('announcementModal');
    modal.classList.add('hidden');
    modal.classList.remove('flex');
  }

  function openGatheringModal() {
    const modal = document.getElementById('gatheringModal');
    modal.classList.remove('hidden');
    modal.classList.add('flex');
  }

  function closeGatheringModal() {
    const modal = document.getElementById('gatheringModal');
    modal.classList.add('hidden');
    modal.classList.remove('flex');
  }

  // View announcement detail
  function viewAnnouncement(id, title, content, date) {
    document.getElementById('announcementDetailTitle').textContent = title;
    document.getElementById('announcementDetailDate').textContent = date;
    document.getElementById('announcementDetailContent').textContent = content;
    
    const modal = document.getElementById('announcementDetailModal');
    modal.classList.remove('hidden');
    modal.classList.add('flex');
  }

  function closeAnnouncementDetail() {
    const modal = document.getElementById('announcementDetailModal');
    modal.classList.add('hidden');
    modal.classList.remove('flex');
  }

  // View gathering detail
  function viewGathering(id, title, description, datetime, location, type, maxAttendees) {
    document.getElementById('gatheringDetailTitle').textContent = title;
    document.getElementById('gatheringDetailDatetime').textContent = datetime;
    document.getElementById('gatheringDetailLocation').textContent = location;
    document.getElementById('gatheringDetailType').textContent = type === 'online' ? 'ì˜¨ë¼ì¸' : 'ì˜¤í”„ë¼ì¸';
    document.getElementById('gatheringDetailDescription').textContent = description || 'ìƒì„¸ ì•ˆë‚´ê°€ ì—†ìŠµë‹ˆë‹¤.';
    
    const attendeesEl = document.getElementById('gatheringDetailAttendees');
    if (maxAttendees) {
      attendeesEl.textContent = `ì„ ì°©ìˆœ ${maxAttendees}ëª…`;
      attendeesEl.classList.remove('hidden');
    } else {
      attendeesEl.classList.add('hidden');
    }
    
    const modal = document.getElementById('gatheringDetailModal');
    modal.classList.remove('hidden');
    modal.classList.add('flex');
  }

  function closeGatheringDetail() {
    const modal = document.getElementById('gatheringDetailModal');
    modal.classList.add('hidden');
    modal.classList.remove('flex');
  }

  // Close modal when clicking outside
  document.addEventListener('click', function(event) {
    const announcementModal = document.getElementById('announcementModal');
    const gatheringModal = document.getElementById('gatheringModal');
    const announcementDetailModal = document.getElementById('announcementDetailModal');
    const gatheringDetailModal = document.getElementById('gatheringDetailModal');
    
    if (event.target === announcementModal) {
      closeAnnouncementModal();
    }
    if (event.target === gatheringModal) {
      closeGatheringModal();
    }
    if (event.target === announcementDetailModal) {
      closeAnnouncementDetail();
    }
    if (event.target === gatheringDetailModal) {
      closeGatheringDetail();
    }
    
    const allAnnouncementsModal = document.getElementById('allAnnouncementsModal');
    const allGatheringsModal = document.getElementById('allGatheringsModal');
    
    if (event.target === allAnnouncementsModal) {
      closeAllAnnouncementsModal();
    }
    if (event.target === allGatheringsModal) {
      closeAllGatheringsModal();
    }

    const allReportsModal = document.getElementById('allReportsModal');
    if (event.target === allReportsModal) {
      closeAllReportsModal();
    }
  });

  // All announcements list modal
  function openAllAnnouncementsModal() {
    const modal = document.getElementById('allAnnouncementsModal');
    modal.classList.remove('hidden');
    modal.classList.add('flex');
  }

  function closeAllAnnouncementsModal() {
    const modal = document.getElementById('allAnnouncementsModal');
    modal.classList.add('hidden');
    modal.classList.remove('flex');
  }

  // All gatherings list modal
  function openAllGatheringsModal() {
    const modal = document.getElementById('allGatheringsModal');
    modal.classList.remove('hidden');
    modal.classList.add('flex');
  }

  function closeAllGatheringsModal() {
    const modal = document.getElementById('allGatheringsModal');
    modal.classList.add('hidden');
    modal.classList.remove('flex');
  }

  // All activities modal
  function openAllActivitiesModal() {
    const modal = document.getElementById('allActivitiesModal');
    modal.classList.remove('hidden');
    modal.classList.add('flex');
  }

  function closeAllActivitiesModal() {
    const modal = document.getElementById('allActivitiesModal');
    modal.classList.add('hidden');
    modal.classList.remove('flex');
  }

  // All reports modal
  function openAllReportsModal() {
    const modal = document.getElementById('allReportsModal');
    modal.classList.remove('hidden');
    modal.classList.add('flex');
  }

  function closeAllReportsModal() {
    const modal = document.getElementById('allReportsModal');
    modal.classList.add('hidden');
    modal.classList.remove('flex');
  }
</script>

<!-- All Activities Modal -->
<div id="allActivitiesModal" class="fixed inset-0 z-50 hidden items-center justify-center p-4 bg-slate-900/80 backdrop-blur-sm">
  <div class="bg-white rounded-2xl p-6 max-w-2xl w-full shadow-2xl transform transition-all max-h-[85vh] overflow-y-auto">
    <div class="flex items-center justify-between mb-5">
      <div>
        <h3 class="text-xl font-black text-slate-900">ì „ì²´ ë£¨í‹´ í˜„í™©</h3>
        <p class="text-[10px] text-slate-400 font-medium mt-0.5">ë©¤ë²„ë“¤ì˜ ëª¨ë“  ê¸°ë¡</p>
      </div>
      <button onclick="closeAllActivitiesModal()" class="text-slate-400 hover:text-slate-600 transition-colors">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
        </svg>
      </button>
    </div>
    
    <div class="space-y-2">
      <% all_attendances = @routine_club.attendances.includes(routine_club_member: :user).recent.limit(20) %>
      <% 
        # ì˜ˆì‹œ ë°ì´í„° (ëª¨ë‹¬ìš©)
        modal_example_data = [
          { name: "ê¹€ë£¨í‹´", time: "5ë¶„", text: "ì˜¤ëŠ˜ë„ ìƒˆë²½ 5ì‹œ ê¸°ìƒ ì„±ê³µ! ë¯¸ë¼í´ ëª¨ë‹ìœ¼ë¡œ í•˜ë£¨ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤ ğŸ’ª", cheers: 12 },
          { name: "ë°•ì„±ì¥", time: "23ë¶„", text: "ì˜ì–´ ê³µë¶€ 30ë¶„ ì™„ë£Œ. ë§¤ì¼ ì¡°ê¸ˆì”© ì„±ì¥í•˜ëŠ” ì¤‘!", cheers: 8 },
          { name: "ì´íŒŒì¸ë”", time: "1ì‹œê°„", text: "ìš´ë™ 1ì‹œê°„ + ë…ì„œ 30ë¶„ ì™„ë£Œ. ì˜¤ëŠ˜ë„ ì•Œì°¬ í•˜ë£¨ì˜€ì–´ìš” ğŸ“š", cheers: 15 },
          { name: "ìµœê¾¸ì¤€", time: "2ì‹œê°„", text: "ì‚¬ì´ë“œ í”„ë¡œì íŠ¸ ì½”ë”© 2ì‹œê°„. ë“œë””ì–´ ê¸°ëŠ¥ êµ¬í˜„ ì™„ë£Œ!", cheers: 6 },
          { name: "ì •ì—´ì •", time: "3ì‹œê°„", text: "ëª…ìƒ 10ë¶„ìœ¼ë¡œ ë§ˆìŒì„ ì •ë¦¬í–ˆìŠµë‹ˆë‹¤ ğŸ§˜â€â™€ï¸", cheers: 9 },
          { name: "ê°•ë„ì „", time: "5ì‹œê°„", text: "ì˜¤ëŠ˜ì˜ ë£¨í‹´ì„ ëª¨ë‘ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤!", cheers: 4 },
          { name: "ì†¡ì—´ì‹¬", time: "6ì‹œê°„", text: "ë…ì„œ 1ì‹œê°„ ì™„ë£Œ! ì˜¤ëŠ˜ì€ ìê¸°ê³„ë°œì„œë¥¼ ì½ì—ˆì–´ìš” ğŸ“–", cheers: 11 },
          { name: "í•œì„±ì‹¤", time: "7ì‹œê°„", text: "ì•„ì¹¨ ì¡°ê¹… 5km ì™„ì£¼! ë‚ ì”¨ê°€ ì¢‹ì•„ì„œ ê¸°ë¶„ë„ ì¢‹ë„¤ìš” ğŸƒ", cheers: 7 },
          { name: "ìœ¤ê¾¸ì¤€", time: "8ì‹œê°„", text: "ì˜ì–‘ì œ ì±™ê²¨ë¨¹ê¸° + ë¬¼ 2L ë§ˆì‹œê¸° ì™„ë£Œ", cheers: 5 },
          { name: "ì„ë…¸ë ¥", time: "9ì‹œê°„", text: "í•˜ë£¨ ê³„íš ì„¸ìš°ê¸°ì™€ íšŒê³  ì‘ì„± ì™„ë£Œí–ˆìŠµë‹ˆë‹¤", cheers: 10 },
        ]
      %>
      
      <% if all_attendances.any? %>
        <% all_attendances.each do |attendance| %>
          <div class="group bg-white hover:bg-slate-50 border border-slate-100 rounded-lg p-2.5 md:p-3 transition-all">
            <div class="flex items-center gap-2 md:gap-2.5">
              <div class="w-8 h-8 md:w-10 md:h-10 rounded-lg overflow-hidden ring-1 ring-slate-200 shrink-0">
                <img src="<%= attendance.routine_club_member.user.profile_image %>" class="w-full h-full object-cover" />
              </div>
              <div class="flex-1 min-w-0">
                <div class="flex items-center gap-1.5 md:gap-2">
                  <p class="text-xs md:text-sm font-black text-slate-900 truncate"><%= attendance.routine_club_member.user.nickname %></p>
                  <span class="text-[8px] md:text-[10px] text-slate-400 font-medium shrink-0"><%= time_ago_in_words(attendance.created_at) %> ì „</span>
                </div>
                <p class="text-[11px] md:text-xs text-slate-600 font-medium leading-snug line-clamp-2 mt-0.5">
                  <%= attendance.proof_text.present? ? attendance.proof_text : "ì˜¤ëŠ˜ì˜ ë£¨í‹´ì„ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤!" %>
                </p>
              </div>
              <% has_cheered = attendance.cheered_by?(current_user.id) %>
              <div id="cheer-btn-modal-<%= attendance.id %>" class="shrink-0 relative z-10">
                <%= form_with url: cheer_routine_club_path(@routine_club, attendance_id: attendance.id), method: :post, data: { turbo: true } do %>
                  <button type="submit" class="flex items-center gap-1.5 px-3 py-2 md:px-4 md:py-2.5 <%= has_cheered ? 'bg-orange-100 border-orange-400 scale-105' : 'bg-orange-50 border-2 border-orange-200 shadow-sm' %> rounded-lg hover:border-orange-400 hover:bg-orange-100 transition-all text-slate-700 active:scale-95 cursor-pointer focus:outline-none">
                    <span class="text-sm md:text-base pointer-events-none transition-transform <%= 'scale-125' if has_cheered %>">ğŸ‘</span>
                    <span class="text-xs md:text-sm font-black text-orange-600 tabular-nums pointer-events-none"><%= attendance.cheers_count %></span>
                  </button>
                <% end %>
              </div>
            </div>
          </div>
        <% end %>
      <% else %>
        <% if Rails.env.development? %>
          <!-- ì˜ˆì‹œ ë°ì´í„° í‘œì‹œ (ê°œë°œ í™˜ê²½ì—ì„œë§Œ) -->
          <% modal_example_data.each_with_index do |item, index| %>
            <div class="group bg-white hover:bg-slate-50 border border-slate-100 rounded-lg p-3 transition-all opacity-60">
              <div class="flex items-center gap-2.5">
                <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-indigo-<%= 400 + (index % 3) * 100 %> to-purple-<%= 400 + (index % 3) * 100 %> shrink-0 flex items-center justify-center text-white text-sm font-black">
                  <%= item[:name][0] %>
                </div>
                <div class="flex-1 min-w-0">
                  <div class="flex items-center gap-2">
                    <p class="text-sm font-black text-slate-900"><%= item[:name] %></p>
                    <span class="text-[10px] text-slate-400 font-medium"><%= item[:time] %> ì „</span>
                  </div>
                  <p class="text-xs text-slate-600 font-medium leading-snug line-clamp-2 mt-1">
                    <%= item[:text] %>
                  </p>
                </div>
                <div class="flex items-center gap-2 px-4 py-2.5 bg-orange-50/50 border-2 border-orange-100 rounded-lg hover:border-orange-400 hover:bg-orange-100 transition-all text-slate-700 shadow-sm active:scale-95 cursor-pointer relative z-20 group/cheer" onclick="fakeCheer(this)">
                <span class="text-base pointer-events-none group-active/cheer:scale-125 transition-transform inline-block">ğŸ‘</span>
                <span class="text-sm font-black text-orange-600 tabular-nums pointer-events-none count-val"><%= item[:cheers] %></span>
              </div>
              </div>
            </div>
          <% end %>
          
          <div class="mt-4 py-6 text-center bg-indigo-50/50 rounded-xl border border-indigo-100">
            <p class="text-indigo-600 font-bold text-xs mb-1">ğŸ‘† ì˜ˆì‹œ ë°ì´í„°ì…ë‹ˆë‹¤ (ê°œë°œ í™˜ê²½)</p>
            <p class="text-slate-400 text-[10px] font-medium">ì‹¤ì œ ë©¤ë²„ë“¤ì˜ ê¸°ë¡ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤</p>
          </div>
        <% else %>
          <div class="py-12 text-center bg-slate-50/50 rounded-xl border border-dashed border-slate-200">
            <div class="w-12 h-12 bg-white rounded-2xl flex items-center justify-center text-2xl mx-auto shadow-sm mb-3">ğŸï¸</div>
            <p class="text-slate-400 font-bold text-sm">ì•„ì§ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤</p>
          </div>
        <% end %>
      <% end %>
    </div>
  </div>
</div>

<% end %>

<% content_for :scripts do %>
<script>
  // Close modal when clicking outside
  document.addEventListener('click', function(event) {
    const allActivitiesModal = document.getElementById('allActivitiesModal');
    if (event.target === allActivitiesModal) {
      closeAllActivitiesModal();
    }
  });

  // Modal functions
  function openAllActivitiesModal() {
    const modal = document.getElementById('allActivitiesModal');
    if (modal) {
      modal.classList.remove('hidden');
      modal.classList.add('flex');
    }
  }

  function closeAllActivitiesModal() {
    const modal = document.getElementById('allActivitiesModal');
    if (modal) {
      modal.classList.add('hidden');
      modal.classList.remove('flex');
    }
  }

  // Fake cheer for dummy data
  function fakeCheer(element) {
    const countEl = element.querySelector('.count-val');
    if (!countEl) return;
    
    let currentCount = parseInt(countEl.innerText.trim()) || 0;
    
    if (!element.getAttribute('data-cheered')) {
      // Toggle ON
      countEl.innerText = currentCount + 1;
      element.setAttribute('data-cheered', 'true');
      
      // Update styles to look "active"
      element.classList.remove('bg-orange-50/50', 'border-orange-100');
      element.classList.add('bg-orange-100', 'border-orange-400', 'scale-105');
      
      // Floating emoji effect
      const emoji = document.createElement('span');
      emoji.innerText = 'ğŸ‘';
      emoji.style.position = 'absolute';
      emoji.style.top = '0';
      emoji.style.left = '50%';
      emoji.style.transform = 'translateX(-50%)';
      emoji.style.transition = 'all 0.6s ease-out';
      emoji.style.fontSize = '20px';
      emoji.style.pointerEvents = 'none';
      emoji.style.zIndex = '100';
      element.appendChild(emoji);
      
      setTimeout(() => {
        emoji.style.transform = 'translate(-50%, -40px) scale(1.5)';
        emoji.style.opacity = '0';
      }, 10);
      
      setTimeout(() => emoji.remove(), 600);
    } else {
      // Toggle OFF
      countEl.innerText = Math.max(0, currentCount - 1);
      element.removeAttribute('data-cheered');
      
      element.classList.add('bg-orange-50/50', 'border-orange-100');
      element.classList.remove('bg-orange-100', 'border-orange-400', 'scale-105');
    }
  }
</script>
<% end %>
