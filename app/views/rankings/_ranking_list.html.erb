<div class="bg-white rounded-[48px] border border-slate-100 shadow-2xl overflow-hidden max-w-4xl mx-auto">
  <% if rankings.any? %>
    <% rankings.each_with_index do |user, index| %>
      <% rank = index + 4 %>
      <div class="flex items-center gap-6 p-6 border-b border-slate-50 last:border-b-0 hover:bg-slate-50 transition-all group">
        <span class="w-10 text-center font-black text-slate-300 text-lg group-hover:text-indigo-600 transition-colors"><%= rank.to_s.rjust(2, '0') %></span>
        
        <div class="w-16 h-16 rounded-[24px] bg-slate-100 p-0.5 border border-slate-200 group-hover:scale-105 transition-transform shrink-0">
          <img src="<%= user.profile_image || "https://api.dicebear.com/7.x/lorelei/svg?seed=#{user.nickname}&backgroundColor=b6e3f4,c0aede,d1d4f9,ffd5dc,ffdfbf" %>" class="w-full h-full object-cover rounded-[22px]" alt="">
        </div>

        <div class="flex-1">
          <div class="flex items-center gap-3">
            <h5 class="text-lg font-black text-slate-900 leading-tight"><%= user.nickname %></h5>
            <% if metric_key == :badge_count && user.badges.any? %>
              <div class="flex -space-x-2">
                <% user.badges.limit(5).each do |badge| %>
                  <div class="w-6 h-6 rounded-full bg-white border border-slate-100 flex items-center justify-center text-[10px] shadow-sm" title="<%= badge.name %>">
                    <%= badge.icon_path %>
                  </div>
                <% end %>
                <% if user.badges.size > 5 %>
                  <div class="w-6 h-6 rounded-full bg-slate-50 border border-slate-100 flex items-center justify-center text-[8px] font-black text-slate-400 shadow-sm">+<%= user.badges.size - 5 %></div>
                <% end %>
              </div>
            <% end %>
          </div>
          <div class="flex items-center gap-2 mt-1">
            <span class="px-2 py-0.5 bg-slate-100 rounded-md text-[10px] font-black text-slate-400 uppercase">Lv.<%= user.level %></span>
            <span class="text-[10px] font-bold text-slate-400">가입일 <%= user.created_at.strftime("%Y.%m") %></span>
            <% if user.respond_to?(:avg_rate) && user.avg_rate.present? %>
              <span class="w-0.5 h-0.5 bg-slate-200 rounded-full"></span>
              <span class="text-[10px] font-bold text-indigo-500">평균 달성률 <%= number_to_percentage(user.avg_rate, precision: 1) %></span>
            <% end %>
            <% if user.respond_to?(:hosted_count) && user.hosted_count.present? %>
              <span class="w-0.5 h-0.5 bg-slate-200 rounded-full"></span>
              <span class="text-[10px] font-bold text-indigo-500">주최 <%= user.hosted_count %>회</span>
            <% end %>
          </div>
        </div>

        <div class="text-right">
          <% 
            metric_val = if defined?(metric_key)
                           user.respond_to?(metric_key) ? user.send(metric_key) : 0
                         else
                           user.respond_to?(:weekly_count) ? user.weekly_count : 0
                         end
          %>
          <p class="text-2xl font-black text-indigo-600 tracking-tighter"><%= number_with_delimiter(metric_val) %></p>
          <p class="text-[10px] font-black text-slate-400 uppercase tracking-widest"><%= metric_label %></p>
        </div>
      </div>
    <% end %>
  <% else %>
    <div class="p-20 text-center">
      <div class="w-20 h-20 bg-slate-50 rounded-3xl flex items-center justify-center mx-auto mb-6">
        <svg class="w-10 h-10 text-slate-200" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"/></svg>
      </div>
      <p class="text-slate-400 font-bold">랭킹 데이터가 부족합니다.</p>
    </div>
  <% end %>
</div>
