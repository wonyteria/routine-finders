<div class="space-y-4">
  <div class="flex items-center justify-between">
    <div class="flex items-center gap-3">
       <!-- Avatar -->
       <div class="w-10 h-10 rounded-full bg-[#1A1A24] border border-white/10 flex items-center justify-center text-lg shadow-lg shrink-0 overflow-hidden">
        <% if @target_user.avatar.attached? %>
          <%= image_tag @target_user.avatar, class: "w-full h-full object-cover" %>
        <% else %>
          <span class="font-black text-slate-300"><%= @target_user.nickname[0].upcase %></span>
        <% end %>
      </div>
      <div>
        <h3 class="text-lg font-black text-white"><%= @target_user.nickname %></h3>
        <p class="text-[11px] font-bold text-slate-500"><%= @analysis_title %></p>
      </div>
    </div>
    <div class="text-right">
       <% avg_rate = @daily_analysis.sum { |d| d[:rate] } / [@daily_analysis.size, 1].max %>
       <span class="block text-[9px] font-black text-slate-500 uppercase">Avg. Rate</span>
       <span class="text-xl font-black <%= avg_rate >= 80 ? 'text-emerald-400' : (avg_rate >= 50 ? 'text-amber-400' : 'text-slate-400') %>"><%= avg_rate.round(1) %>%</span>
    </div>
  </div>

  <div class="bg-black/20 rounded-xl border border-white/5 overflow-hidden max-h-[50vh] overflow-y-auto custom-scrollbar">
    <table class="w-full text-left">
      <thead class="bg-white/5 text-[9px] font-black text-slate-500 uppercase tracking-widest border-b border-white/5 sticky top-0 backdrop-blur-md z-10">
        <tr>
          <th class="px-4 py-3 bg-[#1B1A24]/90">Date</th>
          <th class="px-4 py-3 text-center bg-[#1B1A24]/90">Status</th>
          <th class="px-4 py-3 text-right bg-[#1B1A24]/90">Rate</th>
          <th class="px-4 py-3 bg-[#1B1A24]/90">Missed</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-white/5">
        <% @daily_analysis.each do |day| %>
          <tr class="group hover:bg-white/[0.02] transition-colors">
            <td class="px-4 py-3 whitespace-nowrap">
              <div class="flex items-center gap-1.5">
                <span class="text-xs font-bold text-slate-300"><%= day[:date].strftime('%m.%d') %></span>
                <span class="text-[9px] font-medium text-slate-500">(<%= day[:day_name] %>)</span>
              </div>
            </td>
            <td class="px-4 py-3 text-center whitespace-nowrap">
               <div class="flex items-baseline justify-center gap-0.5">
                 <span class="text-xs font-black text-white"><%= day[:completed] %></span>
                 <span class="text-[10px] text-slate-500">/ <%= day[:total] %></span>
               </div>
            </td>
            <td class="px-4 py-3 text-right whitespace-nowrap">
              <span class="text-xs font-black <%= day[:rate] == 100 ? 'text-emerald-400' : (day[:rate] >= 50 ? 'text-amber-400' : 'text-rose-400') %>">
                <%= day[:rate] %>%
              </span>
            </td>
            <td class="px-4 py-3">
              <% if day[:missed].any? %>
                <div class="flex flex-wrap gap-1">
                  <% day[:missed].each do |task| %>
                    <span class="px-1.5 py-0.5 rounded bg-rose-500/10 border border-rose-500/20 text-[9px] font-bold text-rose-400 truncate max-w-[150px]"><%= task %></span>
                  <% end %>
                </div>
              <% elsif day[:total] == 0 %>
                <span class="text-[10px] text-slate-600 italic">-</span>
              <% else %>
                <span class="text-[10px] font-bold text-emerald-500">All Clear! üéâ</span>
              <% end %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
  <div class="text-center">
    <p class="text-[9px] text-slate-500">* ÏÇ≠Ï†úÎêú Î£®Ìã¥ÏùÄ ÌÜµÍ≥Ñ Í≥ÑÏÇ∞ÏóêÏÑú Ï†úÏô∏Îê©ÎãàÎã§.</p>
  </div>
</div>
