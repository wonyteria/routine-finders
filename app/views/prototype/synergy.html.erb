<div class="space-y-10 pt-2">
  <!-- 1. Hall of Fame (Podium) -->
  <section class="space-y-6">
    <div class="text-center space-y-1">
      <h3 class="text-xs font-black text-indigo-400 uppercase tracking-[0.3em]">이달의 통합 성취 랭킹</h3>
      <p class="text-[10px] font-bold text-slate-500">모두가 함께 경쟁하고 성장하는 명예의 전당</p>
    </div>

    <!-- Podium Visual -->
    <div class="relative h-60 flex items-end justify-center gap-2 px-4">
      <!-- Top 2 -->
      <div class="flex flex-col items-center gap-3 w-24">
        <%= link_to prototype_user_card_path(@top_users[1]&.id || 0), data: { turbo_frame: "user-profile-modal-frame" }, class: "group contents" do %>
          <div class="relative">
            <div class="w-16 h-16 rounded-full border-4 border-slate-400 overflow-hidden shadow-2xl group-active:scale-95 transition-transform">
              <img src="<%= @top_users[1]&.profile_image %>" class="w-full h-full object-cover">
            </div>
            <div class="absolute -top-2 -right-2 w-7 h-7 bg-slate-400 rounded-full flex items-center justify-center text-white font-black border-2 border-[#0C0B12] text-xs shadow-lg">2</div>
          </div>
          <div class="w-full h-24 bg-slate-800/40 rounded-t-[20px] border border-white/5 flex flex-col items-center justify-center group-hover:bg-slate-800/60 transition-colors">
             <p class="text-[11px] font-black text-white line-clamp-1"><%= @top_users[1]&.nickname %></p>
             <div class="flex items-center gap-1 mt-0.5">
               <% if @monthly_rankings[1]&.dig(:is_club) %>
                 <span class="text-[8px]">🔱</span>
               <% end %>
               <p class="text-[9px] font-bold text-slate-500"><%= @monthly_rankings[1]&.dig(:score)&.round(1) || 0 %>P</p>
             </div>
          </div>
        <% end %>
      </div>

      <!-- Top 1 (Center) -->
      <div class="flex flex-col items-center gap-3 w-28 -translate-y-4">
        <%= link_to prototype_user_card_path(@top_users[0]&.id || 0), data: { turbo_frame: "user-profile-modal-frame" }, class: "group contents" do %>
          <div class="relative">
            <div class="absolute inset-0 bg-indigo-500 blur-2xl opacity-40 animate-pulse"></div>
            <div class="relative w-20 h-20 rounded-full border-4 border-amber-400 overflow-hidden shadow-2xl group-active:scale-95 transition-transform">
              <img src="<%= @top_users[0]&.profile_image %>" class="w-full h-full object-cover">
            </div>
            <div class="absolute -top-3 -right-3 w-9 h-9 bg-amber-400 rounded-full flex items-center justify-center text-white font-black border-4 border-[#0C0B12] text-sm shadow-xl">👑</div>
          </div>
          <div class="w-full h-32 bg-indigo-500/10 rounded-t-[20px] border border-indigo-500/30 flex flex-col items-center justify-center shadow-[0_0_20px_rgba(124,77,255,0.2)] group-hover:bg-indigo-500/20 transition-colors">
             <p class="text-sm font-black text-white line-clamp-1"><%= @top_users[0]&.nickname %></p>
             <div class="flex items-center gap-1 mt-1">
                <% if @monthly_rankings[0]&.dig(:is_club) %>
                  <span class="px-2 py-0.5 rounded-full bg-indigo-500 text-[8px] font-black text-white flex items-center gap-1">
                    🔱 루파
                  </span>
                <% end %>
               <p class="text-[10px] font-bold text-indigo-400"><%= @monthly_rankings[0]&.dig(:score)&.round(1) || 0 %>P</p>
             </div>
          </div>
        <% end %>
      </div>

      <!-- Top 3 -->
      <div class="flex flex-col items-center gap-3 w-24">
        <%= link_to prototype_user_card_path(@top_users[2]&.id || 0), data: { turbo_frame: "user-profile-modal-frame" }, class: "group contents" do %>
          <div class="relative">
            <div class="w-16 h-16 rounded-full border-4 border-amber-700/50 overflow-hidden shadow-2xl group-active:scale-95 transition-transform">
              <img src="<%= @top_users[2]&.profile_image %>" class="w-full h-full object-cover">
            </div>
            <div class="absolute -top-2 -right-2 w-7 h-7 bg-amber-700/80 rounded-full flex items-center justify-center text-white font-black border-2 border-[#0C0B12] text-xs shadow-lg">3</div>
          </div>
          <div class="w-full h-20 bg-slate-800/20 rounded-t-[20px] border border-white/5 flex flex-col items-center justify-center group-hover:bg-slate-800/40 transition-colors">
             <p class="text-[11px] font-black text-white line-clamp-1"><%= @top_users[2]&.nickname %></p>
             <div class="flex items-center gap-1 mt-0.5">
               <% if @monthly_rankings[2]&.dig(:is_club) %>
                 <span class="text-[8px]">🔱</span>
               <% end %>
               <p class="text-[9px] font-bold text-slate-500"><%= @monthly_rankings[2]&.dig(:score)&.round(1) || 0 %>P</p>
             </div>
          </div>
        <% end %>
      </div>
    </div>
  </section>

  <!-- 1.5 Integrated Leaderboard Table -->
  <section class="space-y-4">
    <div class="flex justify-between items-center px-2">
      <h3 class="text-xs font-black text-slate-500 uppercase tracking-[0.2em]">🏆 리더보드</h3>
      <div class="flex items-center gap-2">
        <button type="button" 
                onclick="document.getElementById('score-guide-modal').classList.remove('hidden')"
                class="px-2 py-0.5 bg-indigo-500/10 rounded-full flex items-center gap-1 hover:bg-indigo-500/20 transition-colors">
          <span class="text-[8px] font-black text-indigo-400">포인트 기준</span>
          <svg class="w-2.5 h-2.5 text-indigo-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
        </button>
        <p class="text-[10px] font-bold text-indigo-400"><%= Date.current.strftime('%Y년 %m월') %></p>
      </div>
    </div>

    <!-- Period Tabs (Updated) -->
    <div class="grid grid-cols-2 bg-white/5 p-1 rounded-2xl mx-1">
      <%= link_to prototype_synergy_path(period: 'monthly', rank_type: params[:rank_type]), 
                  data: { turbo_frame: "ranking_list" },
                  class: "py-2.5 text-center rounded-xl text-[11px] font-black transition-all #{@period == 'monthly' || @period.nil? ? 'bg-indigo-500 text-white shadow-lg shadow-indigo-500/20' : 'text-slate-500 hover:text-white'}" do %>
        <span>📅 이번 달</span>
      <% end %>
      <%= link_to prototype_synergy_path(period: 'total', rank_type: params[:rank_type]), 
                  data: { turbo_frame: "ranking_list" },
                  class: "py-2.5 text-center rounded-xl text-[11px] font-black transition-all #{@period == 'total' ? 'bg-indigo-500 text-white shadow-lg shadow-indigo-500/20' : 'text-slate-500 hover:text-white'}" do %>
        <span>🔥 전체 누적</span>
      <% end %>
    </div>

    <!-- Type Filters (Secondary) -->
    <div class="flex gap-2 px-2 justify-end">
       <%= link_to "전체 보기", prototype_synergy_path(period: @period, rank_type: 'all'), 
                   data: { turbo_frame: "ranking_list" },
                   class: "text-[10px] font-bold px-2 py-1 rounded-lg transition-colors #{params[:rank_type] != 'club' ? 'text-white bg-white/10' : 'text-slate-600 hover:text-slate-400'}" %>
       <%= link_to "루파 멤버만", prototype_synergy_path(period: @period, rank_type: 'club'), 
                   data: { turbo_frame: "ranking_list" },
                   class: "text-[10px] font-bold px-2 py-1 rounded-lg transition-colors #{params[:rank_type] == 'club' ? 'text-indigo-400 bg-indigo-500/10' : 'text-slate-600 hover:text-slate-400'}" %>
    </div>

    <!-- Ranking List Partial -->
    <%= render partial: "ranking_list", locals: { rankings: @monthly_rankings, period: @period || 'monthly' } %>
  </section>

  <!-- Full Ranking Modal -->
  <div id="full-ranking-modal" class="hidden fixed inset-0 z-[100] flex items-end sm:items-center justify-center p-0 sm:p-4">
    <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" onclick="this.parentElement.classList.add('hidden')"></div>
    <div class="relative w-full max-w-lg h-[90vh] sm:h-[80vh] bg-[#0C0B12] rounded-t-[40px] sm:rounded-[40px] border-t sm:border border-white/10 flex flex-col overflow-hidden animate-slide-up">
      <!-- Modal Header -->
      <div class="sticky top-0 z-20 bg-[#0C0B12] p-6 border-b border-white/5">
        <div class="flex justify-between items-center mb-4">
          <h4 class="text-lg font-black text-white">전체 통합 리더보드</h4>
          <button onclick="this.closest('#full-ranking-modal').classList.add('hidden')" class="w-8 h-8 rounded-full bg-white/5 flex items-center justify-center text-slate-400">✕</button>
        </div>
        <div class="flex items-center gap-2">
          <% if @my_ranking %>
            <div class="flex-1 p-4 bg-indigo-600/20 border border-indigo-500/30 rounded-2xl flex items-center justify-between">
              <div class="flex items-center gap-3">
                <span class="text-xs font-black text-indigo-400">#<%= @my_ranking[:rank] %></span>
                <span class="text-[11px] font-bold text-white"><%= current_user.nickname %>님 (나)</span>
              </div>
              <span class="text-xs font-black text-indigo-400"><%= @my_ranking[:score] %>P</span>
            </div>
          <% end %>
        </div>
      </div>

      <!-- Modal Body -->
      <div class="flex-1 overflow-y-auto p-4 space-y-2 pb-[160px]">
        <% @monthly_rankings.each_with_index do |ranking, index| %>
          <% user = ranking[:user] %>
          <%= link_to prototype_user_card_path(user), data: { turbo_frame: "user-profile-modal-frame" }, class: "flex items-center justify-between p-4 #{user == current_user ? 'bg-indigo-600/10 border border-indigo-500/20' : 'bg-white/[0.03]'} rounded-2xl hover:bg-white/[0.08] transition-colors" do %>
            <div class="flex items-center gap-4">
              <div class="w-6 text-center text-[10px] font-black <%= index < 3 ? 'text-amber-400' : 'text-slate-500' %>"><%= index + 1 %></div>
              <div class="w-8 h-8 rounded-lg overflow-hidden shrink-0">
                <img src="<%= user.profile_image %>" class="w-full h-full object-cover">
              </div>
              <div>
                <div class="flex items-center gap-1.5">
                  <span class="text-xs font-black text-white line-clamp-1"><%= user.nickname %></span>
                  <% if ranking[:is_club] %>
                    <span class="text-[8px]">🔱</span>
                  <% end %>
                </div>
                <p class="text-[8px] font-bold text-slate-500">Lv.<%= user.level %></p>
              </div>
            </div>
            <p class="text-xs font-bold text-white"><%= ranking[:score] %>P</p>
          <% end %>
        <% end %>
      </div>
    </div>
  </div>

  <!-- Score Guide Modal -->
  <div id="score-guide-modal" class="hidden fixed inset-0 z-[100] flex items-center justify-center p-6">
    <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" onclick="this.parentElement.classList.add('hidden')"></div>
    <div class="relative w-full max-w-sm bg-[#1B1A24] rounded-[32px] border border-white/10 p-8 animate-badge-pop shadow-2xl">
      <div class="flex justify-between items-start mb-6">
        <div>
          <h3 class="text-xl font-black text-white mb-1">🏆 랭킹 포인트 기준</h3>
          <p class="text-[10px] font-bold text-slate-500">활동에 따라 점수가 자동으로 집계됩니다.</p>
        </div>
        <button onclick="this.closest('#score-guide-modal').classList.add('hidden')" class="w-8 h-8 rounded-full bg-white/5 flex items-center justify-center text-slate-400 hover:text-white hover:bg-white/10 transition-colors">✕</button>
      </div>
      
      <div class="space-y-3">
        <div class="flex justify-between items-center p-3 rounded-xl bg-white/5 border border-white/5">
          <div class="flex items-center gap-3">
            <span class="text-lg">✔️</span>
            <span class="text-xs font-bold text-white">루틴 1회 완료</span>
          </div>
          <span class="text-xs font-black text-indigo-400">+10 P</span>
        </div>
        <div class="flex justify-between items-center p-3 rounded-xl bg-white/5 border border-white/5">
          <div class="flex items-center gap-3">
            <span class="text-lg">📝</span>
            <span class="text-xs font-bold text-white">오늘의 확언 작성</span>
          </div>
          <span class="text-xs font-black text-indigo-400">+5 P</span>
        </div>
        <div class="flex justify-between items-center p-3 rounded-xl bg-white/5 border border-white/5">
          <div class="flex items-center gap-3">
            <span class="text-lg">🔥</span>
            <span class="text-xs font-bold text-white">라이브룸 참여</span>
          </div>
          <span class="text-xs font-black text-indigo-400">+20 P</span>
        </div>
        <div class="flex justify-between items-center p-3 rounded-xl bg-white/5 border border-white/5">
          <div class="flex items-center gap-3">
            <span class="text-lg">🚩</span>
            <span class="text-xs font-bold text-white">챌린지/모임 개설</span>
          </div>
          <span class="text-xs font-black text-indigo-400">+100 P</span>
        </div>
        <div class="flex justify-between items-center p-3 rounded-xl bg-white/5 border border-white/5">
          <div class="flex items-center gap-3">
            <span class="text-lg">🏃</span>
            <span class="text-xs font-bold text-white">챌린지/모임 참여</span>
          </div>
          <span class="text-xs font-black text-indigo-400">+50 P</span>
        </div>
      </div>
    </div>
  </div>

  </style>


  
</div>

