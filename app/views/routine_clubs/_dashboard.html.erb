<div class="space-y-8">
  
  <!-- Stats Overview: Premium Bauhaus Style -->
  <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4 lg:gap-6">
    <div class="bg-slate-900 rounded-[32px] p-6 lg:p-8 text-white shadow-xl relative overflow-hidden group hover:scale-[1.02] transition-transform">
      <div class="absolute -right-4 -top-4 w-24 h-24 bg-indigo-600/20 rounded-full blur-2xl"></div>
      <p class="text-[10px] font-black text-indigo-300 uppercase tracking-widest mb-3 leading-none">ì„±ì¥ ì—ë„ˆì§€</p>
      <div class="flex items-baseline gap-1">
        <p class="text-3xl lg:text-4xl font-black tracking-tight tabular-nums"><%= @my_membership.growth_points || 0 %></p>
        <p class="text-xs font-bold text-indigo-400">P</p>
      </div>
    </div>

    <div class="bg-white rounded-[32px] p-6 lg:p-8 border border-slate-100 shadow-sm relative overflow-hidden group hover:scale-[1.02] transition-transform">
      <p class="text-[10px] font-black text-purple-400 uppercase tracking-widest mb-3 leading-none">ë‹¬ì„±ë¥ </p>
      <div class="flex items-baseline gap-1">
        <p class="text-3xl lg:text-4xl font-black text-slate-900 tracking-tight tabular-nums"><%= @my_membership.achievement_rate.to_i %></p>
        <p class="text-xs font-bold text-slate-400">%</p>
      </div>
      <div class="mt-4 w-full bg-slate-100 h-1.5 rounded-full overflow-hidden">
        <div class="bg-gradient-to-r from-purple-500 to-indigo-600 h-full transition-all duration-1000" style="width: <%= @my_membership.achievement_rate.to_i %>%"></div>
      </div>
    </div>
    
    <a href="#attendance-calendar" class="bg-white rounded-[32px] p-6 lg:p-8 border border-slate-100 shadow-sm relative overflow-hidden group hover:scale-[1.02] transition-transform">
      <p class="text-[10px] font-black text-emerald-400 uppercase tracking-widest mb-3 leading-none">ì¶œì„ë¥ </p>
      <div class="flex items-baseline gap-1">
        <p class="text-3xl lg:text-4xl font-black text-slate-900 tracking-tight tabular-nums"><%= @my_membership.attendance_rate.to_i %></p>
        <p class="text-xs font-bold text-slate-400">%</p>
      </div>
      <div class="mt-4 w-full bg-slate-100 h-1.5 rounded-full overflow-hidden">
        <div class="bg-emerald-500 h-full transition-all duration-1000" style="width: <%= @my_membership.attendance_rate.to_i %>%"></div>
      </div>
    </a>
    
    <div class="bg-white rounded-[32px] p-6 lg:p-8 border border-slate-100 shadow-sm relative overflow-hidden group hover:scale-[1.02] transition-transform cursor-help" 
         title="ì˜¤ëŠ˜ ë¶„ëŸ‰ ë©´ì œ & ì¶œì„ë¥  70% ë³´í˜¸">
      <p class="text-[10px] font-black text-blue-400 uppercase tracking-widest mb-3 leading-none">íœ´ì‹ê¶Œ</p>
      <div class="flex items-center justify-between">
        <p class="text-3xl lg:text-4xl font-black text-slate-900 tracking-tight tabular-nums"><%= @my_membership.remaining_passes %><span class="text-xs font-bold text-slate-400 ml-1">ê°œ</span></p>
        <% 
          today_attendance = @my_membership.attendances.find_by(attendance_date: Date.current)
          # Show button if: has passes remaining AND hasn't used pass today
          can_use_pass = @my_membership.remaining_passes > 0 && !today_attendance&.status_excused?
        %>
        <% if can_use_pass %>
          <%= button_to use_pass_routine_club_path(@routine_club), method: :post, 
                        class: "px-3 py-1.5 bg-blue-50 text-blue-600 rounded-xl text-[10px] font-black border border-blue-100 hover:bg-blue-600 hover:text-white transition-all", 
                        data: { turbo_confirm: "íœ´ì‹ê¶Œì„ ì‚¬ìš©í•˜ì‹œê² ìŠµë‹ˆê¹Œ?", turbo: false } do %>
             ì‚¬ìš©
          <% end %>
        <% elsif today_attendance&.status_excused? %>
          <span class="px-3 py-1.5 bg-green-50 text-green-600 rounded-xl text-[10px] font-black border border-green-100">ì‚¬ìš©ì™„ë£Œ</span>
        <% end %>
      </div>
    </div>
    
    <div class="bg-white rounded-[32px] p-6 lg:p-8 border border-slate-100 shadow-sm relative overflow-hidden group hover:scale-[1.02] transition-transform">
      <p class="text-[10px] font-black text-amber-500 uppercase tracking-widest mb-3 leading-none">ëˆ„ì  ê²½ê³ </p>
      <div class="flex items-baseline gap-1">
        <p class="text-3xl lg:text-4xl font-black text-slate-900 tracking-tight tabular-nums"><%= @my_membership.penalty_count %></p>
        <p class="text-xs font-bold text-slate-400">íšŒ</p>
      </div>
      <div class="absolute -right-2 -bottom-2 text-4xl opacity-5 group-hover:scale-110 transition-transform">âš ï¸</div>
    </div>
  </div>

  <% days_left = (@my_membership.membership_end_date - Date.current).to_i %>
  <% if days_left.between?(1, 14) %>
    <div class="bg-gradient-to-r from-orange-500 to-pink-500 rounded-[32px] p-8 text-white flex flex-col md:flex-row items-center justify-between gap-6 shadow-xl shadow-orange-200">
       <div class="space-y-1">
          <h3 class="text-2xl font-black">ë©¤ë²„ì‹­ ë§Œë£Œ ì•ˆë‚´ âœ¨</h3>
          <p class="font-bold opacity-90">ë£¨íŒŒ í´ëŸ½ ë©¤ë²„ì‹­ ì¢…ë£Œê°€ <span class="bg-white/20 px-2 py-0.5 rounded text-yellow-300"><%= days_left %>ì¼</span> ë‚¨ì•˜ìŠµë‹ˆë‹¤. ëŠê¹€ ì—†ëŠ” ì„±ì¥ì„ ìœ„í•´ ì—°ì¥í•´ ë³´ì„¸ìš”!</p>
       </div>
       <%= link_to "ë©¤ë²„ì‹­ ê¸°ê°„ ì—°ì¥í•˜ê¸°", routine_club_path(@routine_club), class: "px-8 py-4 bg-white text-orange-600 rounded-2xl font-black hover:bg-yellow-100 transition-all text-sm whitespace-nowrap" %>
    </div>
  <% end %>

  <!-- Community Board -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <!-- Announcements -->
    <div class="bg-white rounded-[32px] p-8 border border-slate-200 shadow-sm">
      <div class="flex items-center justify-between mb-6">
        <h2 class="text-xl font-black text-slate-900 flex items-center gap-2">
          <span class="text-2xl">ğŸ“¢</span> ê³µì§€ì‚¬í•­
        </h2>
        <div class="flex gap-2">
          <% if @is_host || current_user&.admin? %>
            <button onclick="openAnnouncementModal()" class="text-[10px] font-black bg-indigo-50 text-indigo-600 px-2 py-1 rounded-lg hover:bg-indigo-100 transition-colors">
              ê³µì§€ ë“±ë¡
            </button>
          <% end %>
          <% if @announcements.count > 1 %>
            <button onclick="openAllAnnouncementsModal()" class="text-xs font-bold text-slate-400 hover:text-slate-600 transition-colors">ì „ì²´ë³´ê¸°</button>
          <% end %>
        </div>
      </div>
      
      <% if @announcements.any? %>
        <div class="space-y-4">
          <% @announcements.limit(1).each do |notice| %>
            <div class="group cursor-pointer" onclick="viewAnnouncement(<%= notice.id %>, '<%= j notice.title %>', '<%= j notice.content %>', '<%= notice.created_at.strftime("%Yë…„ %mì›” %dì¼") %>')">
              <div class="flex items-center justify-between mb-1">
                <span class="px-2 py-0.5 bg-amber-100 text-amber-700 text-[10px] font-black rounded-lg"><%= notice.created_at.strftime("%m/%d") %></span>
                <% if (Date.current - notice.created_at.to_date).to_i < 7 %>
                  <span class="text-[10px] font-bold text-amber-500">New</span>
                <% end %>
              </div>
              <h3 class="font-bold text-slate-900 group-hover:text-indigo-600 transition-colors line-clamp-1"><%= notice.title %></h3>
              <p class="text-xs text-slate-500 mt-1 line-clamp-2"><%= notice.content %></p>
            </div>
          <% end %>
        </div>
      <% else %>
        <div class="text-center py-8 bg-slate-50 rounded-2xl border border-dashed border-slate-200">
          <p class="text-slate-400 font-bold text-sm">ë“±ë¡ëœ ê³µì§€ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤</p>
        </div>
      <% end %>
    </div>

    <!-- Gatherings -->
    <div class="bg-white rounded-[32px] p-8 border border-slate-200 shadow-sm">
      <div class="flex items-center justify-between mb-6">
        <h2 class="text-xl font-black text-slate-900 flex items-center gap-2">
          <span class="text-2xl">ğŸ‰</span> ë‹¤ê°€ì˜¤ëŠ” ëª¨ì„
        </h2>
        <div class="flex gap-2">
          <% if @is_host || current_user&.admin? %>
            <button onclick="openGatheringModal()" class="text-[10px] font-black bg-emerald-50 text-emerald-600 px-2 py-1 rounded-lg hover:bg-emerald-100 transition-colors">
              ëª¨ì„ ë“±ë¡
            </button>
          <% end %>
          <% if @gatherings.count > 1 %>
            <button onclick="openAllGatheringsModal()" class="text-xs font-bold text-slate-400 hover:text-slate-600 transition-colors">ì „ì²´ë³´ê¸°</button>
          <% end %>
        </div>
      </div>
      
      <% if @gatherings.any? %>
        <div class="space-y-4">
          <% @gatherings.limit(1).each do |gathering| %>
            <div class="bg-emerald-50/50 rounded-2xl p-4 border border-emerald-100/50 hover:bg-emerald-50 transition-colors cursor-pointer" 
                 onclick="viewGathering(<%= gathering.id %>, '<%= j gathering.title %>', '<%= j gathering.description %>', '<%= gathering.gathering_at.strftime("%Yë…„ %mì›” %dì¼ %H:%M") %>', '<%= j gathering.location %>', '<%= gathering.gathering_type %>', <%= gathering.max_attendees || 'null' %>)">
              <div class="flex items-center justify-between mb-1">
                <div class="flex items-center gap-2">
                  <span class="px-2 py-0.5 <%= gathering.online? ? 'bg-sky-100 text-sky-600' : 'bg-orange-100 text-orange-600' %> text-[10px] font-black rounded-lg uppercase"><%= gathering.gathering_type == 'online' ? 'ON' : 'OFF' %></span>
                  <span class="text-[10px] font-bold text-emerald-600"><%= gathering.gathering_at.strftime("%m/%d %H:%M") %></span>
                </div>
                <span class="text-[10px] font-bold text-slate-400">ğŸ“ <%= gathering.location %></span>
              </div>
              <h3 class="font-bold text-slate-900 line-clamp-1"><%= gathering.title %></h3>
              <% if gathering.max_attendees %>
                <p class="text-xs text-slate-400 mt-1">ì„ ì°©ìˆœ <%= gathering.max_attendees %>ëª…</p>
              <% end %>
            </div>
          <% end %>
        </div>
      <% else %>
        <div class="text-center py-8 bg-slate-50 rounded-2xl border border-dashed border-slate-200">
          <p class="text-slate-400 font-bold text-sm">ì˜ˆì •ëœ ëª¨ì„ì´ ì—†ìŠµë‹ˆë‹¤</p>
        </div>
      <% end %>
    </div>
  </div>
  <div class="flex flex-col lg:flex-row gap-6 lg:gap-10 items-stretch">
    <!-- Combined Mission Control Panel -->
    <div class="w-full lg:w-[45%] flex flex-col gap-6">
      <div class="bg-slate-900 rounded-[40px] p-8 lg:p-10 shadow-2xl relative overflow-hidden group flex-1 flex flex-col">
        <div class="absolute -right-16 -top-16 w-48 h-48 bg-indigo-600/30 rounded-full blur-[80px]"></div>
        
        <div class="relative z-10 mb-10 flex items-center justify-between">
          <div>
            <h2 class="text-2xl lg:text-3xl font-black text-white tracking-tight italic">ì˜¤ëŠ˜ì˜ ë£¨í‹´</h2>
            <p class="text-indigo-300 font-bold text-xs uppercase tracking-widest mt-1">ì˜¤ëŠ˜ì˜ ì •ì§„ì„ ì²´í¬í•˜ì„¸ìš”</p>
          </div>
          <div class="w-12 h-12 bg-white/10 rounded-2xl flex items-center justify-center text-2xl">âš¡</div>
        </div>

        <div class="relative z-10 flex-1 flex flex-col gap-3">
          <% 
            current_wday = Date.current.wday.to_s
            todays_routines = @personal_routines.select { |r| (r.days || []).map(&:to_s).include?(current_wday) }
          %>
          
          <% if todays_routines.any? %>
            <div class="grid grid-cols-1 gap-2.5">
              <% todays_routines.each do |routine| %>
                <% is_done = routine.completed_on?(Date.current) %>
                <%= render 'routine_clubs/dashboard_routine_item', routine: routine, is_done: is_done, selected_date: Date.current %>
              <% end %>
            </div>
          <% else %>
            <div class="flex-1 flex flex-col items-center justify-center py-10 opacity-30">
              <span class="text-5xl mb-4">ğŸ–ï¸</span>
              <p class="text-white font-bold">ì˜¤ëŠ˜ì€ íœ´ì‹ì¼ì…ë‹ˆë‹¤</p>
            </div>
          <% end %>
        </div>

        <% if todays_routines.any? %>
          <div class="mt-8 pt-6 border-t border-white/5 flex items-center justify-between">
            <div class="flex -space-x-2">
               <% [1,2,3].each do |i| %>
                 <div class="w-6 h-6 rounded-full bg-indigo-500/20 border border-indigo-500/30 flex items-center justify-center text-[10px]">âœ¨</div>
               <% end %>
            </div>
            <p class="text-[10px] font-black text-indigo-400 uppercase tracking-widest">ëª¨ë‘ ì™„ë£Œí•˜ë©´ ê¸°ë¡ì´ í™œì„±í™”ë©ë‹ˆë‹¤</p>
          </div>
        <% end %>
      </div>
    </div>

    <!-- Right Component: Achievement Matrix -->
    <div id="rufa-achievement-matrix" class="w-full lg:w-[55%] flex flex-col">
      <%= render 'shared/achievement_matrix', compact: false %>
    </div>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-12 gap-6 lg:gap-8 items-stretch">
    <!-- Recent Activity Feed (Left) -->
    <div class="lg:col-span-8 bg-white rounded-[32px] p-8 lg:p-10 border border-slate-200/60 shadow-sm flex flex-col">
      <div class="flex items-center justify-between mb-10">
        <div>
          <h2 class="text-2xl lg:text-3xl font-black text-slate-900 tracking-tight">ìµœê·¼ ì •ì§„ í˜„í™©</h2>
          <p class="text-[11px] font-black text-slate-400 mt-1 uppercase tracking-widest leading-none">ì‹¤ì‹œê°„ìœ¼ë¡œ ê³µìœ ë˜ëŠ” ë©¤ë²„ë“¤ì˜ ê¸°ë¡</p>
        </div>
        <div class="flex items-center gap-4">
          <div class="flex -space-x-3">
            <% @routine_club.members.active.limit(5).each do |member| %>
              <div class="w-10 h-10 rounded-full border-4 border-white shadow-sm overflow-hidden ring-1 ring-slate-100">
                <img src="<%= member.user.profile_image %>" class="w-full h-full object-cover" />
              </div>
            <% end %>
          </div>
          <div class="px-4 py-2 bg-slate-900 rounded-2xl text-white text-[11px] font-black">
            <%= @routine_club.members.active.count %>ëª… ì •ì§„ ì¤‘
          </div>
        </div>
      </div>
      
      <div class="flex-1">
        <% recent_attendances = @routine_club.attendances.includes(routine_club_member: :user).recent.limit(6) %>
        <% if recent_attendances.any? %>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <% recent_attendances.each do |attendance| %>
              <div class="group bg-slate-50/50 hover:bg-white hover:shadow-2xl hover:shadow-indigo-500/10 border border-slate-100 rounded-[32px] p-6 lg:p-7 transition-all duration-500 flex flex-col h-full">
                <div class="flex items-center justify-between mb-5">
                  <div class="flex items-center gap-4">
                    <div class="relative shrink-0">
                      <div class="w-14 h-14 rounded-2xl overflow-hidden ring-4 ring-white shadow-md transition-transform group-hover:scale-105">
                        <img src="<%= attendance.routine_club_member.user.profile_image %>" class="w-full h-full object-cover" />
                      </div>
                      <div class="absolute -bottom-1 -right-1 w-6 h-6 bg-indigo-600 rounded-lg border-2 border-white flex items-center justify-center text-[10px] text-white">âœ¨</div>
                    </div>
                    <div>
                      <p class="text-base font-black text-threads-black leading-none mb-1.5"><%= attendance.routine_club_member.user.nickname %></p>
                      <p class="text-xs font-bold text-slate-400"><%= time_ago_in_words(attendance.created_at) %> ì „</p>
                    </div>
                  </div>
                </div>
                
                <div class="flex-1">
                  <div class="bg-white/60 backdrop-blur-sm rounded-2xl px-5 py-6 border border-slate-100 mb-6 min-h-[100px] flex flex-col justify-center shadow-inner">
                    <p class="text-[15px] text-slate-600 font-bold leading-relaxed">
                      <%= attendance.proof_text.present? ? attendance.proof_text : "ì˜¤ëŠ˜ì˜ ì •ì§„ì„ ì™„ë²½í•˜ê²Œ ë§ˆë¬´ë¦¬í–ˆìŠµë‹ˆë‹¤." %>
                    </p>
                  </div>
                </div>
                
                <div class="flex items-center justify-between pt-5 border-t border-slate-100">
                  <div class="flex items-center gap-2">
                    <span class="px-3 py-1.5 bg-indigo-50 text-indigo-600 rounded-full text-[11px] font-black"><%= attendance.attendance_date.strftime("%m.%d") %></span>
                    <span class="px-3 py-1.5 bg-emerald-50 text-emerald-600 rounded-full text-[11px] font-black">ì •ì§„ì™„ë£Œ</span>
                  </div>
                  
                  <%= button_to cheer_routine_club_path(@routine_club, attendance_id: attendance.id), 
                                method: :post,
                                id: "cheer_btn_#{attendance.id}",
                                class: "flex items-center gap-2 px-4 py-2 bg-white border border-slate-200 rounded-2xl hover:border-orange-400 hover:bg-orange-50 transition-all font-black text-slate-700 shadow-sm active:scale-95 group/btn" do %>
                    <span class="text-base group-hover/btn:scale-125 transition-transform">ğŸ‘</span>
                    <span class="text-sm text-orange-600 group-hover/btn:font-black tabular-nums"><%= attendance.cheers_count %></span>
                  <% end %>
                </div>
              </div>
            <% end %>
          </div>
        <% else %>
          <div class="py-24 text-center bg-slate-50/50 rounded-[40px] border border-dashed border-slate-200">
            <div class="w-20 h-20 bg-white rounded-3xl flex items-center justify-center text-4xl mx-auto shadow-sm mb-6">ğŸï¸</div>
            <p class="text-slate-400 font-black">ì•„ì§ ì˜¤ëŠ˜ì˜ ì²« ê¸°ë¡ì´ ì˜¬ë¼ì˜¤ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤</p>
            <p class="text-slate-300 text-xs mt-2 font-bold">ê°€ì¥ ë¨¼ì € ì •ì§„ì„ ê¸°ë¡í•˜ê³  ë©¤ë²„ë“¤ì„ ë…ë ¤í•´ë³´ì„¸ìš”!</p>
          </div>
        <% end %>
      </div>
    </div>

    <!-- Today's Record (Right) -->
    <div id="rufa-daily-record" class="lg:col-span-4 flex flex-col overflow-hidden">
       <%= render 'routine_clubs/daily_record_area' %>
    </div>
  </div>

  <!-- Attendance Calendar -->
  <div id="attendance-calendar" class="bg-white rounded-[32px] p-8 lg:p-10 border border-slate-100 shadow-sm scroll-mt-24">
    <div class="flex items-center justify-between mb-8">
      <div class="space-y-1">
        <h2 class="text-2xl font-black text-slate-900 tracking-tight">ì¶œì„ ìº˜ë¦°ë”</h2>
        <p class="text-xs font-bold text-slate-400 uppercase tracking-widest">ì„±ì‹¤í•¨ì´ ìŒ“ì—¬ ë§Œë“œëŠ” ê¸°ì </p>
      </div>
      <div class="flex items-baseline gap-1 text-indigo-600 font-black">
        <span class="text-2xl"><%= @my_membership.attendance_rate.to_i %></span>
        <span class="text-xs">%</span>
      </div>
    </div>
    
    <div class="grid grid-cols-7 gap-3 mb-8">
      <% ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '].each_with_index do |day, idx| %>
        <div class="text-center text-[10px] font-black <%= idx == 0 ? 'text-rose-400' : (idx == 6 ? 'text-indigo-400' : 'text-slate-400') %> uppercase tracking-widest py-2">
          <%= day %>
        </div>
      <% end %>
      
      <% 
        calendar_start = @routine_club.start_date.beginning_of_week(:sunday)
        calendar_end = ([Date.current, @routine_club.end_date].min + 14.days).end_of_week(:sunday)
        my_attendances = @my_membership.attendances.pluck(:attendance_date, :status).to_h
      %>
      
      <% (calendar_start..calendar_end).each do |date| %>
        <% 
          is_today = date == Date.current
          is_in_range = date >= @routine_club.start_date && date <= @routine_club.end_date
          attendance_status = my_attendances[date]
          
          cell_class = if is_today && attendance_status.nil?
            "bg-indigo-50 border-2 border-indigo-500 text-indigo-600 shadow-lg shadow-indigo-100 ring-4 ring-indigo-50"
          elsif attendance_status == "present"
            "bg-emerald-500 text-white shadow-lg shadow-emerald-100"
          elsif attendance_status == "absent"
            "bg-slate-200 text-slate-400"
          elsif attendance_status == "excused"
            "bg-amber-400 text-white shadow-lg shadow-amber-100"
          elsif is_in_range && date < Date.current
            "bg-slate-100 text-slate-300"
          else
            "bg-slate-50 text-slate-200"
          end
        %>
        
        <div class="aspect-square <%= cell_class %> rounded-2xl flex flex-col items-center justify-center transition-all hover:scale-110 cursor-default relative group"
             title="<%= date.strftime('%Y-%m-%d') %>">
          <span class="text-xs font-black"><%= date.day %></span>
          <% if is_today %>
            <span class="absolute -top-1 -right-1 w-3 h-3 bg-indigo-500 rounded-full border-2 border-white animate-ping"></span>
            <span class="absolute -top-1 -right-1 w-3 h-3 bg-indigo-500 rounded-full border-2 border-white"></span>
          <% end %>
        </div>
      <% end %>
    </div>
    
    <div class="flex flex-wrap items-center justify-center gap-4 lg:gap-8 pt-6 border-t border-slate-50">
      <% [
        ["bg-emerald-500", "ì¶œì„"],
        ["bg-slate-200", "ê²°ì„"],
        ["bg-amber-400", "ì‚¬ìœ "],
        ["bg-indigo-50 border border-indigo-200", "ì˜¤ëŠ˜"]
      ].each do |color, label| %>
        <div class="flex items-center gap-2">
          <div class="w-3 h-3 <%= color %> rounded-full"></div>
          <span class="text-[10px] font-black text-slate-400 uppercase tracking-widest"><%= label %></span>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Weekly Reports: Bauhaus Style Cards -->
  <div class="bg-white rounded-[32px] p-8 lg:p-10 border border-slate-100 shadow-sm">
    <div class="flex items-center justify-between mb-8">
      <div class="space-y-1">
        <h2 class="text-2xl font-black text-slate-900 tracking-tight">ì£¼ê°„ ì „ìˆ  ë¦¬í¬íŠ¸</h2>
        <p class="text-xs font-bold text-slate-400 uppercase tracking-widest">ë°ì´í„°ë¡œ ê¸°ë¡í•˜ëŠ” ì„±ì¥ì˜ ì—­ì‚¬</p>
      </div>
    </div>
    
    <% reports = RoutineClubReport.where(routine_club: @routine_club, user: current_user).order(start_date: :desc).limit(5) %>
    <% if reports.any? %>
      <div class="space-y-4">
        <% reports.each do |report| %>
          <div class="bg-slate-50 border border-slate-200 rounded-3xl p-6">
            <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-4">
              <div>
                <span class="inline-block px-3 py-1 bg-indigo-100 text-indigo-600 rounded-full text-xs font-black mb-2">
                  <%= report.report_type == 'weekly' ? 'ì£¼ê°„' : 'ì›”ê°„' %> ë¦¬í¬íŠ¸
                </span>
                <h3 class="text-lg font-black text-slate-900">
                  <%= report.start_date.strftime("%mì›” %dì¼") %> - <%= report.end_date.strftime("%mì›” %dì¼") %>
                </h3>
              </div>
              <div class="text-right">
                <p class="text-sm font-bold text-slate-500">ì¶œì„ë¥ </p>
                <p class="text-2xl font-black text-indigo-600"><%= report.attendance_rate.to_i %>%</p>
              </div>
            </div>
            
            <p class="text-slate-700 font-medium mb-3">
              <%= report.summary %>
            </p>
            
            <div class="bg-white rounded-xl p-4 border border-slate-100 flex items-center gap-3">
              <div class="text-2xl">ğŸ’Œ</div>
              <p class="text-indigo-600 font-bold text-sm">
                <%= report.cheering_message %>
              </p>
            </div>
          </div>
        <% end %>
      </div>
    <% else %>
      <div class="bg-slate-50 rounded-3xl p-12 text-center">
        <div class="text-4xl mb-3 opacity-30">ğŸ“ˆ</div>
        <p class="text-slate-400 font-bold">ì•„ì§ ìƒì„±ëœ ë¦¬í¬íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤</p>
        <p class="text-xs text-slate-400 mt-2">ë§¤ì£¼ ì›”ìš”ì¼ì— ì§€ë‚œì£¼ í™œë™ ë¦¬í¬íŠ¸ê°€ ë°œí–‰ë©ë‹ˆë‹¤</p>
      </div>
    <% end %>
  </div>
  </div>

  <!-- Announcement Modal -->
  <div id="announcementModal" class="fixed inset-0 z-50 hidden items-center justify-center p-4 bg-slate-900/80 backdrop-blur-sm">
    <div class="bg-white rounded-[32px] p-8 max-w-lg w-full shadow-2xl transform transition-all">
      <div class="flex items-center justify-between mb-6">
        <h3 class="text-2xl font-black text-slate-900">ê³µì§€ì‚¬í•­ ë“±ë¡</h3>
        <button onclick="closeAnnouncementModal()" class="text-slate-400 hover:text-slate-600 transition-colors">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      </div>
      
      <%= form_with model: [@routine_club, Announcement.new], url: routine_club_announcements_path(@routine_club), local: true, class: "space-y-4" do |f| %>
        <div>
          <%= f.label :title, "ì œëª©", class: "block text-sm font-black text-slate-700 mb-2" %>
          <%= f.text_field :title, class: "w-full px-4 py-3 rounded-xl border-slate-200 focus:ring-2 ring-indigo-500 focus:border-indigo-500 font-medium", placeholder: "ê³µì§€ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”", required: true %>
        </div>
        <div>
          <%= f.label :content, "ë‚´ìš©", class: "block text-sm font-black text-slate-700 mb-2" %>
          <%= f.text_area :content, rows: 6, class: "w-full px-4 py-3 rounded-xl border-slate-200 focus:ring-2 ring-indigo-500 focus:border-indigo-500 font-medium", placeholder: "ìƒì„¸ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”", required: true %>
        </div>
        <div class="flex gap-3 pt-4">
          <button type="button" onclick="closeAnnouncementModal()" class="flex-1 py-3 bg-slate-100 text-slate-600 rounded-xl font-black hover:bg-slate-200 transition-colors">
            ì·¨ì†Œ
          </button>
          <%= f.submit "ë“±ë¡í•˜ê¸°", class: "flex-1 py-3 bg-indigo-600 text-white rounded-xl font-black hover:bg-indigo-700 transition-colors cursor-pointer" %>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Gathering Modal -->
  <div id="gatheringModal" class="fixed inset-0 z-50 hidden items-center justify-center p-4 bg-slate-900/80 backdrop-blur-sm">
    <div class="bg-white rounded-[32px] p-8 max-w-lg w-full shadow-2xl transform transition-all">
      <div class="flex items-center justify-between mb-6">
        <h3 class="text-2xl font-black text-slate-900">ëª¨ì„ ë“±ë¡</h3>
        <button onclick="closeGatheringModal()" class="text-slate-400 hover:text-slate-600 transition-colors">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      </div>
      
      <%= form_with model: [@routine_club, RoutineClubGathering.new], url: routine_club_gatherings_path(@routine_club), local: true, class: "space-y-4" do |f| %>
        <div>
          <%= f.label :title, "ëª¨ì„ëª…", class: "block text-sm font-black text-slate-700 mb-2" %>
          <%= f.text_field :title, class: "w-full px-4 py-3 rounded-xl border-slate-200 focus:ring-2 ring-emerald-500 focus:border-emerald-500 font-medium", placeholder: "ëª¨ì„ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”", required: true %>
        </div>
        <div class="grid grid-cols-2 gap-4">
          <div>
            <%= f.label :gathering_type, "ìœ í˜•", class: "block text-sm font-black text-slate-700 mb-2" %>
            <%= f.select :gathering_type, [['ì˜¨ë¼ì¸', 'online'], ['ì˜¤í”„ë¼ì¸', 'offline']], {}, class: "w-full px-4 py-3 rounded-xl border-slate-200 focus:ring-2 ring-emerald-500 focus:border-emerald-500 font-medium" %>
          </div>
          <div>
            <%= f.label :max_attendees, "ì •ì›", class: "block text-sm font-black text-slate-700 mb-2" %>
            <%= f.number_field :max_attendees, class: "w-full px-4 py-3 rounded-xl border-slate-200 focus:ring-2 ring-emerald-500 focus:border-emerald-500 font-medium", placeholder: "ë¬´ì œí•œ: ë¹„ì›Œë‘ " %>
          </div>
        </div>
        <div>
          <%= f.label :gathering_at, "ì¼ì‹œ", class: "block text-sm font-black text-slate-700 mb-2" %>
          <%= f.datetime_field :gathering_at, class: "w-full px-4 py-3 rounded-xl border-slate-200 focus:ring-2 ring-emerald-500 focus:border-emerald-500 font-medium", required: true %>
        </div>
        <div>
          <%= f.label :location, "ì¥ì†Œ/ë§í¬", class: "block text-sm font-black text-slate-700 mb-2" %>
          <%= f.text_field :location, class: "w-full px-4 py-3 rounded-xl border-slate-200 focus:ring-2 ring-emerald-500 focus:border-emerald-500 font-medium", placeholder: "ì£¼ì†Œ ë˜ëŠ” ì¤Œ ë§í¬ ë“±", required: true %>
        </div>
        <div>
          <%= f.label :description, "ìƒì„¸ ì•ˆë‚´", class: "block text-sm font-black text-slate-700 mb-2" %>
          <%= f.text_area :description, rows: 4, class: "w-full px-4 py-3 rounded-xl border-slate-200 focus:ring-2 ring-emerald-500 focus:border-emerald-500 font-medium", placeholder: "ëª¨ì„ì— ëŒ€í•œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”" %>
        </div>
        <div class="flex gap-3 pt-4">
          <button type="button" onclick="closeGatheringModal()" class="flex-1 py-3 bg-slate-100 text-slate-600 rounded-xl font-black hover:bg-slate-200 transition-colors">
            ì·¨ì†Œ
          </button>
          <%= f.submit "ê°œì„¤í•˜ê¸°", class: "flex-1 py-3 bg-emerald-600 text-white rounded-xl font-black hover:bg-emerald-700 transition-colors cursor-pointer" %>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Announcement Detail Modal -->
  <div id="announcementDetailModal" class="fixed inset-0 z-50 hidden items-center justify-center p-4 bg-slate-900/80 backdrop-blur-sm">
    <div class="bg-white rounded-[32px] p-8 max-w-2xl w-full shadow-2xl transform transition-all max-h-[80vh] overflow-y-auto">
      <div class="flex items-center justify-between mb-6">
        <div class="flex-1">
          <h3 id="announcementDetailTitle" class="text-2xl font-black text-slate-900 mb-2"></h3>
          <p id="announcementDetailDate" class="text-sm font-bold text-slate-400"></p>
        </div>
        <button onclick="closeAnnouncementDetail()" class="text-slate-400 hover:text-slate-600 transition-colors ml-4">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      </div>
      
      <div class="prose prose-slate max-w-none">
        <p id="announcementDetailContent" class="text-slate-700 leading-relaxed whitespace-pre-wrap"></p>
      </div>
      
      <div class="mt-8 pt-6 border-t border-slate-100">
        <button onclick="closeAnnouncementDetail()" class="w-full py-3 bg-slate-100 text-slate-600 rounded-xl font-black hover:bg-slate-200 transition-colors">
          ë‹«ê¸°
        </button>
      </div>
    </div>
  </div>

  <!-- Gathering Detail Modal -->
  <div id="gatheringDetailModal" class="fixed inset-0 z-50 hidden items-center justify-center p-4 bg-slate-900/80 backdrop-blur-sm">
    <div class="bg-white rounded-[32px] p-8 max-w-2xl w-full shadow-2xl transform transition-all max-h-[80vh] overflow-y-auto">
      <div class="flex items-center justify-between mb-6">
        <h3 id="gatheringDetailTitle" class="text-2xl font-black text-slate-900"></h3>
        <button onclick="closeGatheringDetail()" class="text-slate-400 hover:text-slate-600 transition-colors ml-4">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      </div>
      
      <div class="space-y-4 mb-6">
        <div class="flex items-center gap-3 p-4 bg-emerald-50 rounded-xl">
          <svg class="w-5 h-5 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
          </svg>
          <div>
            <p class="text-xs font-bold text-emerald-600 mb-1">ì¼ì‹œ</p>
            <p id="gatheringDetailDatetime" class="font-black text-slate-900"></p>
          </div>
        </div>
        
        <div class="flex items-center gap-3 p-4 bg-blue-50 rounded-xl">
          <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
          </svg>
          <div class="flex-1">
            <p class="text-xs font-bold text-blue-600 mb-1">ì¥ì†Œ</p>
            <p id="gatheringDetailLocation" class="font-black text-slate-900 break-all"></p>
          </div>
        </div>
        
        <div class="flex items-center gap-4">
          <div class="flex items-center gap-2 px-4 py-2 bg-slate-50 rounded-xl">
            <p class="text-xs font-bold text-slate-500">ìœ í˜•</p>
            <p id="gatheringDetailType" class="font-black text-slate-900"></p>
          </div>
          <div id="gatheringDetailAttendees" class="flex items-center gap-2 px-4 py-2 bg-orange-50 rounded-xl">
            <p class="text-xs font-bold text-orange-600"></p>
          </div>
        </div>
      </div>
      
      <div class="prose prose-slate max-w-none mb-6">
        <p class="text-sm font-bold text-slate-500 mb-2">ìƒì„¸ ì•ˆë‚´</p>
        <p id="gatheringDetailDescription" class="text-slate-700 leading-relaxed whitespace-pre-wrap"></p>
      </div>
      
      <div class="pt-6 border-t border-slate-100">
        <button onclick="closeGatheringDetail()" class="w-full py-3 bg-slate-100 text-slate-600 rounded-xl font-black hover:bg-slate-200 transition-colors">
          ë‹«ê¸°
        </button>
      </div>
    </div>
  </div>

  <!-- All Announcements List Modal -->
  <div id="allAnnouncementsModal" class="fixed inset-0 z-50 hidden items-center justify-center p-4 bg-slate-900/80 backdrop-blur-sm">
    <div class="bg-white rounded-[32px] p-8 max-w-3xl w-full shadow-2xl transform transition-all max-h-[85vh] overflow-y-auto">
      <div class="flex items-center justify-between mb-6">
        <h3 class="text-2xl font-black text-slate-900">ì „ì²´ ê³µì§€ì‚¬í•­</h3>
        <button onclick="closeAllAnnouncementsModal()" class="text-slate-400 hover:text-slate-600 transition-colors">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      </div>
      
      <div class="space-y-3">
        <% @announcements.each do |notice| %>
          <div class="group cursor-pointer p-4 bg-slate-50 hover:bg-indigo-50 rounded-2xl transition-colors border border-slate-100 hover:border-indigo-200" 
               onclick="viewAnnouncement(<%= notice.id %>, '<%= j notice.title %>', '<%= j notice.content %>', '<%= notice.created_at.strftime("%Yë…„ %mì›” %dì¼") %>')">
            <div class="flex items-center justify-between mb-2">
              <span class="px-2 py-0.5 bg-amber-100 text-amber-700 text-[10px] font-black rounded-lg"><%= notice.created_at.strftime("%m/%d") %></span>
              <% if (Date.current - notice.created_at.to_date).to_i < 7 %>
                <span class="text-[10px] font-bold text-amber-500">New</span>
              <% end %>
            </div>
            <h4 class="font-black text-slate-900 group-hover:text-indigo-600 transition-colors mb-1"><%= notice.title %></h4>
            <p class="text-xs text-slate-500 line-clamp-2"><%= notice.content %></p>
          </div>
        <% end %>
      </div>
    </div>
  </div>

  <!-- All Gatherings List Modal -->
  <div id="allGatheringsModal" class="fixed inset-0 z-50 hidden items-center justify-center p-4 bg-slate-900/80 backdrop-blur-sm">
    <div class="bg-white rounded-[32px] p-8 max-w-3xl w-full shadow-2xl transform transition-all max-h-[85vh] overflow-y-auto">
      <div class="flex items-center justify-between mb-6">
        <h3 class="text-2xl font-black text-slate-900">ì „ì²´ ëª¨ì„</h3>
        <button onclick="closeAllGatheringsModal()" class="text-slate-400 hover:text-slate-600 transition-colors">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      </div>
      
      <div class="space-y-3">
        <% @gatherings.each do |gathering| %>
          <div class="bg-emerald-50/50 rounded-2xl p-4 border border-emerald-100/50 hover:bg-emerald-50 hover:border-emerald-200 transition-colors cursor-pointer" 
               onclick="viewGathering(<%= gathering.id %>, '<%= j gathering.title %>', '<%= j gathering.description %>', '<%= gathering.gathering_at.strftime("%Yë…„ %mì›” %dì¼ %H:%M") %>', '<%= j gathering.location %>', '<%= gathering.gathering_type %>', <%= gathering.max_attendees || 'null' %>)">
            <div class="flex items-center justify-between mb-2">
              <div class="flex items-center gap-2">
                <span class="px-2 py-0.5 <%= gathering.online? ? 'bg-sky-100 text-sky-600' : 'bg-orange-100 text-orange-600' %> text-[10px] font-black rounded-lg uppercase"><%= gathering.gathering_type == 'online' ? 'ON' : 'OFF' %></span>
                <span class="text-xs font-bold text-emerald-600"><%= gathering.gathering_at.strftime("%m/%d %H:%M") %></span>
              </div>
              <% if gathering.gathering_at > Time.current %>
                <span class="px-2 py-0.5 bg-green-100 text-green-600 text-[10px] font-black rounded-lg">ì˜ˆì •</span>
              <% end %>
            </div>
            <h4 class="font-black text-slate-900 mb-2"><%= gathering.title %></h4>
            <div class="flex items-center gap-2 text-[10px] font-bold text-slate-500">
              <span>ğŸ“ <%= gathering.location %></span>
              <% if gathering.max_attendees %>
                <span>Â·</span>
                <span>ì„ ì°©ìˆœ <%= gathering.max_attendees %>ëª…</span>
              <% end %>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  </div>

</div>

<script>
  function openAnnouncementModal() {
    const modal = document.getElementById('announcementModal');
    modal.classList.remove('hidden');
    modal.classList.add('flex');
  }

  function closeAnnouncementModal() {
    const modal = document.getElementById('announcementModal');
    modal.classList.add('hidden');
    modal.classList.remove('flex');
  }

  function openGatheringModal() {
    const modal = document.getElementById('gatheringModal');
    modal.classList.remove('hidden');
    modal.classList.add('flex');
  }

  function closeGatheringModal() {
    const modal = document.getElementById('gatheringModal');
    modal.classList.add('hidden');
    modal.classList.remove('flex');
  }

  // View announcement detail
  function viewAnnouncement(id, title, content, date) {
    document.getElementById('announcementDetailTitle').textContent = title;
    document.getElementById('announcementDetailDate').textContent = date;
    document.getElementById('announcementDetailContent').textContent = content;
    
    const modal = document.getElementById('announcementDetailModal');
    modal.classList.remove('hidden');
    modal.classList.add('flex');
  }

  function closeAnnouncementDetail() {
    const modal = document.getElementById('announcementDetailModal');
    modal.classList.add('hidden');
    modal.classList.remove('flex');
  }

  // View gathering detail
  function viewGathering(id, title, description, datetime, location, type, maxAttendees) {
    document.getElementById('gatheringDetailTitle').textContent = title;
    document.getElementById('gatheringDetailDatetime').textContent = datetime;
    document.getElementById('gatheringDetailLocation').textContent = location;
    document.getElementById('gatheringDetailType').textContent = type === 'online' ? 'ì˜¨ë¼ì¸' : 'ì˜¤í”„ë¼ì¸';
    document.getElementById('gatheringDetailDescription').textContent = description || 'ìƒì„¸ ì•ˆë‚´ê°€ ì—†ìŠµë‹ˆë‹¤.';
    
    const attendeesEl = document.getElementById('gatheringDetailAttendees');
    if (maxAttendees) {
      attendeesEl.textContent = `ì„ ì°©ìˆœ ${maxAttendees}ëª…`;
      attendeesEl.classList.remove('hidden');
    } else {
      attendeesEl.classList.add('hidden');
    }
    
    const modal = document.getElementById('gatheringDetailModal');
    modal.classList.remove('hidden');
    modal.classList.add('flex');
  }

  function closeGatheringDetail() {
    const modal = document.getElementById('gatheringDetailModal');
    modal.classList.add('hidden');
    modal.classList.remove('flex');
  }

  // Close modal when clicking outside
  document.addEventListener('click', function(event) {
    const announcementModal = document.getElementById('announcementModal');
    const gatheringModal = document.getElementById('gatheringModal');
    const announcementDetailModal = document.getElementById('announcementDetailModal');
    const gatheringDetailModal = document.getElementById('gatheringDetailModal');
    
    if (event.target === announcementModal) {
      closeAnnouncementModal();
    }
    if (event.target === gatheringModal) {
      closeGatheringModal();
    }
    if (event.target === announcementDetailModal) {
      closeAnnouncementDetail();
    }
    if (event.target === gatheringDetailModal) {
      closeGatheringDetail();
    }
    
    const allAnnouncementsModal = document.getElementById('allAnnouncementsModal');
    const allGatheringsModal = document.getElementById('allGatheringsModal');
    
    if (event.target === allAnnouncementsModal) {
      closeAllAnnouncementsModal();
    }
    if (event.target === allGatheringsModal) {
      closeAllGatheringsModal();
    }
  });

  // All announcements list modal
  function openAllAnnouncementsModal() {
    const modal = document.getElementById('allAnnouncementsModal');
    modal.classList.remove('hidden');
    modal.classList.add('flex');
  }

  function closeAllAnnouncementsModal() {
    const modal = document.getElementById('allAnnouncementsModal');
    modal.classList.add('hidden');
    modal.classList.remove('flex');
  }

  // All gatherings list modal
  function openAllGatheringsModal() {
    const modal = document.getElementById('allGatheringsModal');
    modal.classList.remove('hidden');
    modal.classList.add('flex');
  }

  function closeAllGatheringsModal() {
    const modal = document.getElementById('allGatheringsModal');
    modal.classList.add('hidden');
    modal.classList.remove('flex');
  }
</script>
