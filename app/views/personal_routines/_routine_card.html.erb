<%# locals: (routine:) %>
<div id="routine_<%= routine.id %>_card" class="routine-card group/routine relative" data-days="<%= (routine.days || []).join(',') %>">
  <div class="w-full h-full flex items-center justify-between p-4 md:p-5 rounded-2xl border-2 transition-all duration-300 <%= routine.completed_today? ? 'bg-white border-white shadow-xl translate-y-[-2px]' : 'bg-white/10 border-white/10 text-white hover:bg-white/20' %>">
    
    <div class="flex items-center gap-4 flex-1 min-w-0">
      <!-- Checkbox Container (Wrapped in button for toggle) -->
      <%= button_to toggle_personal_routine_path(routine), method: :post, data: { turbo_stream: true }, class: "shrink-0 w-8 h-8 rounded-lg border-2 flex items-center justify-center transition-all #{routine.completed_today? ? 'bg-indigo-600 border-indigo-600 text-white' : 'border-white/30 group-hover/routine:border-white text-transparent'}" do %>
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="4"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/></svg>
      <% end %>

      <div class="min-w-0 flex-1">
        <div class="flex items-center gap-2 mb-0.5">
          <p class="text-[9px] font-black uppercase tracking-widest transition-all <%= routine.completed_today? ? 'text-indigo-400' : 'text-white/50' %> truncate"><%= routine.category %></p>
          <span class="text-[9px] font-black <%= routine.completed_today? ? 'text-emerald-500' : 'text-amber-300' %>">ğŸ”¥ <%= routine.current_streak %>ì¼</span>
        </div>
        <h4 class="text-sm md:text-base font-black truncate transition-all <%= routine.completed_today? ? 'text-indigo-600 line-through decoration-indigo-200' : 'text-white' %>">
          <%= routine.title %>
        </h4>
        
        <!-- Repeating Days -->
        <div class="flex gap-0.5 mt-2">
          <% days_map = { "1" => "ì›”", "2" => "í™”", "3" => "ìˆ˜", "4" => "ëª©", "5" => "ê¸ˆ", "6" => "í† ", "0" => "ì¼" } %>
          <% ["1","2","3","4","5","6","0"].each do |d| %>
            <% is_active_day = (routine.days || []).map(&:to_s).include?(d.to_s) %>
            <% 
              day_classes = if is_active_day
                routine.completed_today? ? 'bg-indigo-600 text-white shadow-sm' : 'bg-white/30 text-white shadow-sm ring-1 ring-white/20'
              else
                routine.completed_today? ? 'text-slate-200' : 'text-white/10'
              end
            %>
            <span class="w-5 h-5 flex-shrink-0 flex items-center justify-center text-[8px] font-black rounded <%= day_classes %>">
              <%= days_map[d] %>
            </span>
          <% end %>
        </div>
      </div>
    </div>

    <div class="flex items-center gap-3">
      <div class="w-9 h-9 md:w-10 md:h-10 rounded-xl flex items-center justify-center text-xl md:text-2xl transition-all <%= routine.completed_today? ? 'bg-indigo-50 shadow-inner scale-110' : 'bg-white/10' %>">
        <%= routine.icon %>
      </div>
      
      <!-- Dropdown Menu -->
      <div class="relative">
        <button type="button" onclick="toggleDropdown(<%= routine.id %>)" class="w-8 h-8 rounded-lg flex items-center justify-center transition-all <%= routine.completed_today? ? 'text-indigo-300 hover:bg-indigo-50' : 'text-white/30 hover:bg-white/10' %>">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="3"><path stroke-linecap="round" stroke-linejoin="round" d="M12 5v.01M12 12v.01M12 19v.01"/></svg>
        </button>
        <div id="dropdown-<%= routine.id %>" class="hidden absolute right-0 mt-2 w-40 bg-white rounded-xl shadow-2xl border border-slate-100 overflow-hidden z-20">
          <%= link_to edit_personal_routine_path(routine), class: "flex items-center gap-3 px-4 py-2.5 hover:bg-indigo-50 transition-colors text-slate-700 hover:text-indigo-600 font-bold text-xs" do %>
            ìˆ˜ì •
          <% end %>
          <%= button_to personal_routine_path(routine), method: :delete, data: { confirm: "ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?" }, class: "w-full flex items-center gap-3 px-4 py-2.5 hover:bg-red-50 transition-colors text-slate-700 hover:text-red-600 font-bold text-xs text-left" do %>
            ì‚­ì œ
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>
