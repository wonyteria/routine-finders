<div data-controller="tabs" 
     data-tabs-active-class="bg-white/10 text-white shadow-lg ring-1 ring-white/20 backdrop-blur-xl" 
     data-tabs-inactive-class="text-slate-400 hover:bg-white/5 hover:text-white"
     class="min-h-screen bg-gradient-to-br from-slate-900 via-indigo-950 to-slate-900 relative overflow-hidden">
  
  <!-- Animated Background -->
  <div class="absolute inset-0 overflow-hidden pointer-events-none">
    <div class="absolute top-0 left-1/4 w-96 h-96 bg-indigo-500/20 rounded-full blur-3xl animate-pulse"></div>
    <div class="absolute bottom-0 right-1/4 w-96 h-96 bg-purple-500/20 rounded-full blur-3xl animate-pulse" style="animation-delay: 1s;"></div>
  </div>

  <div class="relative z-10 max-w-7xl mx-auto pb-20 px-4 md:px-6">
    
    <!-- Navigation: Back to Home -->
    <div class="pt-8 mb-6">
      <%= link_to root_path, class: "inline-flex items-center gap-2 px-4 py-2.5 bg-white/5 border border-white/10 rounded-xl text-slate-300 hover:text-white hover:border-white/20 hover:bg-white/10 transition-all shadow-lg backdrop-blur-sm group" do %>
        <i data-feather="chevron-left" class="w-4 h-4 group-hover:-translate-x-1 transition-transform"></i>
        <span class="text-xs font-black uppercase tracking-widest">ÌôàÏúºÎ°ú Í∞ÄÍ∏∞</span>
      <% end %>
    </div>

    <!-- Header & Tabs -->
    <div class="flex flex-col md:flex-row md:items-center justify-between gap-6 mb-10">
      <div class="space-y-2">
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center shadow-lg shadow-indigo-500/50">
            <i data-feather="bar-chart-2" class="w-5 h-5 text-white"></i>
          </div>
          <div>
            <p class="text-xs font-bold text-indigo-400 uppercase tracking-widest">Routine Insight</p>
            <h2 class="text-3xl md:text-4xl font-black text-white tracking-tight">ÏÑ±Ï∑® Î∂ÑÏÑù Î¶¨Ìè¨Ìä∏</h2>
          </div>
        </div>
      </div>
      
      <!-- Tab Switcher -->
      <div class="bg-white/5 p-1.5 rounded-2xl flex items-center gap-1 backdrop-blur-xl border border-white/10 shadow-xl">
        <button data-tabs-target="tab" data-id="overview" data-action="click->tabs#change"
                class="px-5 py-2.5 rounded-xl text-xs font-black transition-all tracking-tight whitespace-nowrap">OVERVIEW</button>
        <button data-tabs-target="tab" data-id="finance" data-action="click->tabs#change"
                class="px-5 py-2.5 rounded-xl text-xs font-black transition-all tracking-tight whitespace-nowrap">FINANCE</button>
        <button data-tabs-target="tab" data-id="social" data-action="click->tabs#change"
                class="px-5 py-2.5 rounded-xl text-xs font-black transition-all tracking-tight whitespace-nowrap">SOCIAL</button>
      </div>
    </div>

    <%
      total_activities = (@activity_data || {}).values.sum
      
      # Calculate Completion Rate
      avg_completion = @participations.any? ? (@participations.sum(&:completion_rate) / @participations.size).to_i : 0
      
      # Calculate Unified Streak
      all_activity_dates = (@activity_data || {}).keys.sort.reverse
      
      current_streak = 0
      if all_activity_dates.any?
        check_date = Date.current
        if (@activity_data || {})[check_date].to_i > 0 || (@activity_data || {})[check_date - 1.day].to_i > 0
          curr = (@activity_data || {})[check_date].to_i > 0 ? check_date : check_date - 1.day
          while (@activity_data || {})[curr].to_i > 0
            current_streak += 1
            curr -= 1.day
          end
        end
      end

      max_streak = @participations.map(&:max_streak).max.to_i
      badge_count = @current_user.badges.count
      
      # Logs for mini-matrices
      c_logs = VerificationLog.joins(participant: :user).where(users: { id: @current_user.id }).where(created_at: 1.month.ago..Time.current).map { |l| l.created_at.to_date }.uniq
      r_logs = (PersonalRoutineCompletion.joins(:personal_routine).where(personal_routines: { user_id: @current_user.id }).where(completed_on: 1.month.ago..Date.current).map(&:completed_on) + 
               RoutineClubAttendance.joins(:routine_club_member).where(routine_club_members: { user_id: @current_user.id }).where(attendance_date: 1.month.ago..Date.current).map(&:attendance_date)).uniq
    %>

    <div class="relative min-h-[500px]">
      <!-- OVERVIEW PANEL -->
      <div data-tabs-target="panel" data-id="overview" class="space-y-6">
        <!-- Top Stats Bento Grid -->
        <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
          <% [
            { icon: "activity", title: "ÎàÑÏ†Å ÌôúÎèô", value: "#{total_activities}Ìöå", sub: "All-time", gradient: "from-indigo-500 to-purple-600", glow: "indigo" },
            { icon: "target", title: "ÌèâÍ∑† Îã¨ÏÑ±Î•†", value: "#{avg_completion}%", sub: "Challenges", gradient: "from-emerald-500 to-teal-600", glow: "emerald" },
            { icon: "zap", title: "ÏµúÎåÄ Ïä§Ìä∏Î¶≠", value: "#{max_streak}Ïùº", sub: "Personal Best", gradient: "from-orange-500 to-red-600", glow: "orange" },
            { icon: "award", title: "Î≥¥Ïú† Î∞∞ÏßÄ", value: "#{badge_count}Í∞ú", sub: "Collection", gradient: "from-purple-500 to-pink-600", glow: "purple" }
          ].each do |item| %>
            <div class="group relative bg-white/5 backdrop-blur-xl p-6 rounded-3xl border border-white/10 shadow-2xl transition-all hover:scale-105 hover:shadow-indigo-500/20 overflow-hidden">
              <!-- Glow Effect -->
              <div class="absolute -top-10 -right-10 w-32 h-32 bg-gradient-to-br <%= item[:gradient] %> rounded-full blur-3xl opacity-0 group-hover:opacity-30 transition-opacity"></div>
              
              <div class="relative z-10 flex flex-col h-full justify-between gap-4">
                <div class="flex items-center justify-between">
                  <div class="w-12 h-12 rounded-2xl bg-gradient-to-br <%= item[:gradient] %> flex items-center justify-center shadow-lg shadow-<%= item[:glow] %>-500/50">
                    <i data-feather="<%= item[:icon] %>" class="w-6 h-6 text-white"></i>
                  </div>
                  <div class="px-2.5 py-1 rounded-full bg-white/10 border border-white/20 text-[10px] font-black text-white/80 backdrop-blur-sm">
                    <%= item[:sub] %>
                  </div>
                </div>
                <div>
                  <p class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-1"><%= item[:title] %></p>
                  <h4 class="text-3xl font-black text-white tracking-tight"><%= item[:value] %></h4>
                </div>
              </div>
            </div>
          <% end %>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <!-- Weekly Trend Chart -->
          <div class="bg-white/5 backdrop-blur-xl rounded-3xl border border-white/10 shadow-2xl p-6 flex flex-col justify-between overflow-hidden relative group">
            <!-- Gradient Overlay -->
            <div class="absolute top-0 right-0 w-40 h-40 bg-gradient-to-br from-indigo-500/30 to-transparent rounded-bl-full -mr-10 -mt-10 blur-2xl group-hover:scale-110 transition-transform"></div>
            
            <div class="space-y-2 relative z-10">
              <div class="flex items-center gap-2">
                <div class="w-2 h-2 rounded-full bg-indigo-500 animate-pulse"></div>
                <h4 class="text-base font-black text-white">Ï£ºÍ∞Ñ Ìä∏Î†åÎìú</h4>
              </div>
              <p class="text-xs text-slate-400 font-medium">ÏßÄÎÇú 7ÏùºÍ∞ÑÏùò ÏÑ±Ï∑® ÌùêÎ¶Ñ</p>
            </div>
            
            <div class="flex items-end justify-between h-32 mt-6 gap-2 px-1">
              <% 
                weekly_stats = (0..6).map do |i|
                  date = Date.current - i.days
                  count = (@activity_data || {})[date] || 0
                  { count: count, day: date.strftime("%a")[0], date: date }
                end.reverse
                max_daily = [weekly_stats.map { |s| s[:count] }.max, 1].max
              %>
              <% weekly_stats.each_with_index do |stat, i| %>
                <div class="flex-1 flex flex-col justify-end group/bar h-full cursor-pointer relative">
                  <div class="w-full rounded-t-xl relative overflow-hidden transition-all duration-500" style="height: <%= [stat[:count].to_f / max_daily * 100, 10].max.to_i %>%">
                    <div class="absolute inset-0 bg-gradient-to-t <%= i == 6 ? 'from-indigo-600 to-indigo-400' : 'from-indigo-500/50 to-indigo-400/50' %> group-hover/bar:from-indigo-500 group-hover/bar:to-indigo-300 transition-all shadow-lg shadow-indigo-500/50"></div>
                  </div>
                  <!-- Tooltip -->
                  <div class="absolute -top-12 left-1/2 -translate-x-1/2 bg-slate-900 text-white text-xs font-black py-2 px-3 rounded-xl opacity-0 group-hover/bar:opacity-100 transition-all whitespace-nowrap pointer-events-none z-20 shadow-2xl border border-white/20 transform translate-y-2 group-hover/bar:translate-y-0">
                     <%= stat[:count] %> activities
                  </div>
                </div>
              <% end %>
            </div>
            <div class="flex justify-between px-1 mt-3 text-xs font-black text-slate-400 uppercase tracking-widest text-center">
              <% weekly_stats.each do |stat| %>
                <span class="flex-1 <%= 'text-indigo-400 scale-110' if stat[:date] == Date.current %>"><%= stat[:day] %></span>
              <% end %>
            </div>
          </div>

          <!-- Routine Timing Analysis -->
          <div class="bg-white/5 backdrop-blur-xl rounded-3xl border border-white/10 shadow-2xl p-6 space-y-4">
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-3">
                <div class="p-2 bg-gradient-to-br from-purple-500 to-pink-600 rounded-xl shadow-lg shadow-purple-500/50">
                  <i data-feather="clock" class="w-5 h-5 text-white"></i>
                </div>
                <h4 class="text-base font-black text-white">Î£®Ìã¥ ÏßëÏ§ë ÏãúÍ∞Ñ</h4>
              </div>
              <% 
                peak_hour = @routine_time_stats&.max_by { |k, v| v }&.first
                peak_time = case peak_hour
                  when 5..10 then "ÏïÑÏπ®Ìòï"
                  when 11..16 then "Ïò§ÌõÑÌòï"
                  when 17..22 then "Ï†ÄÎÖÅÌòï"
                  else "Ïã¨ÏïºÌòï"
                end if peak_hour
              %>
              <% if peak_time %>
                <span class="text-xs font-black text-white bg-gradient-to-r from-purple-500 to-pink-600 px-3 py-1.5 rounded-full shadow-lg shadow-purple-500/50"><%= peak_time %></span>
              <% end %>
            </div>

            <div class="flex items-end h-28 gap-0.5 px-1">
              <% 
                max_count = [@routine_time_stats&.values&.max || 0, 1].max
              %>
              <% (0..23).each do |hour| %>
                <% count = @routine_time_stats[hour] || 0 %>
                <div class="flex-1 rounded-t-sm relative group/time" style="height: <%= [count.to_f / max_count * 100, 5].max.to_i %>%">
                  <div class="absolute inset-0 bg-gradient-to-t from-purple-500/60 to-pink-500/60 group-hover/time:from-purple-500 group-hover/time:to-pink-500 transition-all shadow-lg shadow-purple-500/30"></div>
                  <!-- Tooltip -->
                  <div class="absolute -top-10 left-1/2 -translate-x-1/2 bg-slate-900 text-white text-[10px] font-black py-1.5 px-2.5 rounded-lg opacity-0 group-hover/time:opacity-100 transition-all whitespace-nowrap pointer-events-none z-20 shadow-2xl border border-white/20 transform translate-y-2 group-hover/time:translate-y-0">
                    <%= hour %>Ïãú: <%= count %>Ìöå
                  </div>
                </div>
              <% end %>
            </div>
            <div class="flex justify-between text-[10px] font-black text-slate-400 uppercase tracking-widest">
              <span>00Ïãú</span>
              <span>06Ïãú</span>
              <span>12Ïãú</span>
              <span>18Ïãú</span>
              <span>23Ïãú</span>
            </div>
          </div>
        </div>

        <!-- Achievement Matrix -->
        <div class="bg-white/5 backdrop-blur-xl rounded-3xl border border-white/10 shadow-2xl p-6 space-y-5">
          <div class="flex items-center justify-between">
             <div class="flex items-center gap-3">
              <div class="p-2 bg-gradient-to-br from-orange-500 to-red-600 rounded-xl shadow-lg shadow-orange-500/50">
                <i data-feather="grid" class="w-5 h-5 text-white"></i>
              </div>
              <h4 class="text-base font-black text-white">ÏÑ±Ï∑® Îß§Ìä∏Î¶≠Ïä§</h4>
            </div>
            <div class="flex gap-4">
              <div class="flex items-center gap-2 text-xs font-bold text-slate-400">
                <span class="w-2 h-2 rounded-sm bg-white/10"></span> 0
              </div>
              <div class="flex items-center gap-2 text-xs font-bold text-slate-400">
                <span class="w-2 h-2 rounded-sm bg-indigo-500 shadow-sm shadow-indigo-500/50"></span> High
              </div>
            </div>
          </div>

            <%
              # Matrix data (Last 28 days)
              matrix_end = Date.current
              matrix_start = matrix_end - 27.days
              matrix_dates = (matrix_start..matrix_end).to_a
              
              c_rate = matrix_dates.count { |d| c_logs.include?(d) } / 28.0 * 100
              r_rate = matrix_dates.count { |d| r_logs.include?(d) } / 28.0 * 100
            %>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <!-- Challenges -->
              <div class="space-y-3 bg-white/5 p-4 rounded-2xl border border-white/10">
                <div class="flex justify-between items-end">
                  <span class="text-xs font-black text-indigo-400 uppercase tracking-wider">Challenges</span>
                  <span class="text-sm font-black text-white"><%= c_rate.to_i %>%</span>
                </div>
                <div class="grid grid-cols-7 gap-1.5">
                  <% ["S", "M", "T", "W", "T", "F", "S"].each do |day| %>
                    <div class="text-[9px] font-black text-slate-500 text-center"><%= day %></div>
                  <% end %>
                  <%# Padding for start of 28 day range %>
                  <% matrix_start.wday.times do %> <div class="aspect-square"></div> <% end %>
                  <% matrix_dates.each do |date| %>
                    <% active = c_logs.include?(date) %>
                    <div class="aspect-square rounded-md transition-all hover:scale-110 cursor-pointer <%= active ? 'bg-indigo-500 shadow-md shadow-indigo-500/50' : 'bg-white/10' %>" 
                         title="<%= date %>"></div>
                  <% end %>
                </div>
              </div>

              <!-- Routines -->
              <div class="space-y-3 bg-white/5 p-4 rounded-2xl border border-white/10">
                <div class="flex justify-between items-end">
                  <span class="text-xs font-black text-purple-400 uppercase tracking-wider">Routines</span>
                  <span class="text-sm font-black text-white"><%= r_rate.to_i %>%</span>
                </div>
                <div class="grid grid-cols-7 gap-1.5">
                  <% ["S", "M", "T", "W", "T", "F", "S"].each do |day| %>
                    <div class="text-[9px] font-black text-slate-500 text-center"><%= day %></div>
                  <% end %>
                  <%# Padding for start of 28 day range %>
                  <% matrix_start.wday.times do %> <div class="aspect-square"></div> <% end %>
                  <% matrix_dates.each do |date| %>
                    <% active = r_logs.include?(date) %>
                    <div class="aspect-square rounded-md transition-all hover:scale-110 cursor-pointer <%= active ? 'bg-purple-500 shadow-md shadow-purple-500/50' : 'bg-white/10' %>"
                         title="<%= date %>"></div>
                  <% end %>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Bottom Section Split -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
           <!-- Growth Investment Summary -->
          <div class="bg-gradient-to-br from-indigo-600 to-purple-700 rounded-3xl p-7 text-white flex flex-col justify-between relative overflow-hidden shadow-2xl shadow-indigo-500/50 group">
            <div class="absolute -right-16 -top-16 w-48 h-48 bg-white/10 rounded-full blur-3xl group-hover:bg-white/20 transition-colors"></div>
            
            <div class="relative z-10 space-y-6">
              <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-xl bg-white/20 backdrop-blur-sm flex items-center justify-center border border-white/30 shadow-lg">
                    <i data-feather="trending-up" class="w-5 h-5 text-white"></i>
                </div>
                <h4 class="text-base font-black tracking-tight">ÏÑ±Ïû• Ìà¨Ïûê ÏöîÏïΩ</h4>
              </div>

              <div class="space-y-2">
                <p class="text-xs font-bold text-indigo-200 uppercase tracking-widest">Total Growth Investment</p>
                <h4 class="text-4xl font-black tracking-tight"><%= number_with_delimiter(@growth_stats[:total_invested]) %><span class="text-lg font-bold text-white/70 ml-1">Ïõê</span></h4>
              </div>

              <div class="pt-5 border-t border-white/20 flex flex-col gap-3">
                <div class="flex justify-between text-sm">
                   <span class="text-indigo-100">ÌôòÍ∏â ÏòàÏ†ïÏï°</span>
                   <span class="text-white font-black"><%= number_with_delimiter(@growth_stats[:expected_refund]) %>Ïõê</span>
                </div>
                <div class="flex justify-between text-sm">
                   <span class="text-white">ÎàÑÏ†Å ÌôòÍ∏âÏï°</span>
                   <span class="text-emerald-300 font-black"><%= number_with_delimiter(@growth_stats[:total_refunded]) %>Ïõê</span>
                </div>
              </div>
            </div>
            
            <a href="#" data-action="click->tabs#change" data-id="finance" class="mt-6 w-full py-3.5 bg-white/20 backdrop-blur-sm hover:bg-white/30 text-white text-xs font-black rounded-2xl text-center transition-all border border-white/30 shadow-lg">
              ÏûêÏÑ∏Ìûà Î≥¥Í∏∞
            </a>
          </div>

          <!-- Badge Collection -->
          <div class="lg:col-span-2 bg-white/5 backdrop-blur-xl rounded-3xl border border-white/10 shadow-2xl p-7 space-y-6">
            <div class="flex items-center justify-between">
               <div class="flex items-center gap-3">
                 <div class="w-10 h-10 bg-gradient-to-br from-purple-500 to-pink-600 rounded-xl flex items-center justify-center shadow-lg shadow-purple-500/50">
                    <i data-feather="hexagon" class="w-5 h-5 text-white"></i>
                 </div>
                 <h4 class="text-lg font-black text-white">Î±ÉÏßÄ Î°úÎìúÎßµ</h4>
               </div>
               <%= link_to badge_roadmap_path, class: "text-xs font-bold text-slate-400 hover:text-indigo-400 flex items-center gap-1 group transition-colors" do %>
                 Ï†ÑÏ≤¥ Î≥¥Í∏∞ <i data-feather="chevron-right" class="w-3.5 h-3.5 group-hover:translate-x-1 transition-transform"></i>
               <% end %>
            </div>
            
            <div class="flex gap-4 overflow-x-auto pb-2 no-scrollbar">
              <% Badge.order(level: :asc).group_by(&:badge_type).each do |type, badges| %>
                 <% 
                   user_badge_ids = current_user.badges.where(badge_type: type).pluck(:id)
                   latest_badge = Badge.where(badge_type: type, id: user_badge_ids).order(level: :desc).first
                   next_badge = Badge.where(badge_type: type).where("level > ?", latest_badge&.level || 0).order(level: :asc).first
                   display_badge = latest_badge || next_badge
                   is_locked = latest_badge.nil?
                 %>
                 <div class="min-w-[110px] flex flex-col items-center gap-3 p-5 rounded-2xl bg-white/5 border border-white/10 hover:border-white/20 hover:bg-white/10 transition-all group cursor-default">
                    <div class="w-14 h-14 rounded-2xl flex items-center justify-center text-3xl relative shadow-xl <%= is_locked ? 'bg-white/10 opacity-40 grayscale' : 'bg-gradient-to-br from-white/20 to-white/10 backdrop-blur-sm' %>">
                      <%= display_badge&.icon_path || "üîí" %>
                      <% if latest_badge %>
                        <span class="absolute -top-2 -right-2 bg-gradient-to-br from-indigo-500 to-purple-600 text-white text-[10px] font-black px-2 py-1 rounded-full ring-2 ring-slate-900 shadow-lg">L<%= latest_badge.level %></span>
                      <% end %>
                    </div>
                    <div class="text-center space-y-1">
                      <p class="text-xs font-black text-white truncate max-w-[90px]"><%= display_badge&.name || "ÎØ∏ÌöçÎìù" %></p>
                      <p class="text-[10px] font-bold text-slate-400 uppercase"><%= type.to_s.humanize %></p>
                    </div>
                 </div>
              <% end %>
            </div>
          </div>
        </div>
      </div>

      <!-- FINANCE PANEL -->
      <div data-tabs-target="panel" data-id="finance" class="hidden space-y-6">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <!-- Summary Card -->
          <div class="md:col-span-1 bg-gradient-to-br from-emerald-600 to-teal-700 text-white rounded-3xl p-7 relative overflow-hidden shadow-2xl shadow-emerald-500/50">
             <div class="absolute -right-16 -bottom-16 w-56 h-56 bg-white/10 rounded-full blur-3xl"></div>
             <div class="relative z-10 space-y-8 h-full flex flex-col">
               <div>
                 <h4 class="text-lg font-black text-emerald-100 mb-3">My Assets</h4>
                 <div class="flex items-baseline gap-2">
                   <h2 class="text-5xl font-black"><%= number_with_delimiter(@growth_stats[:wallet_balance]) %></h2>
                   <span class="text-base font-bold text-emerald-200">Ïõê</span>
                 </div>
               </div>
               
               <div class="space-y-5 flex-1">
                 <div class="space-y-3">
                   <div class="flex justify-between text-sm font-bold text-emerald-100">
                     <span>ÏûêÏÇ∞ Î∞©Ïñ¥Ïú®</span>
                     <span class="text-white">100%</span>
                   </div>
                   <div class="h-2 bg-white/20 rounded-full overflow-hidden backdrop-blur-sm">
                     <div class="h-full bg-white shadow-lg shadow-white/50 w-[100%]"></div>
                   </div>
                   <p class="text-xs text-emerald-100">Î™®Îì† Ìà¨ÏûêÍ∞Ä ÏïàÏ†ÑÌïòÍ≤å Î≥¥Ìò∏ÎêòÍ≥† ÏûàÏäµÎãàÎã§.</p>
                 </div>
               </div>

               <button class="w-full py-3.5 bg-white/20 backdrop-blur-sm hover:bg-white/30 rounded-2xl text-sm font-black transition-all border border-white/30 shadow-lg">
                 ÏûÖÏ∂úÍ∏à Î¶¨Ìè¨Ìä∏ Îã§Ïö¥Î°úÎìú
               </button>
             </div>
          </div>

          <!-- History List -->
          <div class="md:col-span-2 bg-white/5 backdrop-blur-xl rounded-3xl border border-white/10 shadow-2xl p-7 space-y-5">
             <h4 class="text-lg font-black text-white mb-3">ÏµúÍ∑º ÏûÖÏ∂úÍ∏à ÎÇ¥Ïó≠</h4>
              <div class="space-y-2">
                 <% if @recent_transactions.any? %>
                   <% @recent_transactions.each do |item| %>
                   <div class="flex items-center justify-between p-4 hover:bg-white/5 rounded-2xl transition-all cursor-default border border-transparent hover:border-white/10 group">
                      <div class="flex items-center gap-4">
                         <div class="w-10 h-10 rounded-xl bg-white/10 text-slate-300 flex items-center justify-center shadow-md group-hover:bg-white/20 transition-colors">
                            <i data-feather="arrow-up-right" class="w-5 h-5"></i>
                         </div>
                         <div class="min-w-0">
                           <p class="font-black text-white truncate text-sm"><%= item[:title] %></p>
                           <p class="text-xs text-slate-400 font-medium"><%= item[:date] %></p>
                         </div>
                      </div>
                      <span class="font-black shrink-0 text-sm text-white">
                        -<%= number_with_delimiter(item[:amount]) %>Ïõê
                      </span>
                   </div>
                   <% end %>
                 <% else %>
                   <div class="py-16 text-center bg-white/5 rounded-2xl border border-dashed border-white/10">
                      <p class="text-sm font-bold text-slate-400">ÏµúÍ∑º ÏûÖÏ∂úÍ∏à ÎÇ¥Ïó≠Ïù¥ ÏóÜÏäµÎãàÎã§.</p>
                   </div>
                 <% end %>
              </div>
          </div>
        </div>
      </div>
      
      <!-- SOCIAL PANEL -->
      <div data-tabs-target="panel" data-id="social" class="hidden space-y-6">
        <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
          <!-- Stats -->
          <% [
             { label: "Î∞õÏùÄ ÏùëÏõê", value: number_with_delimiter(@social_stats[:received_cheers]), icon: "heart", gradient: "from-rose-500 to-pink-600", glow: "rose" },
             { label: "Î≥¥ÎÇ∏ ÏùëÏõê", value: number_with_delimiter(@social_stats[:sent_cheers]), icon: "thumbs-up", gradient: "from-indigo-500 to-purple-600", glow: "indigo" },
             { label: "Î≤†Ïä§Ìä∏ Î£®Ìã¥", value: @social_stats[:best_routine_count], icon: "star", gradient: "from-amber-500 to-orange-600", glow: "amber" },
             { label: "Î™®ÏûÑ ÌèâÏ†ê", value: @social_stats[:rating], icon: "message-circle", gradient: "from-emerald-500 to-teal-600", glow: "emerald" }
          ].each do |stat| %>
            <div class="bg-white/5 backdrop-blur-xl p-6 rounded-3xl border border-white/10 shadow-2xl flex items-center gap-4 group hover:scale-105 transition-all">
               <div class="w-12 h-12 rounded-2xl bg-gradient-to-br <%= stat[:gradient] %> flex items-center justify-center shadow-lg shadow-<%= stat[:glow] %>-500/50">
                 <i data-feather="<%= stat[:icon] %>" class="w-6 h-6 text-white"></i>
               </div>
               <div>
                 <p class="text-xs font-bold text-slate-400 uppercase"><%= stat[:label] %></p>
                 <h4 class="text-2xl font-black text-white"><%= stat[:value] %></h4>
               </div>
            </div>
          <% end %>
        </div>

         <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
           <!-- Hall of Fame -->
           <div class="md:col-span-2 bg-white/5 backdrop-blur-xl rounded-3xl border border-white/10 shadow-2xl p-7">
              <h4 class="text-lg font-black text-white mb-5 flex items-center gap-2">
                <i data-feather="award" class="w-5 h-5 text-indigo-400"></i> Î™ÖÏòàÏùò Ï†ÑÎãπ
              </h4>
              <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                <% if @top_achievers.any? %>
                  <% @top_achievers.each_with_index do |user, idx| %>
                     <% is_me = (user.id == current_user.id) %>
                     <div class="relative p-5 rounded-2xl border <%= is_me ? 'border-indigo-500 bg-indigo-500/10 ring-2 ring-indigo-500 shadow-lg shadow-indigo-500/50' : 'border-white/10 bg-white/5' %> flex flex-col items-center text-center gap-3 group hover:scale-105 transition-all">
                        <span class="absolute top-3 left-3 text-xs font-black text-slate-500">#<%= idx + 1 %></span>
                        <div class="w-16 h-16 rounded-full border-4 border-white/20 shadow-xl overflow-hidden bg-slate-700">
                          <img src="<%= user.profile_image.presence || "https://api.dicebear.com/7.x/lorelei/svg?seed=#{user.nickname}" %>" class="w-full h-full object-cover">
                        </div>
                        <div>
                          <p class="text-sm font-black text-white truncate max-w-[90px]"><%= user.nickname %></p>
                          <p class="text-xs font-bold text-slate-400"><%= user.badge_count %>Í∞úÏùò Î∞∞ÏßÄ</p>
                        </div>
                     </div>
                  <% end %>
                <% else %>
                  <div class="col-span-3 py-12 text-center text-slate-400 text-sm">ÏàúÏúÑ Îç∞Ïù¥ÌÑ∞Í∞Ä Ï∂©Î∂ÑÌïòÏßÄ ÏïäÏäµÎãàÎã§.</div>
                <% end %>
              </div>
           </div>
           
           <!-- Motivation Card -->
           <div class="bg-gradient-to-br from-indigo-600 to-purple-700 rounded-3xl p-7 text-white flex flex-col justify-center text-center relative overflow-hidden shadow-2xl shadow-indigo-500/50">
             <div class="absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-20"></div>
             <div class="relative z-10 space-y-4">
               <div class="w-14 h-14 bg-white/20 backdrop-blur-sm rounded-2xl flex items-center justify-center mx-auto mb-2 shadow-lg">
                 <i data-feather="zap" class="w-7 h-7 text-yellow-300"></i>
               </div>
               <h4 class="text-xl font-black leading-tight">ÎèôÍ∏∞Î∂ÄÏó¨Ïùò ÏïÑÏù¥ÏΩò!</h4>
               <p class="text-sm text-indigo-100 font-medium leading-relaxed px-4">
                 ÎãπÏã†Ïùò Ïù∏Ï¶ùÏùÄ ÌèâÍ∑† <br/> <b class="text-white text-lg"><%= @inspiration_count %>Î™Ö</b>ÏóêÍ≤å ÏòÅÍ∞êÏùÑ Ï§çÎãàÎã§.
               </p>
             </div>
           </div>
         </div>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    if (window.feather) feather.replace();
  });
</script>

<style>
  .no-scrollbar::-webkit-scrollbar { display: none; }
  .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
  
  @keyframes pulse {
    0%, 100% { opacity: 0.3; }
    50% { opacity: 0.5; }
  }
</style>
