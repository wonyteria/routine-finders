<div class="min-h-screen bg-slate-50/30 py-6 lg:py-12 px-4" data-controller="challenge-form">
  <div class="max-w-6xl mx-auto">
    <!-- Top Navigation Area -->
    <div class="flex items-center justify-between mb-6 lg:mb-12">
      <div class="flex items-center gap-3 lg:gap-6">
        <%= link_to challenges_path, class: "w-10 h-10 lg:w-14 lg:h-14 rounded-2xl bg-white border border-slate-100 flex items-center justify-center text-slate-400 hover:text-indigo-600 hover:border-indigo-100 shadow-sm transition-all group" do %>
          <svg class="w-5 h-5 group-hover:-translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M15 19l-7-7 7-7"/></svg>
        <% end %>
        <div class="space-y-0.5">
          <h1 class="text-xl lg:text-3xl font-black text-slate-900 tracking-tight">챌린지 설계하기</h1>
          <p class="text-[10px] lg:text-xs font-bold text-slate-400 leading-none">나만의 특별한 루틴 커뮤니티</p>
        </div>
      </div>
      
      <!-- Progress Bar & Dots -->
      <div class="flex flex-col items-end gap-2 lg:gap-3">
        <div class="flex gap-1.5 lg:gap-2">
          <% (1..7).each do |i| %>
            <div class="h-1 lg:h-1.5 rounded-full transition-all duration-700 <%= i == 1 ? 'bg-indigo-600 w-6 lg:w-8' : 'bg-slate-200 w-1.5 lg:w-2' %>" 
                 data-challenge-form-target="dot"></div>
          <% end %>
        </div>
        <p class="text-[8px] lg:text-[10px] font-black text-indigo-600/50 uppercase tracking-widest">Design Progress</p>
      </div>
    </div>

    <!-- Current Step Indicator (Mobile-friendly) -->
    <div class="mb-6 lg:mb-8 bg-gradient-to-r <%= current_user.is_rufa_club_member? ? "from-indigo-600 via-purple-600 to-indigo-800" : "from-indigo-500 to-purple-600" %> rounded-[28px] p-4 lg:p-6 shadow-xl shadow-indigo-200/50 relative overflow-hidden" data-challenge-form-target="stepIndicator">
      <% if current_user.is_rufa_club_member? %>
        <div class="absolute top-0 right-0 p-4">
          <span class="px-3 py-1 bg-white/20 backdrop-blur-md rounded-full text-[10px] font-black text-white uppercase tracking-widest border border-white/20">🔱 RUFA Premium Bypass</span>
        </div>
      <% end %>
      
      <div class="flex items-center justify-between relative z-10">
        <div class="flex items-center gap-3 lg:gap-4">
          <div class="w-12 h-12 lg:w-14 lg:h-14 rounded-2xl bg-white/20 backdrop-blur-sm flex items-center justify-center">
            <span class="text-2xl lg:text-3xl font-black text-white" data-challenge-form-target="stepNumber">1</span>
          </div>
          <div>
            <p class="text-[10px] lg:text-xs font-bold text-white/70 uppercase tracking-wider">Current Step</p>
            <h2 class="text-lg lg:text-xl font-black text-white" data-challenge-form-target="stepTitle">기본 정보</h2>
          </div>
        </div>
        
        <div class="flex items-center gap-4">
          <% unless current_user.is_rufa_club_member? %>
             <div class="hidden md:flex flex-col items-end gap-1">
               <p class="text-[9px] font-black text-white/50 uppercase tracking-widest">Host Qualification</p>
               <div class="flex items-center gap-2">
                 <span class="text-[11px] font-black text-white tracking-tighter">Lv. <%= current_user.level %> / 10</span>
                 <div class="w-20 h-1.5 bg-white/20 rounded-full overflow-hidden">
                   <div class="h-full bg-amber-400" style="width: <%= [current_user.level * 10, 100].min %>%"></div>
                 </div>
               </div>
             </div>
          <% end %>
          <div class="hidden lg:flex items-center gap-2 px-4 py-2 bg-white/20 backdrop-blur-sm rounded-xl">
            <span class="text-sm font-black text-white" data-challenge-form-target="stepProgress">1/7</span>
          </div>
        </div>
      </div>
    </div>

    <div class="flex flex-col lg:flex-row gap-8 lg:gap-16 items-start">
      <!-- Side Step Navigation (Desktop only) -->
      <div class="hidden lg:flex lg:flex-col lg:w-64 shrink-0 gap-8 lg:sticky lg:top-32">
        <% [
          { step: 1, label: "기본 정보", icon: "M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" },
          { step: 2, label: "인증 목표", icon: "M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" },
          { step: 3, label: "일정 설정", icon: "M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" },
          { step: 4, label: "인증 방식", icon: "M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" },
          { step: 5, label: "참여 조건", icon: "M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" },
          { step: 6, label: "비용 및 계좌", icon: "M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z" },
          { step: 7, label: "혜택 설계", icon: "M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2M17 16v2a2 2 0 01-2 2H9a2 2 0 01-2-2v-2m3-5v3m4-3v3m-2-6V5a2 2 0 114 0v2" }
        ].each_with_index do |nav, i| %>
          <button type="button" 
                  class="flex items-center gap-5 w-full text-left group" 
                  data-action="click->challenge-form#goToStep" 
                  data-step="<%= nav[:step] %>"
                  data-challenge-form-target="nav">
            <div class="nav-icon w-12 h-12 rounded-2xl flex items-center justify-center transition-all duration-500 <%= i == 0 ? 'bg-indigo-600 text-white shadow-xl shadow-indigo-200' : 'bg-white text-slate-300' %>">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="<%= nav[:icon] %>"/></svg>
            </div>
            <div class="nav-text space-y-0.5 transition-all duration-500 <%= i == 0 ? 'opacity-100' : 'opacity-40 hover:opacity-100' %>">
              <p class="text-[10px] font-black uppercase tracking-widest text-slate-400">Step <%= nav[:step] %></p>
              <p class="font-black text-xl text-slate-900 whitespace-nowrap"><%= nav[:label] %></p>
            </div>
          </button>
        <% end %>
      </div>

      <!-- Main Content Card -->
      <div class="flex-1 max-w-4xl">

        <%= form_with model: @challenge, multipart: true, class: "space-y-10", id: "challenge-form-ui" do |f| %>
          <%= f.hidden_field :mode %>

          <% if @challenge.errors.any? %>
            <div class="bg-red-50 border-2 border-red-200 rounded-[32px] p-8 space-y-6 shadow-xl shadow-red-100/50 animate-shake">
              <div class="flex items-center gap-4">
                <div class="w-12 h-12 bg-red-500 rounded-2xl flex items-center justify-center shrink-0">
                  <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg>
                </div>
                <div class="flex-1">
                  <h3 class="text-xl font-black text-red-900">챌린지 개설 실패</h3>
                  <p class="text-sm font-bold text-red-600 mt-1">아래 항목들을 확인하고 수정해주세요.</p>
                </div>
              </div>
              
              <div class="space-y-3 pl-4 lg:pl-16">
                <% @challenge.errors.full_messages.each do |message| %>
                  <div class="flex items-start gap-3 p-4 bg-white rounded-2xl border border-red-100">
                    <svg class="w-5 h-5 text-red-500 shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/></svg>
                    <p class="text-sm font-bold text-red-900 leading-relaxed"><%= message %></p>
                  </div>
                <% end %>
              </div>

              <div class="pl-4 lg:pl-16">
                <p class="text-xs font-bold text-red-600/70 leading-relaxed">💡 각 단계를 확인하여 필수 항목을 모두 입력했는지 확인해주세요.</p>
              </div>
            </div>
          <% end %>
          
          <!-- Step 1: Basic Information -->
          <div class="space-y-10" data-challenge-form-target="step">
            <div class="flex flex-col lg:flex-row gap-10 items-start">
              
              <!-- Left Column: Primary Content -->
              <div class="flex-1 w-full bg-white rounded-[32px] lg:rounded-[40px] p-6 lg:p-12 border border-slate-100 shadow-2xl shadow-slate-200/40 space-y-8 lg:space-y-12">
                <div class="space-y-6">
                  <div class="flex items-center gap-4 pl-2">
                    <div class="w-10 h-10 rounded-2xl bg-indigo-50 flex items-center justify-center text-indigo-600">
                      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/></svg>
                    </div>
                    <h3 class="text-xl font-black text-slate-900">챌린지 핵심 정보</h3>
                  </div>

                  <div class="space-y-8">
                    <div class="space-y-3">
                      <label class="text-[11px] font-black text-slate-400 uppercase tracking-widest pl-2">카테고리 선택</label>
                      <div class="relative group">
                        <%= f.select :category, 
                            options_for_select(['건강·운동', '학습·자기계발', 'SNS·브랜딩', '재테크·부업', '취미·라이프', '멘탈·성찰', '기타'], @challenge.category), 
                            { include_blank: "카테고리를 선택해주세요" }, 
                            class: "w-full p-6 bg-slate-50 border-2 border-transparent rounded-[28px] font-black text-lg text-slate-900 focus:bg-white focus:border-indigo-500/20 focus:ring-4 focus:ring-indigo-500/5 transition-all outline-none appearance-none cursor-pointer" %>
                        <svg class="w-5 h-5 absolute right-6 top-1/2 -translate-y-1/2 text-slate-400 pointer-events-none group-focus-within:text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M19 9l-7 7-7-7"/></svg>
                      </div>
                    </div>

                    <div class="space-y-3">
                      <label class="text-[11px] font-black text-slate-400 uppercase tracking-widest pl-2">챌린지 제목</label>
                      <%= f.text_field :title, placeholder: "예: 매일 아침 수영 30분 하기", class: "w-full text-lg font-black p-6 bg-slate-50 border-2 border-transparent rounded-[28px] placeholder:text-slate-300 focus:bg-white focus:border-indigo-500/20 focus:ring-4 focus:ring-indigo-500/5 transition-all outline-none", id: "challenge_title" %>
                    </div>

                    <div class="space-y-3">
                      <label class="text-[11px] font-black text-slate-400 uppercase tracking-widest pl-2">한 줄 요약</label>
                      <%= f.text_field :summary, placeholder: "참여자들의 눈길을 사로잡는 한 마디", class: "w-full p-6 bg-slate-50 border-2 border-transparent rounded-[28px] text-sm font-bold text-slate-900 placeholder:text-slate-300 focus:bg-white focus:border-indigo-500/20 focus:ring-4 focus:ring-indigo-500/5 transition-all outline-none" %>
                    </div>

                    <div class="space-y-3">
                      <label class="text-[11px] font-black text-slate-400 uppercase tracking-widest pl-2">상세 내역 소개</label>
                      <div class="relative group">
                        <%= f.text_area :description, placeholder: "챌린지의 목적, 참여 방법, 구체적인 루틴 등을 상세히 적어주세요.", class: "w-full p-8 bg-slate-50 border-2 border-transparent rounded-[32px] text-sm font-medium text-slate-700 placeholder:text-slate-300 focus:bg-white focus:border-indigo-500/20 focus:ring-4 focus:ring-indigo-500/5 transition-all outline-none min-h-[500px] leading-relaxed shadow-inner" %>
                        <div class="absolute bottom-6 right-8 text-[10px] font-bold text-slate-300 group-focus-within:text-indigo-400 transition-colors">
                          상세할수록 참여율이 올라갑니다 ✨
                        </div>
                      </div>
                    </div>

                    <div class="space-y-3">
                      <label class="text-[11px] font-black text-slate-400 uppercase tracking-widest pl-2">커뮤니티 채팅방 링크 (선택)</label>
                      <div class="relative group">
                        <%= f.text_field :chat_link, placeholder: "예: 카카오톡 오픈채팅, 디스코드 링크 등", class: "w-full p-6 bg-slate-50 border-2 border-transparent rounded-[28px] text-sm font-bold text-slate-900 placeholder:text-slate-300 focus:bg-white focus:border-indigo-500/20 focus:ring-4 focus:ring-indigo-500/5 transition-all outline-none" %>
                        <div class="absolute right-6 top-1/2 -translate-y-1/2 text-slate-300 group-focus-within:text-indigo-500 transition-colors pointer-events-none">
                          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/></svg>
                        </div>
                      </div>
                      <p class="text-[10px] font-bold text-slate-400 pl-2">💬 참여자들과 소통할 수 있는 채팅방 링크를 입력하면 '커뮤니티' 탭에 표시됩니다.</p>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Right Column: Branding & Meta (Sticky) -->
              <div class="w-full lg:w-80 shrink-0 space-y-8 lg:sticky lg:top-8">
                <!-- Host Bio Card -->
                <div class="bg-indigo-600 rounded-[40px] p-8 text-white shadow-2xl shadow-indigo-200/50 space-y-6 relative overflow-hidden group">
                  <div class="absolute -right-4 -top-4 w-24 h-24 bg-white/10 rounded-full blur-2xl group-hover:bg-white/20 transition-all"></div>
                  
                  <div class="flex items-center gap-3 relative z-10">
                    <div class="w-8 h-8 rounded-xl bg-white/20 backdrop-blur-md flex items-center justify-center">
                      <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
                    </div>
                    <label class="text-xs font-black uppercase tracking-wider">주최자 프로필</label>
                  </div>

                  <div class="space-y-4 relative z-10">
                    <p class="text-[10px] text-indigo-100 font-bold leading-relaxed px-1">챌린지 상세 페이지에 표시될<br>나만의 특별한 소개글입니다.</p>
                    <%= f.text_area :custom_host_bio, value: @challenge.custom_host_bio || current_user.bio, placeholder: "소개글을 입력해주세요.", class: "w-full p-5 bg-white/10 border border-white/20 rounded-2xl text-[13px] font-bold text-white placeholder:text-indigo-200/50 focus:bg-white focus:text-slate-900 focus:ring-0 transition-all min-h-[140px] outline-none shadow-inner", data: { challenge_form_target: "hostBio" } %>
                  </div>
                </div>

                <!-- Thumbnail Card -->
                <div class="bg-white rounded-[40px] p-8 border border-slate-100 shadow-xl shadow-slate-200/40 space-y-6">
                  <div class="flex items-center justify-between pl-1">
                    <label class="text-[11px] font-black text-slate-400 uppercase tracking-widest">대표 이미지</label>
                    <span class="text-[9px] font-bold text-indigo-500 bg-indigo-50 px-2 py-1 rounded-lg">800x450</span>
                  </div>
                  
                  <div class="relative group cursor-pointer aspect-[16/9] rounded-[28px] overflow-hidden bg-slate-50 border-2 border-dashed border-slate-200 flex flex-col items-center justify-center gap-3 hover:border-indigo-400 hover:bg-indigo-50/30 transition-all">
                    <%= f.file_field :thumbnail_image, class: "absolute inset-0 opacity-0 cursor-pointer z-10", data: { action: "change->challenge-form#previewThumbnail" } %>
                    <img src="" class="absolute inset-0 w-full h-full object-cover hidden" data-challenge-form-target="thumbnailPreview">
                    <div class="text-center space-y-2 pointer-events-none" id="thumbnail-placeholder">
                      <div class="w-10 h-10 bg-white rounded-2xl flex items-center justify-center text-slate-300 mx-auto shadow-sm group-hover:text-indigo-500 group-hover:scale-110 transition-all">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 0 00-2 2v12a2 2 0 002 2z"/></svg>
                      </div>
                      <p class="text-[10px] font-black text-slate-400 group-hover:text-indigo-500 transition-colors">이미지 업로드</p>
                    </div>
                  </div>
                </div>

                <!-- Next Button for Step 1 -->
                <button type="button" data-action="click->challenge-form#next" class="w-full py-6 bg-indigo-600 text-white rounded-[32px] font-black text-lg shadow-2xl shadow-indigo-600/30 hover:bg-indigo-700 hover:-translate-y-1 active:translate-y-0 transition-all flex items-center justify-center gap-3 group">
                  다음 단계로 
                  <svg class="w-5 h-5 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M13 7l5 5m0 0l-5 5m5-5H6"/></svg>
                </button>
              </div>
            </div>
          </div>
          
          <!-- Step 2: Mission Goal -->
          <div class="space-y-10 hidden" data-challenge-form-target="step">
            <div class="flex flex-col lg:flex-row gap-10 items-start">
              <!-- Left Column: Primary Content -->
              <div class="flex-1 w-full bg-white rounded-[32px] lg:rounded-[40px] p-6 lg:p-12 border border-slate-100 shadow-2xl shadow-slate-200/40 space-y-8 lg:space-y-12">
                <div class="space-y-6">
                  <div class="flex items-center gap-4 pl-2">
                    <div class="w-10 h-10 rounded-2xl bg-indigo-50 flex items-center justify-center text-indigo-600">
                      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/></svg>
                    </div>
                    <h3 class="text-xl font-black text-slate-900">무엇을 인증할까요?</h3>
                  </div>

                  <div class="space-y-8">
                    <div class="space-y-6">
                      <label class="text-[11px] font-black text-slate-400 uppercase tracking-widest pl-2">목표 설정 방식</label>
                      <div class="grid grid-cols-2 gap-6" data-option-group>
                        <button type="button" 
                                data-action="click->challenge-form#toggleMissionGoalType" 
                                data-type="fixed"
                                class="p-8 border-2 border-indigo-600 bg-indigo-50 shadow-lg shadow-indigo-600/5 rounded-[32px] font-black text-lg flex flex-col items-center gap-4 transition-all group">
                          <div class="w-12 h-12 rounded-2xl bg-indigo-600 text-white flex items-center justify-center transition-all group-hover:scale-110">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
                          </div>
                          <div class="text-center">
                            <p class="label-main font-black text-lg text-indigo-600">단일 목표</p>
                            <p class="label-sub text-[11px] font-bold text-indigo-400/80 mt-1">(매일 동일)</p>
                          </div>
                        </button>
                        <button type="button" 
                                data-action="click->challenge-form#toggleMissionGoalType" 
                                data-type="daily"
                                class="p-8 border-2 border-slate-100 bg-white rounded-[32px] font-black text-lg flex flex-col items-center gap-4 transition-all group">
                          <div class="w-12 h-12 rounded-2xl bg-slate-50 text-slate-300 flex items-center justify-center transition-all group-hover:scale-110">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
                          </div>
                          <div class="text-center">
                            <p class="label-main font-black text-lg text-slate-400">요일별 목표</p>
                            <p class="label-sub text-[11px] font-bold text-slate-300 mt-1">(매일 다름)</p>
                          </div>
                        </button>
                      </div>
                    </div>

                    <!-- Fixed Goal Section -->
                    <div class="space-y-4" data-challenge-form-target="fixedGoalSection">
                      <label class="text-[11px] font-black text-slate-400 uppercase tracking-widest pl-2">전체 기간 공통 목표</label>
                      <%= f.text_field :certification_goal, placeholder: "예: 아침 7시 이전 기상 사진 찍기", class: "w-full text-lg font-black p-6 bg-slate-50 border-2 border-transparent rounded-[28px] focus:bg-white focus:border-indigo-500/20 focus:ring-4 focus:ring-indigo-500/5 transition-all outline-none", id: "challenge_certification_goal" %>
                    </div>

                    <!-- Daily Goal Section -->
                    <div class="space-y-6 hidden" data-challenge-form-target="dailyGoalSection">
                      <label class="text-[11px] font-black text-slate-400 uppercase tracking-widest pl-2">요일별 상세 목표</label>
                      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <% ["월", "화", "수", "목", "금", "토", "일"].each do |day| %>
                          <div class="space-y-2 p-6 bg-slate-50/50 rounded-[28px] border border-slate-100">
                            <div class="flex items-center gap-2">
                              <span class="w-8 h-8 rounded-lg bg-indigo-50 text-indigo-600 flex items-center justify-center text-xs font-black"><%= day %></span>
                              <span class="text-[11px] font-black text-slate-400 uppercase tracking-widest">목표</span>
                            </div>
                            <input type="text" 
                                   placeholder="<%= day %>요일의 목표" 
                                   data-day="<%= day %>"
                                   data-action="input->challenge-form#updateDailyGoal"
                                   class="w-full p-4 bg-white border-2 border-transparent rounded-2xl text-sm font-bold focus:border-indigo-500/10 transition-all outline-none">
                          </div>
                        <% end %>
                      </div>
                      <%= f.hidden_field :daily_goals, id: "challenge_daily_goals_hidden" %>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Right Column: Navigation & Guide (Sticky) -->
              <div class="w-full lg:w-80 shrink-0 space-y-8 lg:sticky lg:top-8">
                <div class="bg-indigo-600 rounded-[40px] p-8 text-white shadow-2xl shadow-indigo-200/50 space-y-6 relative overflow-hidden group">
                  <div class="absolute -right-4 -top-4 w-24 h-24 bg-white/10 rounded-full blur-2xl group-hover:bg-white/20 transition-all"></div>
                  <div class="flex items-center gap-3 relative z-10">
                    <div class="w-8 h-8 rounded-xl bg-white/20 backdrop-blur-md flex items-center justify-center">
                      <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                    </div>
                    <p class="font-black text-sm">인증 목표 안내</p>
                  </div>
                  <p class="text-[11px] text-indigo-100 font-bold leading-relaxed px-1 relative z-10">인증 목표가 구체적일수록 참여자들이 더욱 명확하게 행동할 수 있습니다. <br><br> 예: "운동하기" 보다는 "헬스장 출석 사진 찍기" 처럼 구체적인 수단이 좋습니다.</p>
                </div>

                <div class="space-y-4">
                  <button type="button" data-action="click->challenge-form#next" class="w-full py-6 bg-indigo-600 text-white rounded-[32px] font-black text-lg shadow-2xl shadow-indigo-600/30 hover:bg-indigo-700 hover:-translate-y-1 active:translate-y-0 transition-all flex items-center justify-center gap-3 group">
                    다음 단계로
                    <svg class="w-5 h-5 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M13 7l5 5m0 0l-5 5m5-5H6"/></svg>
                  </button>
                  <button type="button" data-action="click->challenge-form#prev" class="w-full py-5 bg-slate-100 text-slate-400 rounded-[32px] font-black text-sm hover:bg-slate-200 transition-all">
                    이전 단계로
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Step 3: Schedule Info -->
          <div class="space-y-10 hidden" data-challenge-form-target="step">
            <div class="flex flex-col lg:flex-row gap-10 items-start">
              <!-- Left Column: Primary Content -->
              <div class="flex-1 w-full bg-white rounded-[32px] lg:rounded-[40px] p-6 lg:p-12 border border-slate-100 shadow-2xl shadow-slate-200/40 space-y-8 lg:space-y-12">
                <div class="space-y-6">
                  <div class="flex items-center gap-4 pl-2">
                    <div class="w-10 h-10 rounded-2xl bg-indigo-50 flex items-center justify-center text-indigo-600">
                      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
                    </div>
                    <div>
                      <h3 class="text-xl font-black text-slate-900">챌린지 일정 설정</h3>
                      <p class="text-[11px] font-bold text-slate-400 mt-0.5">인증 기간과 요일을 정해볼까요?</p>
                    </div>
                  </div>

                  <div class="grid grid-cols-2 gap-8">
                    <div class="space-y-3">
                      <label class="text-[11px] font-black text-slate-400 uppercase tracking-widest pl-2">시작일</label>
                      <div class="relative group">
                        <%= f.date_field :start_date, value: @challenge.start_date || Date.current, onclick: "this.showPicker()", class: "w-full p-6 bg-slate-50 border-2 border-transparent rounded-[28px] font-black text-lg text-slate-900 focus:bg-white focus:border-indigo-500/20 focus:ring-4 focus:ring-indigo-500/5 transition-all outline-none cursor-pointer", id: "challenge_start_date" %>
                      </div>
                    </div>
                    <div class="space-y-3">
                      <label class="text-[11px] font-black text-slate-400 uppercase tracking-widest pl-2">종료일</label>
                      <div class="relative group">
                        <%= f.date_field :end_date, value: @challenge.end_date || Date.current + 7.days, onclick: "this.showPicker()", class: "w-full p-6 bg-slate-50 border-2 border-transparent rounded-[28px] font-black text-lg text-slate-900 focus:bg-white focus:border-indigo-500/20 focus:ring-4 focus:ring-indigo-500/5 transition-all outline-none cursor-pointer", id: "challenge_end_date" %>
                      </div>
                    </div>
                  </div>

                  <%= f.hidden_field :mission_frequency, value: "daily" %>

                  <div class="bg-slate-50/50 rounded-[40px] p-10 space-y-8 border border-slate-100/50 shadow-inner mt-8">
                    <div class="flex items-center justify-between">
                      <div class="space-y-1">
                        <p class="text-sm font-black text-slate-900">인증 요일 선택</p>
                        <p class="text-[11px] font-bold text-slate-400">선택한 요일에만 인증이 진행됩니다.</p>
                      </div>
                      <div class="flex items-center gap-2">
                        <button type="button" data-action="click->challenge-form#selectAllDays" class="text-[9px] font-black text-indigo-600 bg-white px-2 py-1 rounded-lg border border-indigo-100 hover:bg-indigo-50 transition-all">전체 선택</button>
                        <button type="button" data-action="click->challenge-form#deselectAllDays" class="text-[9px] font-black text-slate-400 bg-white px-2 py-1 rounded-lg border border-slate-100 hover:bg-slate-50 transition-all">전체 해제</button>
                      </div>
                    </div>
                    <div class="grid grid-cols-4 gap-4 w-fit">
                      <% ["월", "화", "수", "목", "금", "토", "일"].each do |day| %>
                        <button type="button" 
                                data-day="<%= day %>"
                                data-action="click->challenge-form#toggleDay"
                                class="w-16 h-16 rounded-[22px] bg-indigo-600 text-white shadow-lg border-indigo-600 font-black text-lg flex items-center justify-center transition-all duration-300 transform active:scale-90 hover:border-indigo-200">
                          <%= day %>
                        </button>
                        <%= check_box_tag "challenge[days][]", day, true, id: "day_#{day}", class: "sr-only" %>
                      <% end %>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Right Column: Navigation & Summary (Sticky) -->
              <div class="w-full lg:w-80 shrink-0 space-y-8 lg:sticky lg:top-8">
                <!-- Schedule Guide Card (Premium Style) -->
                <div class="bg-indigo-600 rounded-[40px] p-8 text-white shadow-2xl shadow-indigo-200/50 space-y-6 relative overflow-hidden group">
                  <div class="absolute -right-4 -top-4 w-24 h-24 bg-white/10 rounded-full blur-2xl group-hover:bg-white/20 transition-all"></div>
                  
                  <div class="flex items-center gap-3 relative z-10">
                    <div class="w-8 h-8 rounded-xl bg-white/20 backdrop-blur-md flex items-center justify-center">
                      <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                    </div>
                    <p class="font-black text-sm">일정 가이드</p>
                  </div>

                  <ul class="space-y-4 relative z-10">
                    <li class="flex gap-3">
                      <div class="w-1.5 h-1.5 rounded-full bg-indigo-200 mt-1.5 shrink-0"></div>
                      <p class="text-[11px] font-bold text-indigo-100 leading-relaxed">최소 3일 이상의 기간을 권장합니다.</p>
                    </li>
                    <li class="flex gap-3">
                      <div class="w-1.5 h-1.5 rounded-full bg-indigo-200 mt-1.5 shrink-0"></div>
                      <p class="text-[11px] font-bold text-indigo-100 leading-relaxed">인증 요일은 참여자의 습관 형성 주기를 결정합니다.</p>
                    </li>
                  </ul>
                </div>

                <div class="space-y-4">
                  <button type="button" data-action="click->challenge-form#next" class="w-full py-6 bg-indigo-600 text-white rounded-[32px] font-black text-lg shadow-2xl shadow-indigo-600/30 hover:bg-indigo-700 hover:-translate-y-1 active:translate-y-0 transition-all flex items-center justify-center gap-3 group">
                    다음 단계로
                    <svg class="w-5 h-5 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M13 7l5 5m0 0l-5 5m5-5H6"/></svg>
                  </button>
                  <button type="button" data-action="click->challenge-form#prev" class="w-full py-5 bg-slate-100 text-slate-400 rounded-[32px] font-black text-sm hover:bg-slate-200 transition-all">
                    이전 단계로
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Step 4: Verification Method -->
          <div class="space-y-10 hidden" data-challenge-form-target="step">
            <div class="flex flex-col lg:flex-row gap-10 items-start">
              
              <!-- Left Column: Primary Content -->
              <div class="flex-1 w-full bg-white rounded-[32px] lg:rounded-[40px] p-6 lg:p-12 border border-slate-100 shadow-2xl shadow-slate-200/40 space-y-8 lg:space-y-12">
                <div class="space-y-8">
                  <div class="flex items-center gap-4 pl-2">
                    <div class="w-10 h-10 rounded-2xl bg-indigo-50 flex items-center justify-center text-indigo-600">
                      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                    </div>
                    <h3 class="text-xl font-black text-slate-900">참여 인증 방식</h3>
                  </div>

                  <div class="space-y-6">
                    <label class="text-[11px] font-black text-slate-400 uppercase tracking-widest pl-2">인증 유형 선택</label>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4">
                      <% [
                        { id: "photo", label: "Photo", desc: "생동감 있는 사진 업로드", icon: "M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" },
                        { id: "simple", label: "Simple", desc: "간편한 버튼 터치", icon: "M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" },
                        { id: "metric", label: "Metric", desc: "정확한 수치 기록", icon: "M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2" },
                        { id: "url", label: "URL", desc: "관련 링크 제출", icon: "M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101" }
                      ].each do |type| %>
                        <button type="button" 
                                data-action="click->challenge-form#toggleVerificationType" 
                                data-type="<%= type[:id] %>"
                                class="p-3 sm:p-6 border-2 <%= (@challenge.send("v_#{type[:id]}") || (type[:id] == 'photo')) ? 'border-indigo-600 bg-indigo-50 shadow-lg shadow-indigo-600/5' : 'border-slate-100 bg-white' %> rounded-[20px] sm:rounded-[24px] lg:rounded-[28px] flex items-center gap-3 sm:gap-4 group hover:border-indigo-200 transition-all text-left">
                          <div class="verif-icon-box w-9 h-9 sm:w-10 sm:h-10 rounded-xl <%= (@challenge.send("v_#{type[:id]}") || (type[:id] == 'photo')) ? 'bg-indigo-600 text-white shadow-lg shadow-indigo-200' : 'bg-slate-50 text-slate-300' %> flex items-center justify-center shrink-0 transition-all duration-300 group-hover:scale-105">
                            <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="<%= type[:icon] %>"/></svg>
                          </div>
                          <div class="min-w-0">
                            <p class="font-black text-xs sm:text-sm text-slate-900 group-hover:text-indigo-600 transition-colors"><%= type[:label] %></p>
                            <p class="text-[9px] sm:text-[10px] font-bold text-slate-400 mt-0.5 truncate"><%= type[:desc] %></p>
                          </div>
                        </button>
                        <%= f.hidden_field "v_#{type[:id]}", value: (@challenge.send("v_#{type[:id]}") ? "1" : (type[:id] == 'photo' ? "1" : "0")), id: "challenge_v_#{type[:id]}" %>
                      <% end %>
                    </div>
                  </div>

                  <div class="space-y-6 pt-4">
                    <label class="text-[11px] font-black text-slate-400 uppercase tracking-widest pl-2">인증 가능 시간대</label>
                    <div class="flex flex-col sm:flex-row items-center gap-4 sm:gap-6 p-6 lg:p-10 bg-slate-50 rounded-[40px] border border-slate-100 shadow-inner">
                      <div class="flex-1 w-full space-y-3">
                        <p class="text-[10px] font-black text-slate-400 uppercase text-center">시작 시간</p>
                        <div class="relative group">
                          <%= f.time_field :verification_start_time, value: @challenge.verification_start_time&.strftime("%H:%M") || "00:00", onclick: "this.showPicker()", class: "w-full p-5 lg:p-6 bg-white border-2 border-transparent rounded-[24px] font-black text-lg lg:text-xl text-center focus:border-indigo-500/20 focus:ring-4 focus:ring-indigo-500/5 transition-all outline-none cursor-pointer" %>
                        </div>
                      </div>
                      <div class="hidden sm:block pt-6">
                        <div class="w-8 h-1 bg-slate-200 rounded-full"></div>
                      </div>
                      <div class="flex-1 w-full space-y-3">
                        <p class="text-[10px] font-black text-slate-400 uppercase text-center">종료 시간</p>
                        <div class="relative group">
                          <%= f.time_field :verification_end_time, value: @challenge.verification_end_time&.strftime("%H:%M") || "23:59", onclick: "this.showPicker()", class: "w-full p-5 lg:p-6 bg-white border-2 border-transparent rounded-[24px] font-black text-lg lg:text-xl text-center focus:border-indigo-500/20 focus:ring-4 focus:ring-indigo-500/5 transition-all outline-none cursor-pointer" %>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="space-y-6 pt-4">
                    <label class="text-[11px] font-black text-slate-400 uppercase tracking-widest pl-2">인증 옵션 설정</label>
                    <div class="space-y-4">
                      <div class="p-5 bg-slate-50 rounded-[28px] flex items-center justify-between group transition-all hover:bg-white border border-slate-100">
                        <div class="flex items-center gap-4">
                          <div class="w-10 h-10 rounded-2xl bg-indigo-100 flex items-center justify-center text-indigo-600 transition-colors group-hover:bg-indigo-600 group-hover:text-white">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg>
                          </div>
                          <div>
                            <div class="flex items-center gap-1.5">
                              <p class="font-black text-sm text-slate-900">재인증 허용</p>
                              <div class="relative group/tooltip">
                                <svg class="w-3.5 h-3.5 text-slate-300 hover:text-indigo-500 cursor-help transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                                <div class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 hidden group-hover/tooltip:block w-48 p-3 bg-slate-900 text-white text-[10px] font-bold rounded-xl shadow-2xl z-50 pointer-events-none">
                                  <p class="leading-relaxed">주최자가 인증을 거절했을 때, 당일 내에 다시 도전할 수 있는 기회를 주는 기능입니다.</p>
                                  <div class="absolute top-full left-1/2 -translate-x-1/2 border-8 border-transparent border-t-slate-900"></div>
                                </div>
                              </div>
                            </div>
                            <p class="text-[10px] font-bold text-slate-400 mt-0.5">실패 시 재시도 기회 제공</p>
                          </div>
                        </div>
                        <div class="relative inline-flex items-center">
                          <%= f.check_box :re_verification_allowed, class: "sr-only peer", id: "re_verification_allowed_cb" %>
                          <label for="re_verification_allowed_cb" class="w-11 h-6 bg-slate-200 rounded-full peer peer-checked:bg-indigo-600 after:content-[''] after:absolute after:top-1 after:left-1 after:bg-white after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:after:translate-x-5 cursor-pointer"></label>
                        </div>
                      </div>

                      <div class="p-5 bg-slate-50 rounded-[28px] flex items-center justify-between group transition-all hover:bg-white border border-slate-100">
                        <div class="flex items-center gap-4">
                          <div class="w-10 h-10 rounded-2xl bg-amber-100 flex items-center justify-center text-amber-600 transition-colors group-hover:bg-amber-500 group-hover:text-white">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg>
                          </div>
                          <div>
                            <div class="flex items-center gap-1.5">
                              <p class="font-black text-sm text-slate-900">인증 승인제</p>
                              <div class="relative group/tooltip">
                                <svg class="w-3.5 h-3.5 text-slate-300 hover:text-amber-500 cursor-help transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                                <div class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 hidden group-hover/tooltip:block w-48 p-3 bg-slate-900 text-white text-[10px] font-bold rounded-xl shadow-2xl z-50 pointer-events-none">
                                  <p class="leading-relaxed">참여자의 인증물을 호스트가 직접 검토하고 승인해야 최종 성공으로 인정되는 방식입니다.</p>
                                  <div class="absolute top-full left-1/2 -translate-x-1/2 border-8 border-transparent border-t-slate-900"></div>
                                </div>
                              </div>
                            </div>
                            <p class="text-[10px] font-bold text-slate-400 mt-0.5">호스트가 직접 승인</p>
                          </div>
                        </div>
                        <div class="relative inline-flex items-center">
                          <%= f.check_box :mission_requires_host_approval, class: "sr-only peer", id: "mission_requires_host_approval_cb" %>
                          <label for="mission_requires_host_approval_cb" class="w-11 h-6 bg-slate-200 rounded-full peer peer-checked:bg-amber-500 after:content-[''] after:absolute after:top-1 after:left-1 after:bg-white after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:after:translate-x-5 cursor-pointer"></label>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Right Column: Navigation & Guide (Sticky) -->
              <div class="w-full lg:w-80 shrink-0 space-y-6 lg:space-y-8 lg:sticky lg:top-8">
                <div class="bg-indigo-50/50 rounded-[28px] lg:rounded-[40px] p-6 lg:p-8 border border-indigo-100/30 space-y-4 lg:space-y-6">
                  <div class="flex items-center gap-3 text-indigo-900 border-b border-indigo-100/50 pb-3 lg:pb-4">
                    <div class="w-8 h-8 rounded-xl bg-white flex items-center justify-center">
                      <svg class="w-4 h-4 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                    </div>
                    <p class="font-black text-sm">인증 방식 안내</p>
                  </div>
                  <p class="text-[11px] font-bold text-indigo-900/40 leading-relaxed">사진 인증은 가장 확실한 방법이며, 간편 인증은 참여 장벽을 낮춥니다. 승인제를 활성화하면 품질 관리가 가능합니다.</p>
                </div>

                <div class="space-y-3 lg:space-y-4">
                  <button type="button" data-action="click->challenge-form#next" class="w-full py-5 lg:py-6 bg-indigo-600 text-white rounded-[28px] lg:rounded-[32px] font-black text-base lg:text-lg shadow-2xl shadow-indigo-600/30 hover:bg-indigo-700 hover:-translate-y-1 active:translate-y-0 transition-all flex items-center justify-center gap-3 group">
                    다음 단계로
                    <svg class="w-5 h-5 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M13 7l5 5m0 0l-5 5m5-5H6"/></svg>
                  </button>
                  <button type="button" data-action="click->challenge-form#prev" class="w-full py-4 lg:py-5 bg-slate-100 text-slate-400 rounded-[28px] lg:rounded-[32px] font-black text-sm hover:bg-slate-200 transition-all">
                    이전 단계로
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Step 4: Participation Conditions -->
          <div class="space-y-10 hidden" data-challenge-form-target="step">
            <div class="flex flex-col lg:flex-row gap-10 items-start">
              
              <!-- Left Column: Primary Content -->
              <div class="flex-1 w-full bg-white rounded-[32px] lg:rounded-[40px] p-6 lg:p-12 border border-slate-100 shadow-2xl shadow-slate-200/40 space-y-8 lg:space-y-12">
                <div class="space-y-8">
                  <div class="flex items-center gap-4 pl-2">
                    <div class="w-10 h-10 rounded-2xl bg-indigo-50 flex items-center justify-center text-indigo-600">
                      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"/></svg>
                    </div>
                    <h3 class="text-xl font-black text-slate-900">참여 조건 및 인원</h3>
                  </div>

                  <div class="space-y-6">
                    <label class="text-[11px] font-black text-slate-400 uppercase tracking-widest pl-2">공개 여부</label>
                    <div class="grid grid-cols-2 gap-6" data-option-group>
                      <button type="button" 
                              data-action="click->challenge-form#selectOption" 
                              data-name="is_private" 
                              data-value="false"
                              class="p-6 border-2 <%= !@challenge.is_private? ? 'border-indigo-600 bg-indigo-50 shadow-lg shadow-indigo-600/5' : 'border-slate-100 bg-white' %> rounded-[28px] text-center space-y-2 transition-all group">
                        <div class="option-icon <%= !@challenge.is_private? ? 'text-indigo-600' : 'text-slate-300' %> flex justify-center">
                          <svg class="w-6 h-6 group-hover:scale-110 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 11V7a4 4 0 118 0m-4 8v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2z"/></svg>
                        </div>
                        <div>
                          <p class="font-black text-sm text-slate-900 line-clamp-1">공개 챌린지</p>
                          <p class="text-[9px] font-bold text-slate-400">누구나 검색하여 참여 가능</p>
                        </div>
                      </button>
                      <button type="button" 
                              data-action="click->challenge-form#selectOption" 
                              data-name="is_private" 
                              data-value="true"
                              class="p-6 border-2 <%= @challenge.is_private? ? 'border-indigo-600 bg-indigo-50 shadow-lg shadow-indigo-600/5' : 'border-slate-100 bg-white' %> rounded-[28px] text-center space-y-2 transition-all group">
                        <div class="option-icon <%= @challenge.is_private? ? 'text-indigo-600' : 'text-slate-300' %> flex justify-center">
                          <svg class="w-6 h-6 group-hover:scale-110 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2z"/></svg>
                        </div>
                        <div>
                          <p class="font-black text-sm text-slate-900 line-clamp-1">비공개 챌린지</p>
                          <p class="text-[9px] font-bold text-slate-400">초대 코드 전용 챌린지</p>
                        </div>
                      </button>
                      <%= f.hidden_field :is_private, value: @challenge.is_private? %>
                    </div>

                    <!-- Invitation Code (Moved & Compacted) -->
                    <div class="<%= @challenge.is_private? ? 'block' : 'hidden' %> mt-4" data-challenge-form-target="invitationCodeSection">
                      <div class="bg-amber-50 border border-amber-100 rounded-3xl p-5 flex items-center justify-between group/code transition-all hover:bg-amber-100/50">
                        <div class="flex items-center gap-4">
                          <div class="w-10 h-10 rounded-2xl bg-amber-500 text-white flex items-center justify-center shadow-lg shadow-amber-500/20">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"/></svg>
                          </div>
                          <div>
                            <p class="text-[10px] font-black text-amber-600 uppercase tracking-widest leading-none mb-1">초대 코드</p>
                            <p class="text-lg font-black text-slate-900 tracking-wider" id="invitation_code_display"><%= @challenge.invitation_code || "-" %></p>
                          </div>
                        </div>
                        <button type="button" 
                                data-action="click->challenge-form#copyInvitationCode"
                                class="flex items-center gap-2 px-4 py-2 bg-amber-500 text-white rounded-xl text-[11px] font-black hover:bg-amber-600 transition-all shadow-md shadow-amber-500/10 active:scale-95">
                          <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M8 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/></svg>
                          코드 복사
                        </button>
                      </div>
                      <%= f.hidden_field :invitation_code, id: "challenge_invitation_code", value: @challenge.invitation_code %>
                    </div>
                  </div>

                  <div class="space-y-6 pt-4">
                    <label class="text-[11px] font-black text-slate-400 uppercase tracking-widest pl-2">참여 신청 방식</label>
                    <div class="grid grid-cols-2 gap-6" data-option-group>
                      <button type="button" data-action="click->challenge-form#selectOption" data-name="admission_type" data-value="first_come" class="p-6 border-2 <%= (@challenge.admission_type || 'first_come') == 'first_come' ? 'border-indigo-600 bg-indigo-50 shadow-lg shadow-indigo-600/5' : 'border-slate-100 bg-white' %> rounded-[28px] font-black text-sm flex items-center justify-center gap-3 transition-all group" data-name="admission_type" data-value="first_come">
                        <svg class="w-5 h-5 <%= (@challenge.admission_type || 'first_come') == 'first_come' ? 'text-indigo-600' : 'text-slate-300' %>" fill="currentColor" viewBox="0 0 24 24"><path d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
                        <span class="<%= (@challenge.admission_type || 'first_come') == 'first_come' ? 'text-indigo-600' : 'text-slate-400' %>">선착순 입장</span>
                      </button>
                      <button type="button" data-action="click->challenge-form#selectOption" data-name="admission_type" data-value="approval" class="p-6 border-2 <%= @challenge.admission_type == 'approval' ? 'border-indigo-600 bg-indigo-50 shadow-lg shadow-indigo-600/5' : 'border-slate-100 bg-white' %> rounded-[28px] font-black text-sm flex items-center justify-center gap-3 transition-all group" data-name="admission_type" data-value="approval">
                        <svg class="w-5 h-5 <%= @challenge.admission_type == 'approval' ? 'text-indigo-600' : 'text-slate-300' %>" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
                        <span class="<%= @challenge.admission_type == 'approval' ? 'text-indigo-600' : 'text-slate-400' %>">호스트 승인</span>
                      </button>
                      <%= f.hidden_field :admission_type, value: @challenge.admission_type || "first_come" %>
                    </div>
                  </div>

                  <div class="space-y-6 pt-4">
                    <div class="flex items-center gap-3 pl-2">
                      <div class="w-8 h-8 rounded-xl bg-emerald-50 flex items-center justify-center text-emerald-600">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
                      </div>
                      <label class="text-sm font-black text-slate-900">참여 모집 기간 설정</label>
                      <span class="px-2 py-1 bg-red-500 text-white text-[9px] font-black rounded-md">필수</span>
                    </div>
                    <div class="flex items-center gap-4 p-8 bg-gradient-to-br from-emerald-50 to-indigo-50 rounded-[32px] border-2 border-emerald-200 shadow-lg shadow-emerald-100/50">
                      <div class="flex-1 space-y-2">
                        <p class="text-[10px] font-black text-emerald-700 uppercase text-center tracking-tighter">모집 시작일</p>
                        <%= f.date_field :recruitment_start_date, 
                            value: @challenge.recruitment_start_date || Date.current, 
                            onclick: "this.showPicker()", 
                            required: true,
                            class: "w-full p-4 bg-white border-2 border-emerald-200 rounded-2xl font-bold text-sm text-center focus:border-emerald-500 focus:ring-4 focus:ring-emerald-500/20 transition-all outline-none cursor-pointer shadow-sm" %>
                      </div>
                      <div class="pt-6">
                        <svg class="w-5 h-5 text-emerald-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M13 7l5 5m0 0l-5 5m5-5H6"/></svg>
                      </div>
                      <div class="flex-1 space-y-2">
                        <p class="text-[10px] font-black text-indigo-700 uppercase text-center tracking-tighter">모집 마감일</p>
                        <%= f.date_field :recruitment_end_date, 
                            value: @challenge.recruitment_end_date || Date.current + 7.days, 
                            onclick: "this.showPicker()", 
                            required: true,
                            class: "w-full p-4 bg-white border-2 border-indigo-200 rounded-2xl font-bold text-sm text-center focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/20 transition-all outline-none cursor-pointer shadow-sm" %>
                      </div>
                    </div>
                    <p class="text-xs font-bold text-slate-500 pl-2">💡 모집 기간을 설정하면 해당 기간 동안만 참여 신청을 받을 수 있습니다.</p>
                  </div>

                  <div class="space-y-6 pt-4 bg-slate-50/50 rounded-[32px] p-8 border border-slate-100/50">
                    <div class="flex items-center justify-between gap-4 pl-2">
                      <div class="space-y-1 flex-1">
                        <p class="text-sm font-black text-slate-900">최대 참여 인원</p>
                        <p class="text-[11px] font-bold text-slate-400 leading-tight whitespace-nowrap">안정적인 관리를 위해 제한을 두는 것이 좋습니다.</p>
                      </div>
                      <div class="flex-shrink-0">
                        <span id="max-participants-display" class="inline-block min-w-[80px] text-center text-lg font-black text-indigo-600 bg-white px-4 py-2 rounded-2xl border border-indigo-100 shadow-sm transition-all"><%= (@challenge.max_participants || 10) %>명</span>
                      </div>
                    </div>
                    <div class="px-2">
                      <%= f.range_field :max_participants, min: 2, max: 100, step: 1, value: @challenge.max_participants || 10, 
                          class: "w-full h-2.5 bg-slate-200 rounded-full appearance-none cursor-pointer accent-indigo-600 transition-all",
                          style: "background-image: linear-gradient(#4f46e5, #4f46e5); background-repeat: no-repeat; background-size: #{(((@challenge.max_participants || 10) - 2).to_f / 98 * 100).round}% 100%;",
                          data: { action: "input->challenge-form#updateMaxParticipants" } %>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Right Column: Navigation & Extras (Sticky) -->
              <div class="w-full lg:w-80 shrink-0 space-y-6 lg:space-y-8 lg:sticky lg:top-8">


                <div class="bg-indigo-50/50 rounded-[28px] lg:rounded-[40px] p-6 lg:p-8 border border-indigo-100/30 space-y-4 lg:space-y-6">
                  <div class="flex items-center gap-3 text-indigo-900 border-b border-indigo-100/50 pb-3 lg:pb-4">
                    <div class="w-8 h-8 rounded-xl bg-white flex items-center justify-center">
                      <svg class="w-4 h-4 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                    </div>
                    <p class="font-black text-sm">입장 정책</p>
                  </div>
                  <p class="text-[11px] font-bold text-indigo-900/40 leading-relaxed">호스트 승인을 선택할 경우, 호스트님이 신청자 목록에서 입금/참여를 확인한 후 직접 수락해야 합니다.</p>
                </div>

                <div class="space-y-3 lg:space-y-4">
                  <button type="button" data-action="click->challenge-form#next" class="w-full py-5 lg:py-6 bg-indigo-600 text-white rounded-[28px] lg:rounded-[32px] font-black text-base lg:text-lg shadow-2xl shadow-indigo-600/30 hover:bg-indigo-700 hover:-translate-y-1 active:translate-y-0 transition-all flex items-center justify-center gap-3 group">
                    다음 단계로
                    <svg class="w-5 h-5 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M13 7l5 5m0 0l-5 5m5-5H6"/></svg>
                  </button>
                  <button type="button" data-action="click->challenge-form#prev" class="w-full py-4 lg:py-5 bg-slate-100 text-slate-400 rounded-[28px] lg:rounded-[32px] font-black text-sm hover:bg-slate-200 transition-all">
                    이전 단계로
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Step 5: Cost & Account -->
          <div class="space-y-10 hidden" data-challenge-form-target="step">
            <div class="flex flex-col lg:flex-row gap-10 items-start">
              
              <!-- Left Column: Primary Content -->
              <div class="flex-1 w-full bg-white rounded-[32px] lg:rounded-[40px] p-6 lg:p-12 border border-slate-100 shadow-2xl shadow-slate-200/40 space-y-8 lg:space-y-12">
                <div class="space-y-8">
                  <div class="flex items-center gap-4 pl-2">
                    <div class="w-10 h-10 rounded-2xl bg-indigo-50 flex items-center justify-center text-indigo-600">
                      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/></svg>
                    </div>
                    <h3 class="text-xl font-black text-slate-900">참가 비용 및 계좌</h3>
                  </div>

                  <div class="space-y-6">
                    <label class="text-[11px] font-black text-slate-400 uppercase tracking-widest pl-2">비용 방식 선택</label>
                    <div class="grid grid-cols-3 gap-4" data-option-group>
                      <% [
                          { id: "free", label: "무료", sub: "자유로운 참여", icon: "M13 10V3L4 14h7v7l9-11h-7z" },
                          { id: "fee", label: "참가비", sub: "수익 창출형", icon: "M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2" },
                          { id: "deposit", label: "보증금", sub: "동기 부여형", icon: "M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z" }
                      ].each do |cost| %>
                          <button type="button" 
                                  data-action="click->challenge-form#toggleCostType" 
                                  data-type="<%= cost[:id] %>"
                                  class="cost-type-btn p-5 border-2 <%= (@challenge.cost_type || 'deposit') == cost[:id] ? 'border-indigo-600 bg-indigo-50 shadow-lg shadow-indigo-600/5' : 'border-slate-100 bg-white' %> rounded-[28px] text-center space-y-2 transition-all group">
                            <div class="<%= (@challenge.cost_type || 'deposit') == cost[:id] ? 'text-indigo-600' : 'text-slate-300' %> flex justify-center">
                              <svg class="w-6 h-6 group-hover:scale-110 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="<%= cost[:icon] %>"/></svg>
                            </div>
                            <div>
                              <p class="font-black text-sm text-slate-900"><%= cost[:label] %></p>
                              <p class="text-[9px] font-bold text-slate-400"><%= cost[:sub] %></p>
                            </div>
                          </button>
                      <% end %>
                      <%= f.hidden_field :cost_type, value: @challenge.cost_type || "deposit" %>
                    </div>
                  </div>

                  <div class="grid grid-cols-1 gap-8 <%= (@challenge.cost_type || 'deposit') == 'free' ? 'hidden' : '' %>" data-challenge-form-target="costFields">
                    <!-- 참가비 섹션 (fee 선택 시) -->
                    <div class="space-y-6 <%= (@challenge.cost_type || 'deposit') == 'fee' ? '' : 'hidden' %>" data-challenge-form-target="feeSection">
                      <div class="space-y-4">
                        <label class="text-[11px] font-black text-slate-400 uppercase tracking-widest pl-2">참가비 금액</label>
                        <div class="flex items-center gap-4 p-6 bg-slate-50 rounded-[32px] border-2 border-transparent focus-within:bg-white focus-within:border-indigo-500/20 focus-within:ring-4 focus-within:ring-indigo-500/5 transition-all shadow-inner group">
                          <div class="flex-1 flex items-center gap-2 min-w-0 pl-2">
                            <%= f.hidden_field :participation_fee, value: @challenge.participation_fee || 10000, data: { challenge_form_target: "participationFeeHidden" } %>
                            <input type="text" 
                                   value="<%= number_with_delimiter(@challenge.participation_fee || 10000) %>"
                                   class="w-full text-3xl font-black p-0 border-none bg-transparent focus:ring-0 placeholder:text-slate-200 text-slate-900"
                                   data-action="input->challenge-form#formatCurrency"
                                   data-target-input="participationFeeHidden"
                                   placeholder="0">
                            <span class="flex-shrink-0 text-xl font-black text-slate-400">원</span>
                          </div>
                        </div>
                      </div>
                    </div>

                    <!-- 보증금 섹션 (deposit 선택 시) -->
                    <div class="space-y-6 <%= (@challenge.cost_type || 'deposit') == 'deposit' ? '' : 'hidden' %>" data-challenge-form-target="depositSection">
                      <div class="space-y-4">
                        <label class="text-[11px] font-black text-slate-400 uppercase tracking-widest pl-2">보증금 금액</label>
                        <div class="flex items-center gap-4 p-6 bg-slate-50 rounded-[32px] border-2 border-transparent focus-within:bg-white focus-within:border-indigo-500/20 focus-within:ring-4 focus-within:ring-indigo-500/5 transition-all shadow-inner group">
                          <div class="flex-1 flex items-center gap-2 min-w-0 pl-2">
                            <%= f.hidden_field :amount, value: @challenge.amount || 10000, data: { challenge_form_target: "amountHidden" }, id: "challenge_amount" %>
                            <input type="text" 
                                   value="<%= number_with_delimiter(@challenge.amount || 10000) %>"
                                   class="w-full text-3xl font-black p-0 border-none bg-transparent focus:ring-0 placeholder:text-slate-200 text-slate-900"
                                   data-action="input->challenge-form#formatCurrency"
                                   data-target-input="amountHidden"
                                   placeholder="0">
                            <span class="flex-shrink-0 text-xl font-black text-slate-400">원</span>
                          </div>
                        </div>
                      </div>

                      <!-- 참가비도 함께 받기 체크박스 -->
                      <div class="p-6 bg-indigo-50/50 rounded-[28px] border border-indigo-100/50 space-y-4">
                        <label class="flex items-center gap-4 cursor-pointer group">
                          <div class="relative inline-flex items-center">
                            <input type="checkbox" 
                                   class="sr-only peer" 
                                   data-challenge-form-target="addFeeCheckbox"
                                   data-action="change->challenge-form#toggleAddFee">
                            <div class="w-11 h-6 bg-slate-200 rounded-full peer peer-checked:bg-indigo-600 after:content-[''] after:absolute after:top-1 after:left-1 after:bg-white after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:after:translate-x-5"></div>
                          </div>
                          <div class="flex-1">
                            <p class="font-black text-sm text-slate-900">참가비도 함께 받기</p>
                            <p class="text-[10px] font-bold text-slate-500 mt-0.5">보증금과 별도로 참가비를 추가로 받습니다</p>
                          </div>
                        </label>

                        <div class="hidden space-y-4 pt-2" data-challenge-form-target="additionalFeeFields">
                          <div class="space-y-3">
                            <label class="text-[10px] font-black text-indigo-600 uppercase tracking-widest pl-2">참가비 금액</label>
                            <div class="flex items-center gap-4 p-5 bg-white rounded-[24px] border-2 border-indigo-100">
                              <div class="flex-1 flex items-center gap-2 min-w-0 pl-2">
                                <%= f.hidden_field :participation_fee, value: @challenge.participation_fee || 5000, data: { challenge_form_target: "participationFeeHidden" } %>
                                <input type="text" 
                                       value="<%= number_with_delimiter(@challenge.participation_fee || 5000) %>"
                                       class="w-full text-2xl font-black p-0 border-none bg-transparent focus:ring-0 text-slate-900"
                                       data-action="input->challenge-form#formatCurrency"
                                       data-target-input="participationFeeHidden"
                                       placeholder="0">
                                <span class="flex-shrink-0 text-lg font-black text-slate-400">원</span>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>

                    <!-- Failure Tolerance Card -->
                    <div class="bg-white rounded-[32px] p-6 border border-slate-100 shadow-xl shadow-slate-200/30 space-y-4 transition-all duration-500 <%= (@challenge.cost_type || 'deposit') == 'free' ? 'hidden' : '' %>" data-challenge-form-target="failureToleranceCard">
                      <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest pl-1">최대 실패 허용</label>
                      <div class="relative group">
                        <%= f.select :failure_tolerance, (0..10).map { |n| ["#{n}회 허용", n] }, { selected: @challenge.failure_tolerance || 2 }, class: "w-full bg-slate-50 border-2 border-transparent p-4 rounded-2xl font-black text-base text-slate-900 focus:border-indigo-500/20 transition-all outline-none appearance-none cursor-pointer" %>
                        <svg class="w-4 h-4 absolute right-5 top-1/2 -translate-y-1/2 text-slate-300 pointer-events-none group-focus-within:text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M19 9l-7 7-7-7"/></svg>
                      </div>
                    </div>

                    <!-- Penalty Amount Card (Moved here & Redesigned) -->
                    <div class="space-y-4 transition-all duration-500 <%= (@challenge.cost_type || 'deposit') == 'deposit' ? '' : 'hidden' %>" data-challenge-form-target="penaltyAmountCard">
                      <label class="text-[11px] font-black text-slate-400 uppercase tracking-widest pl-2">실패 차감액 설정</label>
                      <div class="flex items-center gap-4 p-6 bg-slate-900 rounded-[32px] border-2 border-transparent shadow-xl relative overflow-hidden group">
                        <div class="absolute -right-4 -top-4 w-20 h-20 bg-white/5 rounded-full blur-2xl group-hover:bg-white/10 transition-all"></div>
                        <div class="flex-1 flex items-center gap-3 min-w-0 pl-2 relative z-10">
                          <%= f.hidden_field :penalty_per_failure, value: @challenge.penalty_per_failure || 2000, data: { challenge_form_target: "penaltyHidden" } %>
                          <input type="text" 
                                 value="<%= number_with_delimiter(@challenge.penalty_per_failure || 2000) %>"
                                 class="w-full text-3xl font-black p-0 border-none bg-transparent focus:ring-0 text-white placeholder:text-slate-600"
                                 data-action="input->challenge-form#formatCurrency"
                                 data-target-input="penaltyHidden"
                                 placeholder="0">
                          <span class="flex-shrink-0 text-xl font-black text-slate-500">원</span>
                        </div>
                      </div>
                      <p class="text-[10px] font-bold text-slate-400 pl-4 leading-relaxed tracking-tight">1회 실패 시마다 보증금에서 차감되는 금액입니다.</p>
                    </div>

                    <!-- Achievement Benefit Thresholds (Deposit Only) -->
                    <div class="space-y-6 transition-all duration-500 <%= (@challenge.cost_type || 'deposit') == 'deposit' ? '' : 'hidden' %>" data-challenge-form-target="achievementThresholds">
                      <div class="flex items-center gap-3 pl-2">
                        <div class="w-8 h-8 rounded-xl bg-emerald-50 flex items-center justify-center text-emerald-600">
                          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                        </div>
                        <h4 class="text-base font-black text-slate-900">보증금 환급 기준 설정</h4>
                      </div>
                      <p class="text-[10px] font-bold text-slate-500 pl-2 leading-relaxed">참여자의 달성률에 따라 보증금을 어떻게 환급할지 기준을 정해주세요.</p>

                      <!-- Full Refund Threshold (Percentage) -->
                      <div class="p-8 bg-gradient-to-br from-emerald-50 to-teal-50 rounded-[32px] border-2 border-emerald-100 space-y-6">
                        <div class="flex items-center gap-3">
                          <div class="w-10 h-10 rounded-2xl bg-emerald-500 text-white flex items-center justify-center shadow-lg shadow-emerald-500/30">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                          </div>
                          <div>
                            <p class="text-sm font-black text-emerald-700 uppercase tracking-wider">전액 환급 기준</p>
                            <p class="text-[10px] font-bold text-emerald-600/60">달성률이 이 기준 이상이면 보증금 100% 환급</p>
                          </div>
                        </div>
                        
                        <div class="relative">
                          <div class="flex items-center gap-4 p-6 bg-white rounded-[24px] border-2 border-emerald-200 shadow-inner">
                            <%= f.number_field :full_refund_threshold, 
                                step: 1, 
                                min: 0, 
                                max: 100,
                                value: ((@challenge.full_refund_threshold || 0.8) * 100).to_i,
                                class: "w-full text-5xl font-black bg-transparent border-none focus:ring-0 text-emerald-600 text-center outline-none",
                                data: { 
                                  controller: "threshold-input",
                                  threshold_input_min_value: 0,
                                  threshold_input_max_value: 100,
                                  action: "input->threshold-input#enforce keydown->threshold-input#preventInvalid"
                                } %>
                            <span class="text-3xl font-black text-emerald-600">%</span>
                          </div>
                        </div>

                        <div class="p-4 bg-white/60 rounded-2xl border border-emerald-100/50">
                          <p class="text-[10px] font-bold text-slate-600 leading-relaxed">
                            💡 <span class="text-emerald-700">예시:</span> 80%로 설정하면, 챌린지 기간 중 80% 이상 달성한 참여자는 보증금을 전액 돌려받습니다.
                          </p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="w-full lg:w-80 shrink-0 space-y-8 lg:sticky lg:top-8">
                <div class="space-y-4">


                  <!-- Account Info Card (Moved here) -->
                  <div class="p-6 bg-indigo-50/50 rounded-[32px] border border-indigo-100/20 space-y-6 transition-all duration-500 <%= (@challenge.cost_type || 'deposit') == 'free' ? 'hidden' : '' %>" data-challenge-form-target="accountFields">
                    <div class="space-y-1 pl-1">
                      <p class="text-xs font-black text-indigo-900">입금 및 정산 계좌</p>
                      <p class="text-[10px] font-bold text-indigo-900/40 leading-tight">마지막 정산을 위한 정보를 입력해주세요.</p>
                    </div>

                    <div class="space-y-3">
                      <div class="grid grid-cols-2 gap-3">
                        <div class="space-y-1.5">
                          <label class="text-[9px] font-black text-indigo-600/40 uppercase tracking-widest pl-1">은행명</label>
                          <%= f.text_field :host_bank, placeholder: "예: 신한은행", data: { challenge_form_target: "bankName" }, class: "w-full p-3.5 bg-white/80 border border-indigo-100/50 rounded-xl font-bold text-xs text-slate-900 focus:bg-white focus:border-indigo-500/20 transition-all outline-none" %>
                        </div>
                        <div class="space-y-1.5">
                          <label class="text-[9px] font-black text-indigo-600/40 uppercase tracking-widest pl-1">예금주</label>
                          <%= f.text_field :host_account_holder, placeholder: "홍길동", data: { challenge_form_target: "accountHolder" }, class: "w-full p-3.5 bg-white/80 border border-indigo-100/50 rounded-xl font-bold text-xs text-slate-900 focus:bg-white focus:border-indigo-500/20 transition-all outline-none" %>
                        </div>
                      </div>
                      <div class="space-y-1.5">
                        <label class="text-[9px] font-black text-indigo-600/40 uppercase tracking-widest pl-1">계좌번호 (-제외)</label>
                        <%= f.text_field :host_account, placeholder: "숫자만 입력", data: { challenge_form_target: "accountNumber" }, class: "w-full p-3.5 bg-white/80 border border-indigo-100/50 rounded-xl font-bold text-xs text-slate-900 focus:bg-white focus:border-indigo-500/20 transition-all outline-none" %>
                      </div>
                      
                      <div class="space-y-1.5 <%= (@challenge.cost_type || 'deposit') == 'deposit' ? '' : 'hidden' %>" data-challenge-form-target="refundDateField">
                        <label class="text-[9px] font-black text-indigo-600/40 uppercase tracking-widest pl-1">환급 예정일</label>
                        <div class="relative">
                          <% 
                            # Calculate default refund date
                            default_refund_date = if @challenge.refund_date.present?
                              @challenge.refund_date
                            elsif @challenge.end_date.present?
                              # Set to last day of the month of end_date
                              @challenge.end_date.end_of_month
                            else
                              # Default to end of next month
                              (Date.current + 1.month).end_of_month
                            end
                          %>
                          <%= f.date_field :refund_date, 
                              value: default_refund_date,
                              id: "challenge_refund_date_input",
                              class: "w-full p-3.5 pr-10 bg-white/80 border border-indigo-100/50 rounded-xl font-bold text-xs text-slate-900 focus:bg-white focus:border-indigo-500/20 focus:ring-2 focus:ring-indigo-500/10 transition-all outline-none cursor-pointer hover:border-indigo-200" %>
                          <div class="absolute right-3 top-1/2 -translate-y-1/2 cursor-pointer" onclick="document.getElementById('challenge_refund_date_input').showPicker()">
                            <svg class="w-4 h-4 text-indigo-400 hover:text-indigo-600 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                            </svg>
                          </div>
                        </div>
                        <p class="text-[9px] font-medium text-indigo-900/40 pl-1">📅 클릭하여 날짜를 변경할 수 있습니다</p>
                      </div>
                    </div>

                    <div class="grid grid-cols-2 gap-2 pt-1">
                      <button type="button" data-action="click->challenge-form#saveAccount" class="py-2.5 bg-indigo-600 text-white rounded-xl text-[10px] font-black hover:bg-indigo-700 transition-all flex items-center justify-center gap-1">
                        저장
                      </button>
                      <button type="button" data-action="click->challenge-form#loadAccount" class="py-2.5 bg-white text-indigo-600 border border-indigo-100 rounded-xl text-[10px] font-black hover:bg-indigo-50 transition-all flex items-center justify-center gap-1">
                        불러오기
                      </button>
                    </div>
                  </div>
                </div>

                <!-- Operations Disclaimer -->
                <div class="p-6 bg-slate-50 border border-slate-100 rounded-[32px] space-y-3 <%= (@challenge.cost_type || 'deposit') == 'free' ? 'hidden' : '' %>" data-challenge-form-target="disclaimerFields">
                  <div class="flex items-center gap-2 text-indigo-500">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                    <span class="text-[11px] font-black uppercase tracking-wider">안전한 운영을 위한 안내</span>
                  </div>
                  <p class="text-[10px] font-bold text-slate-500 leading-relaxed pl-1">
                    참가비 및 보증금은 모두가 신뢰할 수 있도록 주최자님의 <span class="text-indigo-600">세심한 관리와 투명한 운영</span>이 필요합니다. 정산 과정에서 발생하는 <span class="text-slate-900">모든 분쟁 및 금전적 이슈에 대한 책임은 전적으로 주최자에게 있으며</span>, 루틴 파인더스는 정산 문제에 대해 어떠한 책임도 지지 않으며 개입하지 않습니다.
                  </p>
                </div>
              </div>

              <!-- Right Column: Navigation & Guide (Sticky) -->
              <div class="w-full lg:w-80 shrink-0 space-y-6 lg:space-y-8 lg:sticky lg:top-8">
                <div class="bg-amber-50/50 rounded-[28px] lg:rounded-[40px] p-6 lg:p-8 border border-amber-100/30 space-y-4 lg:space-y-6">
                  <div class="flex items-center gap-3 text-amber-900 border-b border-amber-100/50 pb-3 lg:pb-4">
                    <div class="w-8 h-8 rounded-xl bg-white flex items-center justify-center">
                      <svg class="w-4 h-4 text-amber-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                    </div>
                    <p class="font-black text-sm">비용 설정 안내</p>
                  </div>
                  <p class="text-[11px] font-bold text-amber-900/40 leading-relaxed">보증금 방식은 참여자의 동기부여를 높이고, 참가비는 수익 창출형 챌린지에 적합합니다. 무료 챌린지는 부담 없이 시작할 수 있습니다.</p>
                </div>

                <div class="space-y-3 lg:space-y-4">
                  <button type="button" data-action="click->challenge-form#next" class="w-full py-5 lg:py-6 bg-indigo-600 text-white rounded-[28px] lg:rounded-[32px] font-black text-base lg:text-lg shadow-2xl shadow-indigo-600/30 hover:bg-indigo-700 hover:-translate-y-1 active:translate-y-0 transition-all flex items-center justify-center gap-3 group">
                    다음 단계로
                    <svg class="w-5 h-5 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M13 7l5 5m0 0l-5 5m5-5H6"/></svg>
                  </button>
                  <button type="button" data-action="click->challenge-form#prev" class="w-full py-4 lg:py-5 bg-slate-100 text-slate-400 rounded-[28px] lg:rounded-[32px] font-black text-sm hover:bg-slate-200 transition-all">
                    이전 단계로
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Step 7: Reward Design -->
          <div class="space-y-10 hidden" data-challenge-form-target="step">
            <div class="flex flex-col lg:flex-row gap-10 items-start">
              <!-- Left Column: Primary Content -->
              <div class="flex-1 w-full bg-white rounded-[32px] lg:rounded-[40px] p-6 lg:p-12 border border-slate-100 shadow-2xl shadow-slate-200/40 space-y-8 lg:space-y-12">
                <div class="space-y-8">
                  <div class="flex items-center gap-4 pl-2">
                    <div class="w-10 h-10 rounded-2xl bg-amber-50 flex items-center justify-center text-amber-600">
                      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2M17 16v2a2 2 0 01-2 2H9a2 2 0 01-2-2v-2m3-5v3m4-3v3m-2-6V5a2 2 0 114 0v2"/></svg>
                    </div>
                    <h3 class="text-xl font-black text-slate-900">우승 혜택 설계</h3>
                  </div>

                  <p class="text-xs font-bold text-slate-400 pl-2 whitespace-nowrap">챌린지를 성공적으로 마친 참여자들에게 주어지는 특별한 보상을 설정해주세요.</p>

                  <div class="grid grid-cols-1 gap-6">
                    <!-- Reward Hidden Field -->
                    <%= f.hidden_field :reward_policy, data: { challenge_form_target: "rewardHidden" } %>

                    <!-- Dynamic Rewards Container -->
                    <div id="rewards-container" class="space-y-4" data-challenge-form-target="rewardsContainer">
                      <!-- New reward rows will be injected here -->
                    </div>

                    <!-- Add Reward Button -->
                    <button type="button" 
                            data-action="click->challenge-form#addReward" 
                            class="w-full py-6 bg-slate-50 border-2 border-dashed border-slate-200 rounded-[32px] text-slate-400 font-black text-sm hover:bg-white hover:border-indigo-500/20 hover:text-indigo-600 transition-all flex items-center justify-center gap-2 group">
                      <svg class="w-5 h-5 group-hover:scale-110 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M12 4v16m8-8H4"/></svg>
                      우승 혜택/순위 추가하기
                    </button>

                    <!-- Ranking Rules Info Box -->
                    <div class="mt-8 p-6 bg-indigo-50/50 rounded-[32px] border border-indigo-100/20 space-y-4">
                      <div class="flex items-center gap-2 text-indigo-600">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                        <span class="text-[11px] font-black uppercase tracking-wider">공정한 순위 산정 가이드</span>
                      </div>
                      <div class="space-y-3 pl-1">
                        <p class="text-[10px] font-bold text-slate-500 leading-relaxed">
                          달성률이 동일한 동점자가 발생할 경우, <span class="text-indigo-600 font-black">루틴 파인더스만의 정교한 알고리즘</span>을 통해 최종 순위가 결정됩니다.
                        </p>
                        <ul class="space-y-1.5">
                          <li class="flex items-center gap-2 text-[10px] font-bold text-slate-400">
                            <span class="w-1 h-1 bg-indigo-300 rounded-full"></span>
                            1순위: 챌린지 실천율 및 최대 연속 달성(Streak) 기록
                          </li>
                          <li class="flex items-center gap-2 text-[10px] font-bold text-slate-400">
                            <span class="w-1 h-1 bg-indigo-300 rounded-full"></span>
                            2순위: 서비스 접속률 및 활동 지수 (플랫폼 활성도)
                          </li>
                          <li class="flex items-center gap-2 text-[10px] font-bold text-slate-400">
                            <span class="w-1 h-1 bg-indigo-300 rounded-full"></span>
                            3순위: 관리 중인 개인 루틴의 개수 및 성실도 점수
                          </li>
                        </ul>
                        <p class="text-[9px] font-bold text-slate-300 leading-relaxed italic border-t border-indigo-100/30 pt-2">
                          * 모든 기준이 동일할 경우, 챌린지 신청 순서(선착순)에 따라 최종 순위가 배정됩니다.
                        </p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Right Column: Navigation -->
              <div class="w-full lg:w-80 shrink-0 space-y-8 lg:sticky lg:top-8">
                <div class="bg-slate-900 rounded-[32px] p-8 text-white shadow-2xl shadow-indigo-200/50 space-y-6 relative overflow-hidden group">
                  <div class="absolute -right-4 -top-4 w-24 h-24 bg-white/5 rounded-full blur-2xl group-hover:bg-white/10 transition-all"></div>
                  <div class="space-y-4 relative z-10">
                    <p class="text-[10px] font-black text-slate-400 uppercase tracking-widest pl-1">Final Step</p>
                    <h4 class="text-2xl font-black leading-tight">설계가 거의 <br>완료되었습니다!</h4>
                    <p class="text-xs font-bold text-slate-500 leading-relaxed tracking-tighter">우승 혜택은 참여율을 높이는 가장 강력한 도구입니다.<br>매력적인 보상을 제안해보세요.</p>
                  </div>
                </div>

                <!-- Reward Delivery Disclaimer -->
                <div class="p-6 bg-slate-50 border border-slate-100 rounded-[32px] space-y-3">
                  <div class="flex items-center gap-2 text-amber-500">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                    <span class="text-[11px] font-black uppercase tracking-wider">혜택 지급 및 관리 안내</span>
                  </div>
                  <p class="text-[10px] font-bold text-slate-500 leading-relaxed pl-1">
                    챌린지를 빛내주신 우승자분들을 위해 설정하신 혜택이 <span class="text-indigo-600">성실하고 투명하게 지급</span>될 수 있도록 힘써주세요. 모든 우승 혜택의 지급 및 관리 책임은 주최자님께 있으며, 루틴 파인더스는 혜택 지급 과정에 직접 관여하거나 보증하지 않습니다.
                  </p>
                </div>

                <div class="space-y-4 pt-4">
                  <button type="button" data-action="click->challenge-form#showSummary" class="w-full py-6 bg-indigo-600 text-white rounded-[32px] font-black text-xl shadow-2xl shadow-indigo-600/30 hover:bg-indigo-700 hover:-translate-y-1 active:translate-y-0 transition-all flex items-center justify-center gap-3 group">
                    최종 설계 완료
                    <svg class="w-5 h-5 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                  </button>
                  <button type="button" data-action="click->challenge-form#prev" class="w-full py-4 bg-slate-100 text-slate-400 rounded-[32px] font-black text-xs hover:bg-slate-200 transition-all">
                    이전 단계로
                  </button>
                </div>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  </div>

  <!-- Summary Confirmation Modal -->
  <div class="fixed inset-0 z-[100] hidden bg-slate-900/40 backdrop-blur-md items-center justify-center p-4 lg:p-6" data-challenge-form-target="summaryModal" data-action="click->challenge-form#handleModalClick">
    <div class="bg-white rounded-[32px] lg:rounded-[48px] p-6 lg:p-12 max-w-xl w-full shadow-[0_32px_80px_-16px_rgba(79,70,229,0.2)] space-y-8 lg:space-y-10 transform transition-all duration-500 scale-95 opacity-0 active:scale-100" onclick="event.stopPropagation()">
      <div class="text-center space-y-5">
        <div class="w-20 h-20 bg-indigo-50 text-indigo-600 rounded-[32px] flex items-center justify-center mx-auto shadow-sm ring-4 ring-indigo-50/50">
          <svg class="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
        </div>
        <div class="space-y-2">
          <h2 class="text-3xl font-black text-slate-900 tracking-tight">챌린지 개설 준비 완료!</h2>
          <p class="text-sm font-bold text-slate-400">마지막으로 아래 설계 내용을 확인해주세요.</p>
        </div>
      </div>

      <div data-challenge-form-target="summaryContent" class="bg-slate-50 rounded-[24px] lg:rounded-[32px] p-6 lg:p-8 border border-slate-100 space-y-4 lg:space-y-5 max-h-[50vh] lg:max-h-[400px] overflow-y-auto custom-scrollbar">
        <!-- Content injected via JS -->
      </div>

      <div class="px-4">
        <p class="text-[10px] font-bold text-slate-300 leading-relaxed text-center">
          루틴 파인더스는 건강한 커뮤니티 문화를 지향합니다. 불법, 사행성, 부적절한 취지의 <br class="hidden sm:block">
          챌린지는 운영 정책에 따라 <span class="text-slate-400">사전 통보 없이 노출 제한 및 삭제</span>될 수 있습니다.
        </p>
      </div>

      <div class="flex flex-row gap-3 lg:gap-4">
        <button type="button" data-action="click->challenge-form#hideSummary" class="flex-1 py-5 bg-slate-100 text-slate-500 rounded-[28px] font-black text-base hover:bg-slate-200 transition-all">수정하러 가기</button>
        <button type="button" data-action="click->challenge-form#submitForm" class="flex-[2] py-5 bg-indigo-600 text-white rounded-[28px] font-black text-lg shadow-2xl shadow-indigo-600/30 hover:bg-indigo-700 transition-all active:scale-95 flex items-center justify-center gap-2 text-center">
          최종 개설 확정
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"/></svg>
        </button>
      </div>
    </div>
  </div>

</div>

<style>
  /* Premium Scrollbar */
  .custom-scrollbar::-webkit-scrollbar {
    width: 6px;
  }
  .custom-scrollbar::-webkit-scrollbar-track {
    background: transparent;
  }
  .custom-scrollbar::-webkit-scrollbar-thumb {
    background: #e2e8f0;
    border-radius: 10px;
  }
  .custom-scrollbar::-webkit-scrollbar-thumb:hover {
    background: #cbd5e1;
  }

  /* Slider Styling Refined */
  input[type='range'] {
    -webkit-appearance: none;
    width: 100%;
    background: transparent;
  }
  input[type='range']:focus {
    outline: none;
  }
  input[type='range']::-webkit-slider-runnable-track {
    width: 100%;
    height: 12px;
    cursor: pointer;
    background: #f1f5f9;
    border-radius: 100px;
    border: none;
  }
  input[type='range']::-webkit-slider-thumb {
    height: 32px;
    width: 32px;
    border-radius: 16px;
    background: #ffffff;
    cursor: pointer;
    -webkit-appearance: none;
    margin-top: -10px;
    border: 4px solid #4f46e5;
    box-shadow: 0 4px 12px rgba(79, 70, 229, 0.2);
    transition: all 0.2s ease;
  }
  input[type='range']::-webkit-slider-thumb:hover {
    transform: scale(1.1);
    box-shadow: 0 6px 16px rgba(79, 70, 229, 0.3);
  }

  /* Hide Native Date/Time Icons */
  input[type="date"]::-webkit-calendar-picker-indicator,
  input[type="time"]::-webkit-calendar-picker-indicator {
    display: none;
    -webkit-appearance: none;
  }

  /* Hide Number Input Spinners */
  input[type="number"].no-spinner::-webkit-inner-spin-button,
  input[type="number"].no-spinner::-webkit-outer-spin-button {
    -webkit-appearance: none;
    margin: 0;
  }
  input[type="number"].no-spinner {
    -moz-appearance: textfield;
  }

  /* Shake Animation for Errors */
  @keyframes shake {
    0%, 100% { transform: translateX(0); }
    10%, 30%, 50%, 70%, 90% { transform: translateX(-8px); }
    20%, 40%, 60%, 80% { transform: translateX(8px); }
  }
  .animate-shake {
    animation: shake 0.6s cubic-bezier(.36,.07,.19,.97) both;
  }
</style>

