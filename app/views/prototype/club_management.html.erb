<% if notice %>
  <div id="success-popup" class="fixed inset-0 z-[5000] flex items-center justify-center p-6">
    <div onclick="this.parentElement.remove()" class="absolute inset-0 bg-black/60 backdrop-blur-sm"></div>
    <div class="relative app-glass-card p-8 bg-[#1B1A24] border-white/10 text-center space-y-4 max-w-xs animate-badge-pop">
      <div class="w-16 h-16 bg-emerald-500/20 text-emerald-400 rounded-2xl flex items-center justify-center text-3xl mx-auto">✨</div>
      <div class="space-y-1">
        <h3 class="text-lg font-black text-white">업데이트 완료</h3>
        <p class="text-xs font-bold text-slate-400"><%= notice %></p>
      </div>
      <button onclick="this.parentElement.parentElement.remove()" class="w-full py-3 bg-white/5 hover:bg-white/10 text-white font-bold text-sm rounded-xl transition-all">확인</button>
    </div>
  </div>
<% end %>

<div class="space-y-8 py-10 pb-32" data-controller="tabs" data-tabs-active-class="text-indigo-400 border-indigo-400" data-tabs-inactive-class="text-slate-500 border-transparent">
  <!-- 1. Header -->
  <header class="px-6 space-y-4">
    <div class="flex items-center justify-between">
      <%= link_to prototype_admin_dashboard_path, class: "w-10 h-10 rounded-2xl bg-white/5 border border-white/10 flex items-center justify-center text-slate-400 active:scale-95 transition-all" do %>
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M15 19l-7-7 7-7"/></svg>
      <% end %>
      <div class="px-3 py-1 rounded-full bg-indigo-500/10 border border-indigo-500/20">
        <span class="text-[9px] font-black text-indigo-400 uppercase tracking-widest leading-none">Rupha Club Only</span>
      </div>
      <div class="w-10"></div>
    </div>

    <div class="space-y-1">
      <div class="flex items-center justify-between">
        <h1 class="text-3xl font-black text-white tracking-tight">루파 클럽 통합 관리</h1>
      </div>
      <p class="text-xs font-bold text-slate-500">플랫폼 유일의 공식 멤버십 '루파 클럽'을 관리합니다.</p>
    </div>
  </header>

  <% if @official_club %>
    <!-- 2. Club Overview Statistics -->
    <section class="px-6">
      <div class="app-glass-card p-6 border-white/5 bg-gradient-to-br from-indigo-600/10 to-purple-600/10 relative overflow-hidden">
        <div class="flex items-center justify-between relative z-10">
          <div class="space-y-1">
            <h2 class="text-xl font-black text-white"><%= @official_club.title %></h2>
            <div class="flex items-center gap-2">
               <span class="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></span>
               <p class="text-[10px] font-black text-emerald-500 uppercase tracking-widest">Active Season</p>
            </div>
          </div>
          <div class="text-right">
            <%= link_to prototype_batch_reports_path, class: "px-4 py-2.5 bg-emerald-500 rounded-xl text-[10px] font-black text-white shadow-lg shadow-emerald-500/20 active:scale-95 transition-all flex items-center gap-2 inline-flex" do %>
              <span>📈</span> 리포트
            <% end %>
          </div>
        </div>

        <div class="grid grid-cols-2 gap-6 mt-8 pt-6 border-t border-white/5">
           <div class="text-center border-r border-white/5">
             <p class="text-[8px] font-black text-slate-500 uppercase tracking-widest mb-1 text-center">Avg. Dash</p>
             <p class="text-lg font-black text-indigo-400"><%= @official_club.average_attendance_rate %>%</p>
           </div>
           <div class="text-center">
             <p class="text-[8px] font-black text-slate-500 uppercase tracking-widest mb-1">Growth Points</p>
             <p class="text-lg font-black text-white"><%= number_with_delimiter(@club_members.sum(:growth_points)) %>P</p>
           </div>
        </div>
      </div>
    </section>

    <!-- 3. Main Navigation Tabs -->
    <nav class="px-6 sticky top-0 z-30 bg-[#1B1A24]/80 backdrop-blur-md py-4">
      <div class="flex items-center justify-between gap-2 border-b border-white/5">
        <button type="button" 
                data-tabs-target="tab" 
                data-id="members" 
                data-action="click->tabs#change"
                class="flex-1 pb-4 text-xs font-black uppercase tracking-widest border-b-2 transition-all text-indigo-400 border-indigo-400">회원 관리</button>
        <button type="button" 
                data-tabs-target="tab" 
                data-id="lounge" 
                data-action="click->tabs#change"
                class="flex-1 pb-4 text-xs font-black uppercase tracking-widest border-b-2 transition-all text-slate-500 border-transparent">라운지 관리</button>
        <button type="button" 
                data-tabs-target="tab" 
                data-id="announcements" 
                data-action="click->tabs#change"
                class="flex-1 pb-4 text-xs font-black uppercase tracking-widest border-b-2 transition-all text-slate-500 border-transparent">공지</button>
      </div>
    </nav>

    <!-- 4. Tab Panels -->
    <div class="space-y-12">
      <!-- Member Management Panel -->
      <div class="space-y-12" data-tabs-target="panel" data-id="members">
        <!-- Pending Approvals -->
        <% if @pending_memberships.any? %>
          <section class="px-6 space-y-4">
            <div class="flex items-center justify-between pl-1">
              <div class="flex items-center gap-2 text-amber-500">
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/></svg>
                <span class="text-[10px] font-black uppercase tracking-widest">결제 대기 멤버 (<%= @pending_memberships.size %>)</span>
              </div>
            </div>
            <div class="space-y-3">
              <% @pending_memberships.each do |member| %>
                <div class="app-glass-card p-4 border-amber-500/20 bg-amber-500/5 flex items-center justify-between">
                  <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-xl bg-white/5 flex items-center justify-center text-white font-black text-xs">
                      <%= member.user.nickname[0].upcase %>
                    </div>
                    <div>
                      <p class="text-sm font-black text-white leading-tight"><%= member.user.nickname %></p>
                      <p class="text-[9px] font-bold text-slate-500 mt-0.5">입금명: <%= member.depositor_name %> · ₩<%= number_with_delimiter(member.paid_amount) %></p>
                    </div>
                  </div>
                  <div class="flex gap-2">
                    <button class="w-8 h-8 rounded-lg bg-emerald-500 text-white flex items-center justify-center shadow-lg shadow-emerald-500/20">
                      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"/></svg>
                    </button>
                    <button class="w-8 h-8 rounded-lg bg-white/5 text-slate-500 flex items-center justify-center">
                      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M6 18L18 6M6 6l12 12"/></svg>
                    </button>
                  </div>
                </div>
              <% end %>
            </div>
          </section>
        <% end %>

        <!-- Active Members Sub-Tabs (Sub-Tabs controller already exists) -->
        <section class="px-6 space-y-6" data-controller="sub-tabs" data-sub-tabs-active-class="bg-white/10 text-white" data-sub-tabs-inactive-class="text-slate-500">
          <div class="flex items-center justify-between px-1">
            <h2 class="text-xs font-black text-slate-500 uppercase tracking-[0.2em]">회원 상태 리빙 데이터</h2>
            <div class="flex bg-white/5 rounded-lg p-1 gap-1">
               <button type="button" 
                       data-sub-tabs-target="tab" 
                       data-id="members_list" 
                       data-action="click->sub-tabs#change"
                       class="px-3 py-1 text-[9px] font-black rounded transition-all bg-white/10 text-white">현황</button>
               <button type="button" 
                       data-sub-tabs-target="tab" 
                       data-id="members_analysis" 
                       data-action="click->sub-tabs#change"
                       class="px-3 py-1 text-[9px] font-black rounded transition-all text-slate-500">성과지표</button>
            </div>
          </div>

          <!-- Sub-Tab: 현황 -->
          <div class="space-y-3" data-sub-tabs-target="panel" data-id="members_list">
            <% if @club_members.any? %>
              <% @club_members.each do |member| %>
                <div class="app-glass-card p-4 border-white/5 flex items-center justify-between">
                  <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-xl bg-white/5 flex items-center justify-center text-white font-black text-xs">
                      <%= member.user.nickname[0].upcase %>
                    </div>
                    <div>
                      <p class="text-sm font-black text-white leading-tight"><%= member.user.nickname %></p>
                      <p class="text-[9px] font-bold text-slate-500 mt-0.5">LV.<%= member.user.level %> · <%= member.identity_title || '클럽 멤버' %></p>
                    </div>
                  </div>
                  <div class="text-right">
                    <p class="text-[10px] font-black <%= member.status_active? ? 'text-emerald-400' : 'text-amber-500' %> uppercase"><%= member.status %></p>
                    <p class="text-[8px] font-bold text-slate-500 mt-0.5"><%= member.joined_at.strftime("%Y.%m.%d") %> 가입</p>
                  </div>
                </div>
              <% end %>
            <% else %>
              <div class="py-16 text-center bg-white/2 rounded-[32px] border border-dashed border-white/5">
                <p class="text-xs font-bold text-slate-600">가입된 회원이 없습니다.</p>
              </div>
            <% end %>
          </div>

          <!-- Sub-Tab: 성과지표 -->
          <div class="space-y-4 hidden" data-sub-tabs-target="panel" data-id="members_analysis">
            <% @member_stats.each do |stat| %>
              <div class="app-glass-card p-5 border-white/5 space-y-4">
                <div class="flex items-center justify-between">
                  <div class="flex items-center gap-4">
                    <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-white font-black text-xs">
                      <%= stat[:member].user.nickname[0].upcase %>
                    </div>
                    <div>
                      <h4 class="text-sm font-black text-white leading-tight"><%= stat[:member].user.nickname %></h4>
                      <p class="text-[9px] font-bold text-slate-500 mt-1">지표 분석 가동 중...</p>
                    </div>
                  </div>
                  <div class="text-right">
                     <span class="text-[10px] font-black text-emerald-400 uppercase tracking-widest"><%= stat[:weekly_rate] %>% Success</span>
                  </div>
                </div>
                <div class="grid grid-cols-2 gap-3">
                   <div class="p-3 bg-white/2 rounded-2xl border border-white/5">
                     <p class="text-[8px] font-black text-slate-500 uppercase tracking-widest mb-1.5 leading-none">Weekly Success</p>
                     <div class="flex items-baseline gap-2">
                       <span class="text-lg font-black text-white"><%= stat[:weekly_rate] %>%</span>
                       <div class="h-1.5 flex-1 bg-white/5 rounded-full overflow-hidden">
                         <div class="h-full bg-indigo-500" style="width: <%= stat[:weekly_rate] %>%"></div>
                       </div>
                     </div>
                   </div>
                   <div class="p-3 bg-white/2 rounded-2xl border border-white/5">
                     <p class="text-[8px] font-black text-slate-500 uppercase tracking-widest mb-1.5 leading-none">Monthly Success</p>
                     <div class="flex items-baseline gap-2">
                       <span class="text-lg font-black text-white"><%= stat[:monthly_rate] %>%</span>
                       <div class="h-1.5 flex-1 bg-white/5 rounded-full overflow-hidden">
                         <div class="h-full bg-purple-500" style="width: <%= stat[:monthly_rate] %>%"></div>
                       </div>
                     </div>
                   </div>
                </div>
                <div class="flex items-center justify-end gap-2 pt-1">
                   <%= link_to prototype_member_reports_path(user_id: stat[:member].user_id), class: "px-3 py-1.5 border border-white/10 rounded-lg text-[9px] font-black text-slate-400 hover:text-white transition-colors" do %>리포트<% end %>
                   <button class="px-3 py-1.5 border border-white/10 rounded-lg text-[9px] font-black text-slate-400 hover:text-rose-500 transition-colors">경고</button>
                </div>
              </div>
            <% end %>
          </div>
        </section>

        <!-- Staff List (Moved inside Member Management) -->
        <section class="px-6 space-y-4">
          <div class="flex items-center justify-between px-1">
            <h2 class="text-xs font-black text-slate-500 uppercase tracking-[0.2em]">클럽 관리 스태프</h2>
          </div>
          <div class="space-y-3">
            <% if @club_admins.any? %>
              <% @club_admins.each do |admin| %>
                <div class="app-glass-card p-4 flex items-center justify-between border-white/5">
                  <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-xl bg-white/5 flex items-center justify-center text-white font-black text-xs">
                      <%= admin.nickname[0].upcase %>
                    </div>
                    <div>
                      <p class="text-sm font-black text-white"><%= admin.nickname %></p>
                      <p class="text-[9px] font-bold text-indigo-400/60 uppercase tracking-widest">Moderator</p>
                    </div>
                  </div>
                  <button class="text-slate-600 hover:text-rose-500"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg></button>
                </div>
              <% end %>
            <% end %>
          </div>
        </section>
      </div>

      <!-- Lounge Management Panel -->
      <div class="px-6 hidden" data-tabs-target="panel" data-id="lounge">
        <div class="app-glass-card p-6 border-white/5 space-y-8" data-controller="lounge-settings">
          <div class="flex items-center justify-between border-b border-white/5 pb-4">
            <h3 class="text-lg font-black text-indigo-400 uppercase tracking-widest">라운지 실시간 설정</h3>
            <span class="text-[9px] font-black text-slate-500">Live & Lecture Room</span>
          </div>

          <%= form_with model: @official_club, url: prototype_update_club_lounge_path, method: :patch, local: true, class: "space-y-8" do |f| %>
            <!-- LIVE ROOM -->
            <div class="space-y-4" data-lounge-settings-target="liveContainer">
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                  <div class="w-8 h-8 rounded-xl bg-indigo-500/20 flex items-center justify-center text-sm">📹</div>
                  <span class="text-xs font-black text-white uppercase tracking-widest">LIVE ROOM</span>
                </div>
                <label class="relative inline-flex items-center cursor-pointer">
                  <%= f.check_box :live_room_active, class: "sr-only peer", data: { lounge_settings_target: "liveToggle", action: "change->lounge-settings#toggleLive" } %>
                  <div class="w-9 h-5 bg-white/10 rounded-full peer peer-checked:bg-indigo-500 after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:after:translate-x-full"></div>
                </label>
              </div>
              <div class="space-y-3">
                <%= f.text_field :live_room_title, placeholder: "라이브 방 제목", class: "w-full bg-white/5 border border-white/10 rounded-2xl px-5 py-3 text-xs font-bold text-white focus:border-indigo-500 outline-none transition-all disabled:opacity-30", data: { lounge_settings_target: "liveInput" } %>
                <div class="grid grid-cols-2 gap-3">
                  <%= f.text_field :live_room_button_text, placeholder: "버튼명 (예: 입장하기)", class: "w-full bg-white/5 border border-white/10 rounded-2xl px-5 py-3 text-xs font-bold text-white focus:border-indigo-500 outline-none transition-all disabled:opacity-30", data: { lounge_settings_target: "liveInput" } %>
                  <%= f.text_field :zoom_link, placeholder: "링크 URL", class: "w-full bg-white/5 border border-white/10 rounded-2xl px-5 py-3 text-xs font-bold text-white focus:border-indigo-500 outline-none transition-all disabled:opacity-30", data: { lounge_settings_target: "liveInput" } %>
                </div>
              </div>
            </div>

            <!-- LECTURE ROOM -->
            <div class="space-y-4" data-lounge-settings-target="lectureContainer">
              <div class="flex items-center justify-between pt-4 border-t border-white/5">
                <div class="flex items-center gap-3">
                  <div class="w-8 h-8 rounded-xl bg-purple-500/20 flex items-center justify-center text-sm">🎓</div>
                  <span class="text-xs font-black text-white uppercase tracking-widest">LECTURE ROOM</span>
                </div>
                <label class="relative inline-flex items-center cursor-pointer">
                  <%= f.check_box :lecture_room_active, class: "sr-only peer", data: { lounge_settings_target: "lectureToggle", action: "change->lounge-settings#toggleLecture" } %>
                  <div class="w-9 h-5 bg-white/10 rounded-full peer peer-checked:bg-purple-500 after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:after:translate-x-full"></div>
                </label>
              </div>
              <div class="space-y-3">
                <%= f.text_field :lecture_room_title, placeholder: "강의실 제목", class: "w-full bg-white/5 border border-white/10 rounded-2xl px-5 py-3 text-xs font-bold text-white focus:border-purple-500 outline-none transition-all disabled:opacity-30", data: { lounge_settings_target: "lectureInput" } %>
                <%= f.text_area :lecture_room_description, placeholder: "강의 상세 설명", rows: 2, class: "w-full bg-white/5 border border-white/10 rounded-2xl px-5 py-3 text-xs font-medium text-slate-300 focus:border-purple-500 outline-none transition-all disabled:opacity-30", data: { lounge_settings_target: "lectureInput" } %>
                <%= f.text_field :special_lecture_link, placeholder: "강의실 링크", class: "w-full bg-white/5 border border-white/10 rounded-2xl px-5 py-3 text-xs font-bold text-white focus:border-purple-500 outline-none transition-all disabled:opacity-30", data: { lounge_settings_target: "lectureInput" } %>
              </div>
            </div>

            <button type="submit" class="w-full py-4 bg-indigo-600 rounded-2xl text-white font-black text-xs shadow-xl shadow-indigo-600/20 active:scale-95 transition-all">설정 업데이트 완료</button>
          <% end %>
        </div>
      </div>

      <!-- Announcements Panel -->
      <div class="px-6 hidden space-y-8" data-tabs-target="panel" data-id="announcements">
        <!-- Create Announcement Placeholder -->
        <div class="app-glass-card p-6 border-white/5 bg-white/2 space-y-4">
           <div class="flex items-center gap-3">
             <div class="w-8 h-8 bg-indigo-500 rounded-xl flex items-center justify-center text-white text-xs">📣</div>
             <h3 class="text-sm font-black text-white">클럽 공지사항 등록</h3>
           </div>
           <div class="space-y-3">
             <input type="text" placeholder="공지 제목을 입력하세요" class="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-xs font-bold text-white outline-none focus:border-indigo-500 transition-all">
             <textarea placeholder="공지 내용을 상세히 입력하세요" rows="4" class="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-xs font-medium text-slate-300 outline-none focus:border-indigo-500 transition-all"></textarea>
             <button class="w-full py-3 bg-white/10 hover:bg-white/20 text-white font-black text-xs rounded-xl transition-all">공지 게시하기</button>
           </div>
        </div>

        <div class="space-y-4">
          <h4 class="text-[10px] font-black text-slate-500 uppercase tracking-widest pl-1">게시된 최근 공지</h4>
          <% if @announcements.any? %>
            <% @announcements.each do |ann| %>
              <div class="app-glass-card p-5 border-white/5 flex items-start justify-between gap-4">
                 <div class="space-y-1">
                   <p class="text-xs font-black text-white"><%= ann.title %></p>
                   <p class="text-[10px] text-slate-500 font-medium line-clamp-1"><%= ann.content %></p>
                   <p class="text-[8px] font-black text-slate-600 uppercase tracking-tighter pt-1"><%= ann.created_at.strftime("%Y.%m.%d") %></p>
                 </div>
                 <button class="text-slate-600 hover:text-white transition-colors">
                   <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/></svg>
                 </button>
              </div>
            <% end %>
          <% else %>
            <div class="py-12 text-center border-white/5 rounded-3xl border border-dashed">
              <p class="text-[10px] font-bold text-slate-600">등록된 공지가 없습니다.</p>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  <% else %>
     <!-- No Club State (Keep as is) -->
     <div class="px-6">
        <div class="py-20 text-center app-glass-card border-white/10">
           <span class="text-4xl">🔱</span>
           <h2 class="text-xl font-black text-white mt-6">공식 클럽 정보 없음</h2>
           <button class="mt-8 px-8 py-4 bg-indigo-600 rounded-2xl text-white font-black text-sm">루파 클럽 개설하기</button>
        </div>
     </div>
  <% end %>
</div>
